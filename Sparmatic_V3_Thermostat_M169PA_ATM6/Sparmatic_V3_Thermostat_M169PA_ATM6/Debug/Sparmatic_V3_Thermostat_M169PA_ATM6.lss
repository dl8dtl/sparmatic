
AVRASM ver. 2.1.52  E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6.asm Fri Jan 23 20:19:48 2015

[builtin](2): Including file 'D:\Programme\Atmel\Atmel Toolchain\AVR Assembler\Native\2.1.1103\avrassembler\Include\m169PAdef.inc'
E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6.asm(9): Including file 'E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\Def_Equ.inc'
E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6.asm(10): Including file 'E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\Init.inc'
E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6.asm(980): Including file 'E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\Regulation.inc'
E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6.asm(981): Including file 'E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\LCD_Driver.inc'
E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6.asm(982): Including file 'E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\LCDTable.inc'
E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6.asm(983): Including file 'E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\Debug.inc'
E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6.asm(984): Including file 'E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\Motor.inc'
E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6.asm(985): Including file 'E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\User.inc'
E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6.asm(986): Including file 'E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\ISR.inc'
E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6.asm(987): Including file 'E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\ADC.inc'
E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6.asm(988): Including file 'E:\AVR_8_Projects\Sparmatic_V3_Thermostat_M169PA_ATM6\Sparmatic_V3_Thermostat_M169PA_ATM6\RTC.inc'
                 
                 /*
                 
                 ;***** Created: 2011-02-09 12:03 ******* Source: ATmega169PA.xml *********
                 ;*************************************************************************
                 ;* A P P L I C A T I O N   N O T E   F O R   T H E   A V R   F A M I L Y
                 ;* 
                 ;* Number            : AVR000
                 ;* File Name         : "m169PAdef.inc"
                 ;* Title             : Register/Bit Definitions for the ATmega169PA
                 ;* Date              : 2011-02-09
                 ;* Version           : 2.35
                 ;* Support E-mail    : avr@atmel.com
                 ;* Target MCU        : ATmega169PA
                 ;* 
                 ;* DESCRIPTION
                 ;* When including this file in the assembly program file, all I/O register 
                 ;* names and I/O register bit names appearing in the data book can be used.
                 ;* In addition, the six registers forming the three data pointers X, Y and 
                 ;* Z have been assigned names XL - ZH. Highest RAM address for Internal 
                 ;* SRAM is also defined 
                 ;* 
                 ;* The Register names are represented by their hexadecimal address.
                 ;* 
                 ;* The Register Bit names are represented by their bit number (0-7).
                 ;* 
                 ;* Please observe the difference in using the bit names with instructions
                 ;* such as "sbr"/"cbr" (set/clear bit in register) and "sbrs"/"sbrc"
                 ;* (skip if bit in register set/cleared). The following example illustrates
                 ;* this:
                 ;* 
                 ;* in    r16,PORTB             ;read PORTB latch
                 ;* sbr   r16,(1<<PB6)+(1<<PB5) ;set PB6 and PB5 (use masks, not bit#)
                 ;* out   PORTB,r16             ;output to PORTB
                 ;* 
                 ;* in    r16,TIFR              ;read the Timer Interrupt Flag Register
                 ;* sbrc  r16,TOV0              ;test the overflow flag (use bit#)
                 ;* rjmp  TOV0_is_set           ;jump if set
                 ;* ...                         ;otherwise do something else
                 ;*************************************************************************
                 
                 #ifndef _M169PADEF_INC_
                 #define _M169PADEF_INC_
                 
                 
                 #pragma partinc 0
                 
                 ; ***** SPECIFY DEVICE ***************************************************
                 .device ATmega169PA
                 #pragma AVRPART ADMIN PART_NAME ATmega169PA
                 .equ	SIGNATURE_000	= 0x1e
                 .equ	SIGNATURE_001	= 0x94
                 .equ	SIGNATURE_002	= 0x05
                 
                 #pragma AVRPART CORE CORE_VERSION V2E
                 
                 
                 ; ***** I/O REGISTER DEFINITIONS *****************************************
                 ; NOTE:
                 ; Definitions marked "MEMORY MAPPED"are extended I/O ports
                 ; and cannot be used with IN/OUT instructions
                 .equ	LCDDR18	= 0xfe	; MEMORY MAPPED
                 .equ	LCDDR17	= 0xfd	; MEMORY MAPPED
                 .equ	LCDDR16	= 0xfc	; MEMORY MAPPED
                 .equ	LCDDR15	= 0xfb	; MEMORY MAPPED
                 .equ	LCDDR13	= 0xf9	; MEMORY MAPPED
                 .equ	LCDDR12	= 0xf8	; MEMORY MAPPED
                 .equ	LCDDR11	= 0xf7	; MEMORY MAPPED
                 .equ	LCDDR10	= 0xf6	; MEMORY MAPPED
                 .equ	LCDDR8	= 0xf4	; MEMORY MAPPED
                 .equ	LCDDR7	= 0xf3	; MEMORY MAPPED
                 .equ	LCDDR6	= 0xf2	; MEMORY MAPPED
                 .equ	LCDDR5	= 0xf1	; MEMORY MAPPED
                 .equ	LCDDR3	= 0xef	; MEMORY MAPPED
                 .equ	LCDDR2	= 0xee	; MEMORY MAPPED
                 .equ	LCDDR1	= 0xed	; MEMORY MAPPED
                 .equ	LCDDR0	= 0xec	; MEMORY MAPPED
                 .equ	LCDCCR	= 0xe7	; MEMORY MAPPED
                 .equ	LCDFRR	= 0xe6	; MEMORY MAPPED
                 .equ	LCDCRB	= 0xe5	; MEMORY MAPPED
                 .equ	LCDCRA	= 0xe4	; MEMORY MAPPED
                 .equ	UDR0	= 0xc6	; MEMORY MAPPED
                 .equ	UBRR0L	= 0xc4	; MEMORY MAPPED
                 .equ	UBRR0H	= 0xc5	; MEMORY MAPPED
                 .equ	UCSR0C	= 0xc2	; MEMORY MAPPED
                 .equ	UCSR0B	= 0xc1	; MEMORY MAPPED
                 .equ	UCSR0A	= 0xc0	; MEMORY MAPPED
                 .equ	USIDR	= 0xba	; MEMORY MAPPED
                 .equ	USISR	= 0xb9	; MEMORY MAPPED
                 .equ	USICR	= 0xb8	; MEMORY MAPPED
                 .equ	ASSR	= 0xb6	; MEMORY MAPPED
                 .equ	OCR2A	= 0xb3	; MEMORY MAPPED
                 .equ	TCNT2	= 0xb2	; MEMORY MAPPED
                 .equ	TCCR2B	= 0xb1	; MEMORY MAPPED
                 .equ	TCCR2A	= 0xb0	; MEMORY MAPPED
                 .equ	OCR1BL	= 0x8a	; MEMORY MAPPED
                 .equ	OCR1BH	= 0x8b	; MEMORY MAPPED
                 .equ	OCR1AL	= 0x88	; MEMORY MAPPED
                 .equ	OCR1AH	= 0x89	; MEMORY MAPPED
                 .equ	ICR1L	= 0x86	; MEMORY MAPPED
                 .equ	ICR1H	= 0x87	; MEMORY MAPPED
                 .equ	TCNT1L	= 0x84	; MEMORY MAPPED
                 .equ	TCNT1H	= 0x85	; MEMORY MAPPED
                 .equ	TCCR1C	= 0x82	; MEMORY MAPPED
                 .equ	TCCR1B	= 0x81	; MEMORY MAPPED
                 .equ	TCCR1A	= 0x80	; MEMORY MAPPED
                 .equ	DIDR1	= 0x7f	; MEMORY MAPPED
                 .equ	DIDR0	= 0x7e	; MEMORY MAPPED
                 .equ	ADMUX	= 0x7c	; MEMORY MAPPED
                 .equ	ADCSRB	= 0x7b	; MEMORY MAPPED
                 .equ	ADCSRA	= 0x7a	; MEMORY MAPPED
                 .equ	ADCH	= 0x79	; MEMORY MAPPED
                 .equ	ADCL	= 0x78	; MEMORY MAPPED
                 .equ	TIMSK2	= 0x70	; MEMORY MAPPED
                 .equ	TIMSK1	= 0x6f	; MEMORY MAPPED
                 .equ	TIMSK0	= 0x6e	; MEMORY MAPPED
                 .equ	PCMSK0	= 0x6b	; MEMORY MAPPED
                 .equ	PCMSK1	= 0x6c	; MEMORY MAPPED
                 .equ	EICRA	= 0x69	; MEMORY MAPPED
                 .equ	OSCCAL	= 0x66	; MEMORY MAPPED
                 .equ	PRR	= 0x64	; MEMORY MAPPED
                 .equ	CLKPR	= 0x61	; MEMORY MAPPED
                 .equ	WDTCR	= 0x60	; MEMORY MAPPED
                 .equ	SREG	= 0x3f
                 .equ	SPL	= 0x3d
                 .equ	SPH	= 0x3e
                 .equ	SPMCSR	= 0x37
                 .equ	MCUCR	= 0x35
                 .equ	MCUSR	= 0x34
                 .equ	SMCR	= 0x33
                 .equ	OCDR	= 0x31
                 .equ	ACSR	= 0x30
                 .equ	SPDR	= 0x2e
                 .equ	SPSR	= 0x2d
                 .equ	SPCR	= 0x2c
                 .equ	GPIOR2	= 0x2b
                 .equ	GPIOR1	= 0x2a
                 .equ	OCR0A	= 0x27
                 .equ	TCNT0	= 0x26
                 .equ	TCCR0A	= 0x24
                 .equ	GTCCR	= 0x23
                 .equ	EEARL	= 0x21
                 .equ	EEARH	= 0x22
                 .equ	EEDR	= 0x20
                 .equ	EECR	= 0x1f
                 .equ	GPIOR0	= 0x1e
                 .equ	EIMSK	= 0x1d
                 .equ	EIFR	= 0x1c
                 .equ	TIFR2	= 0x17
                 .equ	TIFR1	= 0x16
                 .equ	TIFR0	= 0x15
                 .equ	PORTG	= 0x14
                 .equ	DDRG	= 0x13
                 .equ	PING	= 0x12
                 .equ	PORTF	= 0x11
                 .equ	DDRF	= 0x10
                 .equ	PINF	= 0x0f
                 .equ	PORTE	= 0x0e
                 .equ	DDRE	= 0x0d
                 .equ	PINE	= 0x0c
                 .equ	PORTD	= 0x0b
                 .equ	DDRD	= 0x0a
                 .equ	PIND	= 0x09
                 .equ	PORTC	= 0x08
                 .equ	DDRC	= 0x07
                 .equ	PINC	= 0x06
                 .equ	PORTB	= 0x05
                 .equ	DDRB	= 0x04
                 .equ	PINB	= 0x03
                 .equ	PORTA	= 0x02
                 .equ	DDRA	= 0x01
                 .equ	PINA	= 0x00
                 
                 
                 ; ***** BIT DEFINITIONS **************************************************
                 
                 ; ***** TIMER_COUNTER_0 **************
                 ; TCCR0A - Timer/Counter0 Control Register
                 .equ	CS00	= 0	; Clock Select 0
                 .equ	CS01	= 1	; Clock Select 1
                 .equ	CS02	= 2	; Clock Select 2
                 .equ	WGM01	= 3	; Waveform Generation Mode 1
                 .equ	COM0A0	= 4	; Compare match Output Mode 0
                 .equ	COM0A1	= 5	; Compare Match Output Mode 1
                 .equ	WGM00	= 6	; Waveform Generation Mode 0
                 .equ	FOC0A	= 7	; Force Output Compare
                 
                 ; TCNT0 - Timer/Counter0
                 .equ	TCNT0_0	= 0	; 
                 .equ	TCNT0_1	= 1	; 
                 .equ	TCNT0_2	= 2	; 
                 .equ	TCNT0_3	= 3	; 
                 .equ	TCNT0_4	= 4	; 
                 .equ	TCNT0_5	= 5	; 
                 .equ	TCNT0_6	= 6	; 
                 .equ	TCNT0_7	= 7	; 
                 
                 ; OCR0A - Timer/Counter0 Output Compare Register
                 .equ	OCR0A0	= 0	; 
                 .equ	OCR0A1	= 1	; 
                 .equ	OCR0A2	= 2	; 
                 .equ	OCR0A3	= 3	; 
                 .equ	OCR0A4	= 4	; 
                 .equ	OCR0A5	= 5	; 
                 .equ	OCR0A6	= 6	; 
                 .equ	OCR0A7	= 7	; 
                 
                 ; TIMSK0 - Timer/Counter0 Interrupt Mask Register
                 .equ	TOIE0	= 0	; Timer/Counter0 Overflow Interrupt Enable
                 .equ	OCIE0A	= 1	; Timer/Counter0 Output Compare Match Interrupt Enable
                 
                 ; TIFR0 - Timer/Counter0 Interrupt Flag register
                 .equ	TOV0	= 0	; Timer/Counter0 Overflow Flag
                 .equ	OCF0A	= 1	; Timer/Counter0 Output Compare Flag 0
                 
                 ; GTCCR - General Timer/Control Register
                 .equ	PSR310	= 0	; Prescaler Reset Timer/Counter1 and Timer/Counter0
                 .equ	PSR10	= PSR310	; For compatibility
                 .equ	PSR0	= PSR310	; For compatibility
                 .equ	PSR1	= PSR310	; For compatibility
                 .equ	PSR3	= PSR310	; For compatibility
                 .equ	TSM	= 7	; Timer/Counter Synchronization Mode
                 
                 
                 ; ***** TIMER_COUNTER_1 **************
                 ; TIMSK1 - Timer/Counter1 Interrupt Mask Register
                 .equ	TOIE1	= 0	; Timer/Counter1 Overflow Interrupt Enable
                 .equ	OCIE1A	= 1	; Timer/Counter1 Output Compare A Match Interrupt Enable
                 .equ	OCIE1B	= 2	; Timer/Counter1 Output Compare B Match Interrupt Enable
                 .equ	ICIE1	= 5	; Timer/Counter1 Input Capture Interrupt Enable
                 
                 ; TIFR1 - Timer/Counter1 Interrupt Flag register
                 .equ	TOV1	= 0	; Timer/Counter1 Overflow Flag
                 .equ	OCF1A	= 1	; Output Compare Flag 1A
                 .equ	OCF1B	= 2	; Output Compare Flag 1B
                 .equ	ICF1	= 5	; Input Capture Flag 1
                 
                 ; TCCR1A - Timer/Counter1 Control Register A
                 .equ	WGM10	= 0	; Waveform Generation Mode
                 .equ	WGM11	= 1	; Waveform Generation Mode
                 .equ	COM1B0	= 4	; Compare Output Mode 1B, bit 0
                 .equ	COM1B1	= 5	; Compare Output Mode 1B, bit 1
                 .equ	COM1A0	= 6	; Compare Output Mode 1A, bit 0
                 .equ	COM1A1	= 7	; Compare Output Mode 1A, bit 1
                 
                 ; TCCR1B - Timer/Counter1 Control Register B
                 .equ	CS10	= 0	; Prescaler source of Timer/Counter 1
                 .equ	CS11	= 1	; Prescaler source of Timer/Counter 1
                 .equ	CS12	= 2	; Prescaler source of Timer/Counter 1
                 .equ	WGM12	= 3	; Waveform Generation Mode
                 .equ	WGM13	= 4	; Waveform Generation Mode
                 .equ	ICES1	= 6	; Input Capture 1 Edge Select
                 .equ	ICNC1	= 7	; Input Capture 1 Noise Canceler
                 
                 ; TCCR1C - Timer/Counter 1 Control Register C
                 .equ	FOC1B	= 6	; Force Output Compare 1B
                 .equ	FOC1A	= 7	; Force Output Compare 1A
                 
                 
                 ; ***** TIMER_COUNTER_2 **************
                 ; TIMSK2 - Timer/Counter2 Interrupt Mask register
                 .equ	TOIE2	= 0	; Timer/Counter2 Overflow Interrupt Enable
                 .equ	OCIE2A	= 1	; Timer/Counter2 Output Compare Match Interrupt Enable
                 
                 ; TIFR2 - Timer/Counter2 Interrupt Flag Register
                 .equ	TOV2	= 0	; Timer/Counter2 Overflow Flag
                 .equ	OCF2A	= 1	; Timer/Counter2 Output Compare Flag 2
                 
                 ; TCCR2A - Timer/Counter2 Control Register
                 .equ	CS20	= 0	; Clock Select bit 0
                 .equ	CS21	= 1	; Clock Select bit 1
                 .equ	CS22	= 2	; Clock Select bit 2
                 .equ	WGM21	= 3	; Waveform Generation Mode
                 .equ	COM2A0	= 4	; Compare Output Mode bit 0
                 .equ	COM2A1	= 5	; Compare Output Mode bit 1
                 .equ	WGM20	= 6	; Waveform Generation Mode
                 .equ	FOC2A	= 7	; Force Output Compare A
                 
                 ; TCNT2 - Timer/Counter2
                 .equ	TCNT2_0	= 0	; Timer/Counter 2 bit 0
                 .equ	TCNT2_1	= 1	; Timer/Counter 2 bit 1
                 .equ	TCNT2_2	= 2	; Timer/Counter 2 bit 2
                 .equ	TCNT2_3	= 3	; Timer/Counter 2 bit 3
                 .equ	TCNT2_4	= 4	; Timer/Counter 2 bit 4
                 .equ	TCNT2_5	= 5	; Timer/Counter 2 bit 5
                 .equ	TCNT2_6	= 6	; Timer/Counter 2 bit 6
                 .equ	TCNT2_7	= 7	; Timer/Counter 2 bit 7
                 
                 ; OCR2A - Timer/Counter2 Output Compare Register
                 .equ	OCR2A0	= 0	; Timer/Counter2 Output Compare Register Bit 0
                 .equ	OCR2A1	= 1	; Timer/Counter2 Output Compare Register Bit 1
                 .equ	OCR2A2	= 2	; Timer/Counter2 Output Compare Register Bit 2
                 .equ	OCR2A3	= 3	; Timer/Counter2 Output Compare Register Bit 3
                 .equ	OCR2A4	= 4	; Timer/Counter2 Output Compare Register Bit 4
                 .equ	OCR2A5	= 5	; Timer/Counter2 Output Compare Register Bit 5
                 .equ	OCR2A6	= 6	; Timer/Counter2 Output Compare Register Bit 6
                 .equ	OCR2A7	= 7	; Timer/Counter2 Output Compare Register Bit 7
                 
                 ; GTCCR - General Timer/Counter Control Register
                 .equ	PSR2	= 1	; Prescaler Reset Timer/Counter2
                 
                 ; ASSR - Asynchronous Status Register
                 .equ	TCR2UB	= 0	; TCR2UB: Timer/Counter Control Register2 Update Busy
                 .equ	OCR2UB	= 1	; Output Compare Register2 Update Busy
                 .equ	TCN2UB	= 2	; TCN2UB: Timer/Counter2 Update Busy
                 .equ	AS2	= 3	; AS2: Asynchronous Timer/Counter2
                 .equ	EXCLK	= 4	; Enable External Clock Interrupt
                 
                 
                 ; ***** WATCHDOG *********************
                 ; WDTCR - Watchdog Timer Control Register
                 .equ	WDTCSR	= WDTCR	; For compatibility
                 .equ	WDP0	= 0	; Watch Dog Timer Prescaler bit 0
                 .equ	WDP1	= 1	; Watch Dog Timer Prescaler bit 1
                 .equ	WDP2	= 2	; Watch Dog Timer Prescaler bit 2
                 .equ	WDE	= 3	; Watch Dog Enable
                 .equ	WDCE	= 4	; Watchdog Change Enable
                 .equ	WDTOE	= WDCE	; For compatibility
                 
                 
                 ; ***** EEPROM ***********************
                 ; EEDR - EEPROM Data Register
                 .equ	EEDR0	= 0	; EEPROM Data Register bit 0
                 .equ	EEDR1	= 1	; EEPROM Data Register bit 1
                 .equ	EEDR2	= 2	; EEPROM Data Register bit 2
                 .equ	EEDR3	= 3	; EEPROM Data Register bit 3
                 .equ	EEDR4	= 4	; EEPROM Data Register bit 4
                 .equ	EEDR5	= 5	; EEPROM Data Register bit 5
                 .equ	EEDR6	= 6	; EEPROM Data Register bit 6
                 .equ	EEDR7	= 7	; EEPROM Data Register bit 7
                 
                 ; EECR - EEPROM Control Register
                 .equ	EERE	= 0	; EEPROM Read Enable
                 .equ	EEWE	= 1	; EEPROM Write Enable
                 .equ	EEMWE	= 2	; EEPROM Master Write Enable
                 .equ	EEWEE	= EEMWE	; For compatibility
                 .equ	EERIE	= 3	; EEPROM Ready Interrupt Enable
                 
                 
                 ; ***** SPI **************************
                 ; SPDR - SPI Data Register
                 .equ	SPDR0	= 0	; SPI Data Register bit 0
                 .equ	SPDR1	= 1	; SPI Data Register bit 1
                 .equ	SPDR2	= 2	; SPI Data Register bit 2
                 .equ	SPDR3	= 3	; SPI Data Register bit 3
                 .equ	SPDR4	= 4	; SPI Data Register bit 4
                 .equ	SPDR5	= 5	; SPI Data Register bit 5
                 .equ	SPDR6	= 6	; SPI Data Register bit 6
                 .equ	SPDR7	= 7	; SPI Data Register bit 7
                 
                 ; SPSR - SPI Status Register
                 .equ	SPI2X	= 0	; Double SPI Speed Bit
                 .equ	WCOL	= 6	; Write Collision Flag
                 .equ	SPIF	= 7	; SPI Interrupt Flag
                 
                 ; SPCR - SPI Control Register
                 .equ	SPR0	= 0	; SPI Clock Rate Select 0
                 .equ	SPR1	= 1	; SPI Clock Rate Select 1
                 .equ	CPHA	= 2	; Clock Phase
                 .equ	CPOL	= 3	; Clock polarity
                 .equ	MSTR	= 4	; Master/Slave Select
                 .equ	DORD	= 5	; Data Order
                 .equ	SPE	= 6	; SPI Enable
                 .equ	SPIE	= 7	; SPI Interrupt Enable
                 
                 
                 ; ***** PORTA ************************
                 ; PORTA - Port A Data Register
                 .equ	PORTA0	= 0	; Port A Data Register bit 0
                 .equ	PA0	= 0	; For compatibility
                 .equ	PORTA1	= 1	; Port A Data Register bit 1
                 .equ	PA1	= 1	; For compatibility
                 .equ	PORTA2	= 2	; Port A Data Register bit 2
                 .equ	PA2	= 2	; For compatibility
                 .equ	PORTA3	= 3	; Port A Data Register bit 3
                 .equ	PA3	= 3	; For compatibility
                 .equ	PORTA4	= 4	; Port A Data Register bit 4
                 .equ	PA4	= 4	; For compatibility
                 .equ	PORTA5	= 5	; Port A Data Register bit 5
                 .equ	PA5	= 5	; For compatibility
                 .equ	PORTA6	= 6	; Port A Data Register bit 6
                 .equ	PA6	= 6	; For compatibility
                 .equ	PORTA7	= 7	; Port A Data Register bit 7
                 .equ	PA7	= 7	; For compatibility
                 
                 ; DDRA - Port A Data Direction Register
                 .equ	DDA0	= 0	; Data Direction Register, Port A, bit 0
                 .equ	DDA1	= 1	; Data Direction Register, Port A, bit 1
                 .equ	DDA2	= 2	; Data Direction Register, Port A, bit 2
                 .equ	DDA3	= 3	; Data Direction Register, Port A, bit 3
                 .equ	DDA4	= 4	; Data Direction Register, Port A, bit 4
                 .equ	DDA5	= 5	; Data Direction Register, Port A, bit 5
                 .equ	DDA6	= 6	; Data Direction Register, Port A, bit 6
                 .equ	DDA7	= 7	; Data Direction Register, Port A, bit 7
                 
                 ; PINA - Port A Input Pins
                 .equ	PINA0	= 0	; Input Pins, Port A bit 0
                 .equ	PINA1	= 1	; Input Pins, Port A bit 1
                 .equ	PINA2	= 2	; Input Pins, Port A bit 2
                 .equ	PINA3	= 3	; Input Pins, Port A bit 3
                 .equ	PINA4	= 4	; Input Pins, Port A bit 4
                 .equ	PINA5	= 5	; Input Pins, Port A bit 5
                 .equ	PINA6	= 6	; Input Pins, Port A bit 6
                 .equ	PINA7	= 7	; Input Pins, Port A bit 7
                 
                 
                 ; ***** PORTB ************************
                 ; PORTB - Port B Data Register
                 .equ	PORTB0	= 0	; Port B Data Register bit 0
                 .equ	PB0	= 0	; For compatibility
                 .equ	PORTB1	= 1	; Port B Data Register bit 1
                 .equ	PB1	= 1	; For compatibility
                 .equ	PORTB2	= 2	; Port B Data Register bit 2
                 .equ	PB2	= 2	; For compatibility
                 .equ	PORTB3	= 3	; Port B Data Register bit 3
                 .equ	PB3	= 3	; For compatibility
                 .equ	PORTB4	= 4	; Port B Data Register bit 4
                 .equ	PB4	= 4	; For compatibility
                 .equ	PORTB5	= 5	; Port B Data Register bit 5
                 .equ	PB5	= 5	; For compatibility
                 .equ	PORTB6	= 6	; Port B Data Register bit 6
                 .equ	PB6	= 6	; For compatibility
                 .equ	PORTB7	= 7	; Port B Data Register bit 7
                 .equ	PB7	= 7	; For compatibility
                 
                 ; DDRB - Port B Data Direction Register
                 .equ	DDB0	= 0	; Port B Data Direction Register bit 0
                 .equ	DDB1	= 1	; Port B Data Direction Register bit 1
                 .equ	DDB2	= 2	; Port B Data Direction Register bit 2
                 .equ	DDB3	= 3	; Port B Data Direction Register bit 3
                 .equ	DDB4	= 4	; Port B Data Direction Register bit 4
                 .equ	DDB5	= 5	; Port B Data Direction Register bit 5
                 .equ	DDB6	= 6	; Port B Data Direction Register bit 6
                 .equ	DDB7	= 7	; Port B Data Direction Register bit 7
                 
                 ; PINB - Port B Input Pins
                 .equ	PINB0	= 0	; Port B Input Pins bit 0
                 .equ	PINB1	= 1	; Port B Input Pins bit 1
                 .equ	PINB2	= 2	; Port B Input Pins bit 2
                 .equ	PINB3	= 3	; Port B Input Pins bit 3
                 .equ	PINB4	= 4	; Port B Input Pins bit 4
                 .equ	PINB5	= 5	; Port B Input Pins bit 5
                 .equ	PINB6	= 6	; Port B Input Pins bit 6
                 .equ	PINB7	= 7	; Port B Input Pins bit 7
                 
                 
                 ; ***** PORTC ************************
                 ; PORTC - Port C Data Register
                 .equ	PORTC0	= 0	; Port C Data Register bit 0
                 .equ	PC0	= 0	; For compatibility
                 .equ	PORTC1	= 1	; Port C Data Register bit 1
                 .equ	PC1	= 1	; For compatibility
                 .equ	PORTC2	= 2	; Port C Data Register bit 2
                 .equ	PC2	= 2	; For compatibility
                 .equ	PORTC3	= 3	; Port C Data Register bit 3
                 .equ	PC3	= 3	; For compatibility
                 .equ	PORTC4	= 4	; Port C Data Register bit 4
                 .equ	PC4	= 4	; For compatibility
                 .equ	PORTC5	= 5	; Port C Data Register bit 5
                 .equ	PC5	= 5	; For compatibility
                 .equ	PORTC6	= 6	; Port C Data Register bit 6
                 .equ	PC6	= 6	; For compatibility
                 .equ	PORTC7	= 7	; Port C Data Register bit 7
                 .equ	PC7	= 7	; For compatibility
                 
                 ; DDRC - Port C Data Direction Register
                 .equ	DDC0	= 0	; Port C Data Direction Register bit 0
                 .equ	DDC1	= 1	; Port C Data Direction Register bit 1
                 .equ	DDC2	= 2	; Port C Data Direction Register bit 2
                 .equ	DDC3	= 3	; Port C Data Direction Register bit 3
                 .equ	DDC4	= 4	; Port C Data Direction Register bit 4
                 .equ	DDC5	= 5	; Port C Data Direction Register bit 5
                 .equ	DDC6	= 6	; Port C Data Direction Register bit 6
                 .equ	DDC7	= 7	; Port C Data Direction Register bit 7
                 
                 ; PINC - Port C Input Pins
                 .equ	PINC0	= 0	; Port C Input Pins bit 0
                 .equ	PINC1	= 1	; Port C Input Pins bit 1
                 .equ	PINC2	= 2	; Port C Input Pins bit 2
                 .equ	PINC3	= 3	; Port C Input Pins bit 3
                 .equ	PINC4	= 4	; Port C Input Pins bit 4
                 .equ	PINC5	= 5	; Port C Input Pins bit 5
                 .equ	PINC6	= 6	; Port C Input Pins bit 6
                 .equ	PINC7	= 7	; Port C Input Pins bit 7
                 
                 
                 ; ***** PORTD ************************
                 ; PORTD - Port D Data Register
                 .equ	PORTD0	= 0	; Port D Data Register bit 0
                 .equ	PD0	= 0	; For compatibility
                 .equ	PORTD1	= 1	; Port D Data Register bit 1
                 .equ	PD1	= 1	; For compatibility
                 .equ	PORTD2	= 2	; Port D Data Register bit 2
                 .equ	PD2	= 2	; For compatibility
                 .equ	PORTD3	= 3	; Port D Data Register bit 3
                 .equ	PD3	= 3	; For compatibility
                 .equ	PORTD4	= 4	; Port D Data Register bit 4
                 .equ	PD4	= 4	; For compatibility
                 .equ	PORTD5	= 5	; Port D Data Register bit 5
                 .equ	PD5	= 5	; For compatibility
                 .equ	PORTD6	= 6	; Port D Data Register bit 6
                 .equ	PD6	= 6	; For compatibility
                 .equ	PORTD7	= 7	; Port D Data Register bit 7
                 .equ	PD7	= 7	; For compatibility
                 
                 ; DDRD - Port D Data Direction Register
                 .equ	DDD0	= 0	; Port D Data Direction Register bit 0
                 .equ	DDD1	= 1	; Port D Data Direction Register bit 1
                 .equ	DDD2	= 2	; Port D Data Direction Register bit 2
                 .equ	DDD3	= 3	; Port D Data Direction Register bit 3
                 .equ	DDD4	= 4	; Port D Data Direction Register bit 4
                 .equ	DDD5	= 5	; Port D Data Direction Register bit 5
                 .equ	DDD6	= 6	; Port D Data Direction Register bit 6
                 .equ	DDD7	= 7	; Port D Data Direction Register bit 7
                 
                 ; PIND - Port D Input Pins
                 .equ	PIND0	= 0	; Port D Input Pins bit 0
                 .equ	PIND1	= 1	; Port D Input Pins bit 1
                 .equ	PIND2	= 2	; Port D Input Pins bit 2
                 .equ	PIND3	= 3	; Port D Input Pins bit 3
                 .equ	PIND4	= 4	; Port D Input Pins bit 4
                 .equ	PIND5	= 5	; Port D Input Pins bit 5
                 .equ	PIND6	= 6	; Port D Input Pins bit 6
                 .equ	PIND7	= 7	; Port D Input Pins bit 7
                 
                 
                 ; ***** ANALOG_COMPARATOR ************
                 ; ADCSRB - ADC Control and Status Register B
                 .equ	ACME	= 6	; Analog Comparator Multiplexer Enable
                 
                 ; ACSR - Analog Comparator Control And Status Register
                 .equ	ACIS0	= 0	; Analog Comparator Interrupt Mode Select bit 0
                 .equ	ACIS1	= 1	; Analog Comparator Interrupt Mode Select bit 1
                 .equ	ACIC	= 2	; Analog Comparator Input Capture Enable
                 .equ	ACIE	= 3	; Analog Comparator Interrupt Enable
                 .equ	ACI	= 4	; Analog Comparator Interrupt Flag
                 .equ	ACO	= 5	; Analog Compare Output
                 .equ	ACBG	= 6	; Analog Comparator Bandgap Select
                 .equ	ACD	= 7	; Analog Comparator Disable
                 
                 ; DIDR1 - Digital Input Disable Register 1
                 .equ	AIN0D	= 0	; AIN0 Digital Input Disable
                 .equ	AIN1D	= 1	; AIN1 Digital Input Disable
                 
                 
                 ; ***** PORTE ************************
                 ; PORTE - Data Register, Port E
                 .equ	PORTE0	= 0	; 
                 .equ	PE0	= 0	; For compatibility
                 .equ	PORTE1	= 1	; 
                 .equ	PE1	= 1	; For compatibility
                 .equ	PORTE2	= 2	; 
                 .equ	PE2	= 2	; For compatibility
                 .equ	PORTE3	= 3	; 
                 .equ	PE3	= 3	; For compatibility
                 .equ	PORTE4	= 4	; 
                 .equ	PE4	= 4	; For compatibility
                 .equ	PORTE5	= 5	; 
                 .equ	PE5	= 5	; For compatibility
                 .equ	PORTE6	= 6	; 
                 .equ	PE6	= 6	; For compatibility
                 .equ	PORTE7	= 7	; 
                 .equ	PE7	= 7	; For compatibility
                 
                 ; DDRE - Data Direction Register, Port E
                 .equ	DDE0	= 0	; 
                 .equ	DDE1	= 1	; 
                 .equ	DDE2	= 2	; 
                 .equ	DDE3	= 3	; 
                 .equ	DDE4	= 4	; 
                 .equ	DDE5	= 5	; 
                 .equ	DDE6	= 6	; 
                 .equ	DDE7	= 7	; 
                 
                 ; PINE - Input Pins, Port E
                 .equ	PINE0	= 0	; 
                 .equ	PINE1	= 1	; 
                 .equ	PINE2	= 2	; 
                 .equ	PINE3	= 3	; 
                 .equ	PINE4	= 4	; 
                 .equ	PINE5	= 5	; 
                 .equ	PINE6	= 6	; 
                 .equ	PINE7	= 7	; 
                 
                 
                 ; ***** PORTF ************************
                 ; PORTF - Data Register, Port F
                 .equ	PORTF0	= 0	; 
                 .equ	PF0	= 0	; For compatibility
                 .equ	PORTF1	= 1	; 
                 .equ	PF1	= 1	; For compatibility
                 .equ	PORTF2	= 2	; 
                 .equ	PF2	= 2	; For compatibility
                 .equ	PORTF3	= 3	; 
                 .equ	PF3	= 3	; For compatibility
                 .equ	PORTF4	= 4	; 
                 .equ	PF4	= 4	; For compatibility
                 .equ	PORTF5	= 5	; 
                 .equ	PF5	= 5	; For compatibility
                 .equ	PORTF6	= 6	; 
                 .equ	PF6	= 6	; For compatibility
                 .equ	PORTF7	= 7	; 
                 .equ	PF7	= 7	; For compatibility
                 
                 ; DDRF - Data Direction Register, Port F
                 .equ	DDF0	= 0	; 
                 .equ	DDF1	= 1	; 
                 .equ	DDF2	= 2	; 
                 .equ	DDF3	= 3	; 
                 .equ	DDF4	= 4	; 
                 .equ	DDF5	= 5	; 
                 .equ	DDF6	= 6	; 
                 .equ	DDF7	= 7	; 
                 
                 ; PINF - Input Pins, Port F
                 .equ	PINF0	= 0	; 
                 .equ	PINF1	= 1	; 
                 .equ	PINF2	= 2	; 
                 .equ	PINF3	= 3	; 
                 .equ	PINF4	= 4	; 
                 .equ	PINF5	= 5	; 
                 .equ	PINF6	= 6	; 
                 .equ	PINF7	= 7	; 
                 
                 
                 ; ***** JTAG *************************
                 ; OCDR - On-Chip Debug Related Register in I/O Memory
                 .equ	OCDR0	= 0	; On-Chip Debug Register Bit 0
                 .equ	OCDR1	= 1	; On-Chip Debug Register Bit 1
                 .equ	OCDR2	= 2	; On-Chip Debug Register Bit 2
                 .equ	OCDR3	= 3	; On-Chip Debug Register Bit 3
                 .equ	OCDR4	= 4	; On-Chip Debug Register Bit 4
                 .equ	OCDR5	= 5	; On-Chip Debug Register Bit 5
                 .equ	OCDR6	= 6	; On-Chip Debug Register Bit 6
                 .equ	OCDR7	= 7	; On-Chip Debug Register Bit 7
                 .equ	IDRD	= OCDR7	; For compatibility
                 
                 ; MCUCR - MCU Control Register
                 .equ	JTD	= 7	; JTAG Interface Disable
                 
                 ; MCUSR - MCU Status Register
                 .equ	JTRF	= 4	; JTAG Reset Flag
                 
                 
                 ; ***** LCD **************************
                 ; LCDCRA - LCD Control Register A
                 .equ	LCDBL	= 0	; LCD Blanking
                 .equ	LCDCCD	= 1	; LCD Contrast Control Disable
                 .equ	LCDBD	= 2	; LCD Buffer Disable
                 .equ	LCDIE	= 3	; LCD Interrupt Enable
                 .equ	LCDIF	= 4	; LCD Interrupt Flag
                 .equ	LCDAB	= 6	; LCD A or B waveform
                 .equ	LCDEN	= 7	; LCD Enable
                 
                 ; LCDCRB - LCD Control and Status Register B
                 .equ	LCDPM0	= 0	; LCD Port Mask 0
                 .equ	LCDPM1	= 1	; LCD Port Mask 1
                 .equ	LCDPM2	= 2	; LCD Port Mask 2
                 .equ	LCDMUX0	= 4	; LCD Mux Select 0
                 .equ	LCDMUX1	= 5	; LCD Mux Select 1
                 .equ	LCD2B	= 6	; LCD 1/2 Bias Select
                 .equ	LCDCS	= 7	; LCD CLock Select
                 
                 ; LCDFRR - LCD Frame Rate Register
                 .equ	LCDCD0	= 0	; LCD Clock Divider 0
                 .equ	LCDCD1	= 1	; LCD Clock Divider 1
                 .equ	LCDCD2	= 2	; LCD Clock Divider 2
                 .equ	LCDPS0	= 4	; LCD Prescaler Select 0
                 .equ	LCDPS1	= 5	; LCD Prescaler Select 1
                 .equ	LCDPS2	= 6	; LCD Prescaler Select 2
                 
                 ; LCDCCR - LCD Contrast Control Register
                 .equ	LCDCC0	= 0	; LCD Contrast Control 0
                 .equ	LCDCC1	= 1	; LCD Contrast Control 1
                 .equ	LCDCC2	= 2	; LCD Contrast Control 2
                 .equ	LCDCC3	= 3	; LCD Contrast Control 3
                 .equ	LCDMDT	= 4	; LCD Maximum Drive Time
                 .equ	LCDDC0	= 5	; LCD Display Configuration Bit 0
                 .equ	LCDDC1	= 6	; LCD Display Configuration Bit 1
                 .equ	LCDDC2	= 7	; LCD Display Configuration Bit 2
                 
                 ; LCDDR18 - LCD Data Register 18
                 .equ	SEG324	= 0	; 
                 
                 ; LCDDR17 - LCD Data Register 17
                 .equ	SEG316	= 0	; 
                 .equ	SEG317	= 1	; 
                 .equ	SEG318	= 2	; 
                 .equ	SEG319	= 3	; 
                 .equ	SEG320	= 4	; 
                 .equ	SEG321	= 5	; 
                 .equ	SEG322	= 6	; 
                 .equ	SEG323	= 7	; 
                 
                 ; LCDDR16 - LCD Data Register 16
                 .equ	SEG308	= 0	; 
                 .equ	SEG309	= 1	; 
                 .equ	SEG310	= 2	; 
                 .equ	SEG311	= 3	; 
                 .equ	SEG312	= 4	; 
                 .equ	SEG313	= 5	; 
                 .equ	SEG314	= 6	; 
                 .equ	SEG315	= 7	; 
                 
                 ; LCDDR15 - LCD Data Register 15
                 .equ	SEG300	= 0	; 
                 .equ	SEG301	= 1	; 
                 .equ	SEG302	= 2	; 
                 .equ	SEG303	= 3	; 
                 .equ	SEG304	= 4	; 
                 .equ	SEG305	= 5	; 
                 .equ	SEG306	= 6	; 
                 .equ	SEG307	= 7	; 
                 
                 ; LCDDR13 - LCD Data Register 13
                 .equ	SEG224	= 0	; 
                 
                 ; LCDDR12 - LCD Data Register 12
                 .equ	SEG216	= 0	; 
                 .equ	SEG217	= 1	; 
                 .equ	SEG218	= 2	; 
                 .equ	SEG219	= 3	; 
                 .equ	SEG220	= 4	; 
                 .equ	SEG221	= 5	; 
                 .equ	SEG222	= 6	; 
                 .equ	SEG223	= 7	; 
                 
                 ; LCDDR11 - LCD Data Register 11
                 .equ	SEG208	= 0	; 
                 .equ	SEG209	= 1	; 
                 .equ	SEG210	= 2	; 
                 .equ	SEG211	= 3	; 
                 .equ	SEG212	= 4	; 
                 .equ	SEG213	= 5	; 
                 .equ	SEG214	= 6	; 
                 .equ	SEG215	= 7	; 
                 
                 ; LCDDR10 - LCD Data Register 10
                 .equ	SEG200	= 0	; 
                 .equ	SEG201	= 1	; 
                 .equ	SEG202	= 2	; 
                 .equ	SEG203	= 3	; 
                 .equ	SEG204	= 4	; 
                 .equ	SEG205	= 5	; 
                 .equ	SEG206	= 6	; 
                 .equ	SEG207	= 7	; 
                 
                 ; LCDDR8 - LCD Data Register 8
                 .equ	SEG124	= 0	; 
                 
                 ; LCDDR7 - LCD Data Register 7
                 .equ	SEG116	= 0	; 
                 .equ	SEG117	= 1	; 
                 .equ	SEG118	= 2	; 
                 .equ	SEG119	= 3	; 
                 .equ	SEG120	= 4	; 
                 .equ	SEG121	= 5	; 
                 .equ	SEG122	= 6	; 
                 .equ	SEG123	= 7	; 
                 
                 ; LCDDR6 - LCD Data Register 6
                 .equ	SEG108	= 0	; 
                 .equ	SEG109	= 1	; 
                 .equ	SEG110	= 2	; 
                 .equ	SEG111	= 3	; 
                 .equ	SEG112	= 4	; 
                 .equ	SEG113	= 5	; 
                 .equ	SEG114	= 6	; 
                 .equ	SEG115	= 7	; 
                 
                 ; LCDDR5 - LCD Data Register 5
                 .equ	SEG100	= 0	; 
                 .equ	SEG101	= 1	; 
                 .equ	SEG102	= 2	; 
                 .equ	SEG103	= 3	; 
                 .equ	SEG104	= 4	; 
                 .equ	SEG105	= 5	; 
                 .equ	SEG106	= 6	; 
                 .equ	SEG107	= 7	; 
                 
                 ; LCDDR3 - LCD Data Register 3
                 .equ	SEG024	= 0	; 
                 
                 ; LCDDR2 - LCD Data Register 2
                 .equ	SEG016	= 0	; 
                 .equ	SEG017	= 1	; 
                 .equ	SEG018	= 2	; 
                 .equ	SEG019	= 3	; 
                 .equ	SEG020	= 4	; 
                 .equ	SEG021	= 5	; 
                 .equ	SEG022	= 6	; 
                 .equ	SEG023	= 7	; 
                 
                 ; LCDDR1 - LCD Data Register 1
                 .equ	SEG008	= 0	; 
                 .equ	SEG009	= 1	; 
                 .equ	SEG010	= 2	; 
                 .equ	SEG011	= 3	; 
                 .equ	SEG012	= 4	; 
                 .equ	SEG013	= 5	; 
                 .equ	SEG014	= 6	; 
                 .equ	SEG015	= 7	; 
                 
                 ; LCDDR0 - LCD Data Register 0
                 .equ	SEG000	= 0	; 
                 .equ	SEG001	= 1	; 
                 .equ	SEG002	= 2	; 
                 .equ	SEG003	= 3	; 
                 .equ	SEG004	= 4	; 
                 .equ	SEG005	= 5	; 
                 .equ	SEG006	= 6	; 
                 .equ	SEG007	= 7	; 
                 
                 
                 ; ***** USI **************************
                 ; USIDR - USI Data Register
                 .equ	USIDR0	= 0	; USI Data Register bit 0
                 .equ	USIDR1	= 1	; USI Data Register bit 1
                 .equ	USIDR2	= 2	; USI Data Register bit 2
                 .equ	USIDR3	= 3	; USI Data Register bit 3
                 .equ	USIDR4	= 4	; USI Data Register bit 4
                 .equ	USIDR5	= 5	; USI Data Register bit 5
                 .equ	USIDR6	= 6	; USI Data Register bit 6
                 .equ	USIDR7	= 7	; USI Data Register bit 7
                 
                 ; USISR - USI Status Register
                 .equ	USICNT0	= 0	; USI Counter Value Bit 0
                 .equ	USICNT1	= 1	; USI Counter Value Bit 1
                 .equ	USICNT2	= 2	; USI Counter Value Bit 2
                 .equ	USICNT3	= 3	; USI Counter Value Bit 3
                 .equ	USIDC	= 4	; Data Output Collision
                 .equ	USIPF	= 5	; Stop Condition Flag
                 .equ	USIOIF	= 6	; Counter Overflow Interrupt Flag
                 .equ	USISIF	= 7	; Start Condition Interrupt Flag
                 
                 ; USICR - USI Control Register
                 .equ	USITC	= 0	; Toggle Clock Port Pin
                 .equ	USICLK	= 1	; Clock Strobe
                 .equ	USICS0	= 2	; USI Clock Source Select Bit 0
                 .equ	USICS1	= 3	; USI Clock Source Select Bit 1
                 .equ	USIWM0	= 4	; USI Wire Mode Bit 0
                 .equ	USIWM1	= 5	; USI Wire Mode Bit 1
                 .equ	USIOIE	= 6	; Counter Overflow Interrupt Enable
                 .equ	USISIE	= 7	; Start Condition Interrupt Enable
                 
                 
                 ; ***** AD_CONVERTER *****************
                 ; ADMUX - The ADC multiplexer Selection Register
                 .equ	MUX0	= 0	; Analog Channel and Gain Selection Bits
                 .equ	MUX1	= 1	; Analog Channel and Gain Selection Bits
                 .equ	MUX2	= 2	; Analog Channel and Gain Selection Bits
                 .equ	MUX3	= 3	; Analog Channel and Gain Selection Bits
                 .equ	MUX4	= 4	; Analog Channel and Gain Selection Bits
                 .equ	ADLAR	= 5	; Left Adjust Result
                 .equ	REFS0	= 6	; Reference Selection Bit 0
                 .equ	REFS1	= 7	; Reference Selection Bit 1
                 
                 ; ADCSRA - The ADC Control and Status register
                 .equ	ADPS0	= 0	; ADC  Prescaler Select Bits
                 .equ	ADPS1	= 1	; ADC  Prescaler Select Bits
                 .equ	ADPS2	= 2	; ADC  Prescaler Select Bits
                 .equ	ADIE	= 3	; ADC Interrupt Enable
                 .equ	ADIF	= 4	; ADC Interrupt Flag
                 .equ	ADATE	= 5	; ADC Auto Trigger Enable
                 .equ	ADSC	= 6	; ADC Start Conversion
                 .equ	ADEN	= 7	; ADC Enable
                 
                 ; ADCH - ADC Data Register High Byte
                 .equ	ADCH0	= 0	; ADC Data Register High Byte Bit 0
                 .equ	ADCH1	= 1	; ADC Data Register High Byte Bit 1
                 .equ	ADCH2	= 2	; ADC Data Register High Byte Bit 2
                 .equ	ADCH3	= 3	; ADC Data Register High Byte Bit 3
                 .equ	ADCH4	= 4	; ADC Data Register High Byte Bit 4
                 .equ	ADCH5	= 5	; ADC Data Register High Byte Bit 5
                 .equ	ADCH6	= 6	; ADC Data Register High Byte Bit 6
                 .equ	ADCH7	= 7	; ADC Data Register High Byte Bit 7
                 
                 ; ADCL - ADC Data Register Low Byte
                 .equ	ADCL0	= 0	; ADC Data Register Low Byte Bit 0
                 .equ	ADCL1	= 1	; ADC Data Register Low Byte Bit 1
                 .equ	ADCL2	= 2	; ADC Data Register Low Byte Bit 2
                 .equ	ADCL3	= 3	; ADC Data Register Low Byte Bit 3
                 .equ	ADCL4	= 4	; ADC Data Register Low Byte Bit 4
                 .equ	ADCL5	= 5	; ADC Data Register Low Byte Bit 5
                 .equ	ADCL6	= 6	; ADC Data Register Low Byte Bit 6
                 .equ	ADCL7	= 7	; ADC Data Register Low Byte Bit 7
                 
                 ; ADCSRB - ADC Control and Status Register B
                 .equ	ADTS0	= 0	; ADC Auto Trigger Source 0
                 .equ	ADTS1	= 1	; ADC Auto Trigger Source 1
                 .equ	ADTS2	= 2	; ADC Auto Trigger Source 2
                 
                 ; DIDR0 - Digital Input Disable Register 0
                 .equ	ADC0D	= 0	; ADC0 Digital input Disable
                 .equ	ADC1D	= 1	; ADC1 Digital input Disable
                 .equ	ADC2D	= 2	; ADC2 Digital input Disable
                 .equ	ADC3D	= 3	; ADC3 Digital input Disable
                 .equ	ADC4D	= 4	; ADC4 Digital input Disable
                 .equ	ADC5D	= 5	; ADC5 Digital input Disable
                 .equ	ADC6D	= 6	; ADC6 Digital input Disable
                 .equ	ADC7D	= 7	; ADC7 Digital input Disable
                 
                 
                 ; ***** BOOT_LOAD ********************
                 ; SPMCSR - Store Program Memory Control Register
                 .equ	SPMCR	= SPMCSR	; For compatibility
                 .equ	SPMEN	= 0	; Store Program Memory Enable
                 .equ	PGERS	= 1	; Page Erase
                 .equ	PGWRT	= 2	; Page Write
                 .equ	BLBSET	= 3	; Boot Lock Bit Set
                 .equ	RWWSRE	= 4	; Read While Write section read enable
                 .equ	ASRE	= RWWSRE	; For compatibility
                 .equ	RWWSB	= 6	; Read While Write Section Busy
                 .equ	ASB	= RWWSB	; For compatibility
                 .equ	SPMIE	= 7	; SPM Interrupt Enable
                 
                 
                 ; ***** USART0 ***********************
                 ; UDR0 - USART I/O Data Register
                 .equ	UDR	= UDR0	; For compatibility
                 .equ	UDR00	= 0	; USART I/O Data Register bit 0
                 .equ	UDR01	= 1	; USART I/O Data Register bit 1
                 .equ	UDR02	= 2	; USART I/O Data Register bit 2
                 .equ	UDR03	= 3	; USART I/O Data Register bit 3
                 .equ	UDR04	= 4	; USART I/O Data Register bit 4
                 .equ	UDR05	= 5	; USART I/O Data Register bit 5
                 .equ	UDR06	= 6	; USART I/O Data Register bit 6
                 .equ	UDR07	= 7	; USART I/O Data Register bit 7
                 
                 ; UCSR0A - USART Control and Status Register A
                 .equ	UCSRA	= UCSR0A	; For compatibility
                 .equ	USR	= UCSR0A	; For compatibility
                 .equ	MPCM0	= 0	; Multi-processor Communication Mode
                 .equ	MPCM	= MPCM0	; For compatibility
                 .equ	U2X0	= 1	; Double the USART Transmission Speed
                 .equ	U2X	= U2X0	; For compatibility
                 .equ	UPE0	= 2	; USART Parity Error
                 .equ	UPE	= UPE0	; For compatibility
                 .equ	DOR0	= 3	; Data OverRun
                 .equ	DOR	= DOR0	; For compatibility
                 .equ	FE0	= 4	; Framing Error
                 .equ	FE	= FE0	; For compatibility
                 .equ	UDRE0	= 5	; USART Data Register Empty
                 .equ	UDRE	= UDRE0	; For compatibility
                 .equ	TXC0	= 6	; USART Transmit Complete
                 .equ	TXC	= TXC0	; For compatibility
                 .equ	RXC0	= 7	; USART Receive Complete
                 .equ	RXC	= RXC0	; For compatibility
                 
                 ; UCSR0B - USART Control and Status Register B
                 .equ	UCSRB	= UCSR0B	; For compatibility
                 .equ	UCR	= UCSR0B	; For compatibility
                 .equ	TXB80	= 0	; Transmit Data Bit 8
                 .equ	TXB8	= TXB80	; For compatibility
                 .equ	RXB80	= 1	; Receive Data Bit 8
                 .equ	RXB8	= RXB80	; For compatibility
                 .equ	UCSZ02	= 2	; Character Size
                 .equ	UCSZ2	= UCSZ02	; For compatibility
                 .equ	TXEN0	= 3	; Transmitter Enable
                 .equ	TXEN	= TXEN0	; For compatibility
                 .equ	RXEN0	= 4	; Receiver Enable
                 .equ	RXEN	= RXEN0	; For compatibility
                 .equ	UDRIE0	= 5	; USART Data Register Empty Interrupt Enable
                 .equ	UDRIE	= UDRIE0	; For compatibility
                 .equ	TXCIE0	= 6	; TX Complete Interrupt Enable
                 .equ	TXCIE	= TXCIE0	; For compatibility
                 .equ	RXCIE0	= 7	; RX Complete Interrupt Enable
                 .equ	RXCIE	= RXCIE0	; For compatibility
                 
                 ; UCSR0C - USART Control and Status Register C
                 .equ	UCSRC	= UCSR0C	; For compatibility
                 .equ	UCPOL0	= 0	; Clock Polarity
                 .equ	UCPOL	= UCPOL0	; For compatibility
                 .equ	UCSZ00	= 1	; Character Size
                 .equ	UCSZ0	= UCSZ00	; For compatibility
                 .equ	UCSZ01	= 2	; Character Size
                 .equ	UCSZ1	= UCSZ01	; For compatibility
                 .equ	USBS0	= 3	; Stop Bit Select
                 .equ	USBS	= USBS0	; For compatibility
                 .equ	UPM00	= 4	; Parity Mode Bit 0
                 .equ	UPM0	= UPM00	; For compatibility
                 .equ	UPM01	= 5	; Parity Mode Bit 1
                 .equ	UPM1	= UPM01	; For compatibility
                 .equ	UMSEL0	= 6	; USART Mode Select
                 .equ	UMSEL	= UMSEL0	; For compatibility
                 
                 ; UBRR0H - USART Baud Rate Register High Byte
                 .equ	UBRRH	= UBRR0H	; For compatibility
                 .equ	UBRR_8	= 0	; USART Baud Rate Register bit 8
                 .equ	UBRR_9	= 1	; USART Baud Rate Register bit 9
                 .equ	UBRR_10	= 2	; USART Baud Rate Register bit 10
                 .equ	UBRR_11	= 3	; USART Baud Rate Register bit 11
                 
                 ; UBRR0L - USART Baud Rate Register Low Byte
                 .equ	UBRRL	= UBRR0L	; For compatibility
                 .equ	UBRR	= UBRR0L	; For compatibility
                 .equ	UBRR_0	= 0	; USART Baud Rate Register bit 0
                 .equ	UBRR_1	= 1	; USART Baud Rate Register bit 1
                 .equ	UBRR_2	= 2	; USART Baud Rate Register bit 2
                 .equ	UBRR_3	= 3	; USART Baud Rate Register bit 3
                 .equ	UBRR_4	= 4	; USART Baud Rate Register bit 4
                 .equ	UBRR_5	= 5	; USART Baud Rate Register bit 5
                 .equ	UBRR_6	= 6	; USART Baud Rate Register bit 6
                 .equ	UBRR_7	= 7	; USART Baud Rate Register bit 7
                 
                 
                 ; ***** PORTG ************************
                 ; PORTG - Port G Data Register
                 .equ	PORTG0	= 0	; 
                 .equ	PG0	= 0	; For compatibility
                 .equ	PORTG1	= 1	; 
                 .equ	PG1	= 1	; For compatibility
                 .equ	PORTG2	= 2	; 
                 .equ	PG2	= 2	; For compatibility
                 .equ	PORTG3	= 3	; 
                 .equ	PG3	= 3	; For compatibility
                 .equ	PORTG4	= 4	; 
                 .equ	PG4	= 4	; For compatibility
                 .equ	PORTG5	= 5	; 
                 .equ	PG5	= 5	; For compatibility
                 
                 ; DDRG - Port G Data Direction Register
                 .equ	DDG0	= 0	; 
                 .equ	DDG1	= 1	; 
                 .equ	DDG2	= 2	; 
                 .equ	DDG3	= 3	; 
                 .equ	DDG4	= 4	; 
                 .equ	DDG5	= 5	; 
                 
                 ; PING - Port G Input Pins
                 .equ	PING0	= 0	; 
                 .equ	PING1	= 1	; 
                 .equ	PING2	= 2	; 
                 .equ	PING3	= 3	; 
                 .equ	PING4	= 4	; 
                 .equ	PING5	= 5	; 
                 
                 
                 ; ***** EXTERNAL_INTERRUPT ***********
                 ; EICRA - External Interrupt Control Register
                 .equ	ISC00	= 0	; External Interrupt Sense Control 0 Bit 0
                 .equ	ISC01	= 1	; External Interrupt Sense Control 0 Bit 1
                 
                 ; EIMSK - External Interrupt Mask Register
                 .equ	INT0	= 0	; External Interrupt Request 0 Enable
                 .equ	PCIE0	= 4	; Pin Change Interrupt Enable 0
                 .equ	PCIE1	= 5	; Pin Change Interrupt Enable 1
                 
                 ; EIFR - External Interrupt Flag Register
                 .equ	INTF0	= 0	; External Interrupt Flag 0
                 .equ	PCIF0	= 4	; Pin Change Interrupt Flag 0
                 .equ	PCIF1	= 5	; Pin Change Interrupt Flag 1
                 
                 ; PCMSK1 - Pin Change Mask Register 1
                 .equ	PCINT8	= 0	; Pin Change Enable Mask 8
                 .equ	PCINT9	= 1	; Pin Change Enable Mask 9
                 .equ	PCINT10	= 2	; Pin Change Enable Mask 10
                 .equ	PCINT11	= 3	; Pin Change Enable Mask 11
                 .equ	PCINT12	= 4	; Pin Change Enable Mask 12
                 .equ	PCINT13	= 5	; Pin Change Enable Mask 13
                 .equ	PCINT14	= 6	; Pin Change Enable Mask 14
                 .equ	PCINT15	= 7	; Pin Change Enable Mask 15
                 
                 ; PCMSK0 - Pin Change Mask Register 0
                 .equ	PCINT0	= 0	; Pin Change Enable Mask 0
                 .equ	PCINT1	= 1	; Pin Change Enable Mask 1
                 .equ	PCINT2	= 2	; Pin Change Enable Mask 2
                 .equ	PCINT3	= 3	; Pin Change Enable Mask 3
                 .equ	PCINT4	= 4	; Pin Change Enable Mask 4
                 .equ	PCINT5	= 5	; Pin Change Enable Mask 5
                 .equ	PCINT6	= 6	; Pin Change Enable Mask 6
                 .equ	PCINT7	= 7	; Pin Change Enable Mask 7
                 
                 
                 ; ***** CPU **************************
                 ; SREG - Status Register
                 .equ	SREG_C	= 0	; Carry Flag
                 .equ	SREG_Z	= 1	; Zero Flag
                 .equ	SREG_N	= 2	; Negative Flag
                 .equ	SREG_V	= 3	; Two's Complement Overflow Flag
                 .equ	SREG_S	= 4	; Sign Bit
                 .equ	SREG_H	= 5	; Half Carry Flag
                 .equ	SREG_T	= 6	; Bit Copy Storage
                 .equ	SREG_I	= 7	; Global Interrupt Enable
                 
                 ; MCUCR - MCU Control Register
                 .equ	IVCE	= 0	; Interrupt Vector Change Enable
                 .equ	IVSEL	= 1	; Interrupt Vector Select
                 .equ	PUD	= 4	; Pull-up disable
                 .equ	BODSE	= 5	; BOD Sleep Enable
                 .equ	BODS	= 6	; BOD Sleep
                 
                 ; MCUSR - MCU Status Register
                 .equ	PORF	= 0	; Power-on reset flag
                 .equ	EXTRF	= 1	; External Reset Flag
                 .equ	BORF	= 2	; Brown-out Reset Flag
                 .equ	WDRF	= 3	; Watchdog Reset Flag
                 ;.equ	JTRF	= 4	; JTAG Reset Flag
                 
                 ; OSCCAL - Oscillator Calibration Value
                 .equ	CAL0	= 0	; Oscillator Calibration Value Bit0
                 .equ	CAL1	= 1	; Oscillator Calibration Value Bit1
                 .equ	CAL2	= 2	; Oscillator Calibration Value Bit2
                 .equ	CAL3	= 3	; Oscillator Calibration Value Bit3
                 .equ	CAL4	= 4	; Oscillator Calibration Value Bit4
                 .equ	CAL5	= 5	; Oscillator Calibration Value Bit5
                 .equ	CAL6	= 6	; Oscillator Calibration Value Bit6
                 .equ	CAL7	= 7	; Oscillator Calibration Value Bit7
                 
                 ; CLKPR - Clock Prescale Register
                 .equ	CLKPS0	= 0	; Clock Prescaler Select Bit 0
                 .equ	CLKPS1	= 1	; Clock Prescaler Select Bit 1
                 .equ	CLKPS2	= 2	; Clock Prescaler Select Bit 2
                 .equ	CLKPS3	= 3	; Clock Prescaler Select Bit 3
                 .equ	CLKPCE	= 7	; Clock Prescaler Change Enable
                 
                 ; PRR - Power Reduction Register
                 .equ	PRADC	= 0	; Power Reduction ADC
                 .equ	PRUSART0	= 1	; Power Reduction USART
                 .equ	PRSPI	= 2	; Power Reduction Serial Peripheral Interface
                 .equ	PRTIM1	= 3	; Power Reduction Timer/Counter1
                 .equ	PRLCD	= 4	; Power Reduction LCD
                 
                 ; SMCR - Sleep Mode Control Register
                 .equ	SE	= 0	; Sleep Enable
                 .equ	SM0	= 1	; Sleep Mode Select bit 0
                 .equ	SM1	= 2	; Sleep Mode Select bit 1
                 .equ	SM2	= 3	; Sleep Mode Select bit 2
                 
                 ; GPIOR2 - General Purpose IO Register 2
                 .equ	GPIOR20	= 0	; General Purpose IO Register 2 bit 0
                 .equ	GPIOR21	= 1	; General Purpose IO Register 2 bit 1
                 .equ	GPIOR22	= 2	; General Purpose IO Register 2 bit 2
                 .equ	GPIOR23	= 3	; General Purpose IO Register 2 bit 3
                 .equ	GPIOR24	= 4	; General Purpose IO Register 2 bit 4
                 .equ	GPIOR25	= 5	; General Purpose IO Register 2 bit 5
                 .equ	GPIOR26	= 6	; General Purpose IO Register 2 bit 6
                 .equ	GPIOR27	= 7	; General Purpose IO Register 2 bit 7
                 
                 ; GPIOR1 - General Purpose IO Register 1
                 .equ	GPIOR10	= 0	; General Purpose IO Register 1 bit 0
                 .equ	GPIOR11	= 1	; General Purpose IO Register 1 bit 1
                 .equ	GPIOR12	= 2	; General Purpose IO Register 1 bit 2
                 .equ	GPIOR13	= 3	; General Purpose IO Register 1 bit 3
                 .equ	GPIOR14	= 4	; General Purpose IO Register 1 bit 4
                 .equ	GPIOR15	= 5	; General Purpose IO Register 1 bit 5
                 .equ	GPIOR16	= 6	; General Purpose IO Register 1 bit 6
                 .equ	GPIOR17	= 7	; General Purpose IO Register 1 bit 7
                 
                 ; GPIOR0 - General Purpose IO Register 0
                 .equ	GPIOR00	= 0	; General Purpose IO Register 0 bit 0
                 .equ	GPIOR01	= 1	; General Purpose IO Register 0 bit 1
                 .equ	GPIOR02	= 2	; General Purpose IO Register 0 bit 2
                 .equ	GPIOR03	= 3	; General Purpose IO Register 0 bit 3
                 .equ	GPIOR04	= 4	; General Purpose IO Register 0 bit 4
                 .equ	GPIOR05	= 5	; General Purpose IO Register 0 bit 5
                 .equ	GPIOR06	= 6	; General Purpose IO Register 0 bit 6
                 .equ	GPIOR07	= 7	; General Purpose IO Register 0 bit 7
                 
                 
                 
                 ; ***** LOCKSBITS ********************************************************
                 .equ	LB1	= 0	; Lock bit
                 .equ	LB2	= 1	; Lock bit
                 .equ	BLB01	= 2	; Boot Lock bit
                 .equ	BLB02	= 3	; Boot Lock bit
                 .equ	BLB11	= 4	; Boot lock bit
                 .equ	BLB12	= 5	; Boot lock bit
                 
                 
                 ; ***** FUSES ************************************************************
                 ; LOW fuse bits
                 .equ	CKSEL0	= 0	; Select Clock Source
                 .equ	CKSEL1	= 1	; Select Clock Source
                 .equ	CKSEL2	= 2	; Select Clock Source
                 .equ	CKSEL3	= 3	; Select Clock Source
                 .equ	SUT0	= 4	; Select start-up time
                 .equ	SUT1	= 5	; Select start-up time
                 .equ	CKOUT	= 6	; Oscillator options
                 .equ	CKDIV8	= 7	; Divide clock by 8
                 
                 ; HIGH fuse bits
                 .equ	BOOTRST	= 0	; Select Reset Vector
                 .equ	BOOTSZ0	= 1	; Select Boot Size
                 .equ	BOOTSZ1	= 2	; Select Boot Size
                 .equ	EESAVE	= 3	; EEPROM memory is preserved through chip erase
                 .equ	WDTON	= 4	; Watchdog timer always on
                 .equ	SPIEN	= 5	; Enable Serial programming and Data Downloading
                 .equ	JTAGEN	= 6	; Enable JTAG
                 .equ	OCDEN	= 7	; Enable OCD
                 
                 ; EXTENDED fuse bits
                 .equ	RSTDISBL	= 0	; Disable external reset
                 .equ	BODLEVEL0	= 1	; Brown-out Detector trigger level
                 .equ	BODLEVEL1	= 2	; Brown-out Detector trigger level
                 .equ	BODLEVEL2	= 3	; Brown out detector trigger level
                 
                 
                 
                 ; ***** CPU REGISTER DEFINITIONS *****************************************
                 .def	XH	= r27
                 .def	XL	= r26
                 .def	YH	= r29
                 .def	YL	= r28
                 .def	ZH	= r31
                 .def	ZL	= r30
                 
                 
                 
                 ; ***** DATA MEMORY DECLARATIONS *****************************************
                 .equ	FLASHEND	= 0x1fff	; Note: Word address
                 .equ	IOEND	= 0x00ff
                 .equ	SRAM_START	= 0x0100
                 .equ	SRAM_SIZE	= 1024
                 .equ	RAMEND	= 0x04ff
                 .equ	XRAMEND	= 0x0000
                 .equ	E2END	= 0x01ff
                 .equ	EEPROMEND	= 0x01ff
                 .equ	EEADRBITS	= 9
                 #pragma AVRPART MEMORY PROG_FLASH 16384
                 #pragma AVRPART MEMORY EEPROM 512
                 #pragma AVRPART MEMORY INT_SRAM SIZE 1024
                 #pragma AVRPART MEMORY INT_SRAM START_ADDR 0x100
                 
                 
                 
                 ; ***** BOOTLOADER DECLARATIONS ******************************************
                 .equ	NRWW_START_ADDR	= 0x1c00
                 .equ	NRWW_STOP_ADDR	= 0x1fff
                 .equ	RWW_START_ADDR	= 0x0
                 .equ	RWW_STOP_ADDR	= 0x1bff
                 .equ	PAGESIZE	= 64
                 .equ	FIRSTBOOTSTART	= 0x1f80
                 .equ	SECONDBOOTSTART	= 0x1f00
                 .equ	THIRDBOOTSTART	= 0x1e00
                 .equ	FOURTHBOOTSTART	= 0x1c00
                 .equ	SMALLBOOTSTART	= FIRSTBOOTSTART
                 .equ	LARGEBOOTSTART	= FOURTHBOOTSTART
                 
                 
                 
                 ; ***** INTERRUPT VECTORS ************************************************
                 .equ	INT0addr	= 0x0002	; External Interrupt Request 0
                 .equ	PCI0addr	= 0x0004	; Pin Change Interrupt Request 0
                 .equ	PCI1addr	= 0x0006	; Pin Change Interrupt Request 1
                 .equ	OC2addr	= 0x0008	; Timer/Counter2 Compare Match
                 .equ	OVF2addr	= 0x000a	; Timer/Counter2 Overflow
                 .equ	ICP1addr	= 0x000c	; Timer/Counter1 Capture Event
                 .equ	OC1Aaddr	= 0x000e	; Timer/Counter1 Compare Match A
                 .equ	OC1Baddr	= 0x0010	; Timer/Counter Compare Match B
                 .equ	OVF1addr	= 0x0012	; Timer/Counter1 Overflow
                 .equ	OC0addr	= 0x0014	; Timer/Counter0 Compare Match
                 .equ	OVF0addr	= 0x0016	; Timer/Counter0 Overflow
                 .equ	SPIaddr	= 0x0018	; SPI Serial Transfer Complete
                 .equ	URXC0addr	= 0x001a	; USART0, Rx Complete
                 .equ	URXCaddr	= 0x001a	; For compatibility
                 .equ	UDRE0addr	= 0x001c	; USART0 Data register Empty
                 .equ	UDREaddr	= 0x001c	; For compatibility
                 .equ	UTXC0addr	= 0x001e	; USART0, Tx Complete
                 .equ	UTXCaddr	= 0x001e	; For compatibility
                 .equ	USI_STARTaddr	= 0x0020	; USI Start Condition
                 .equ	USI_OVFaddr	= 0x0022	; USI Overflow
                 .equ	ACIaddr	= 0x0024	; Analog Comparator
                 .equ	ADCCaddr	= 0x0026	; ADC Conversion Complete
                 .equ	ERDYaddr	= 0x0028	; EEPROM Ready
                 .equ	SPMRaddr	= 0x002a	; Store Program Memory Read
                 .equ	LCDSFaddr	= 0x002c	; LCD Start of Frame
                 
                 .equ	INT_VECTORS_SIZE	= 46	; size in words
                 
                 #endif  /* _M169PADEF_INC_ */
                 
                 ; ***** END OF FILE ******************************************************
                 
                  * Sparmatic_V3_Thermostat_M169PA_ATM6.asm
                  *
                  *  Created: 20.01.2015 20:07:00
                  *   Author: TrR_KB
                  */ 
                 
                 
                 .include "Def_Equ.inc"					;definition file
                 
                 .def	SREG_Save		=r3
                 .def	MotPWMCT		=r4
                 
                 .def	Prescaler1		=r7
                 .def	Ch0				=r8
                 .def	Ch1				=r9
                 .def	Ch2				=r10
                 
                 .def	Di0				=r12
                 .def	Di1				=r13
                 .def	Di2				=r14
                 .def	Di3				=r15
                 
                 .def	Temp			=r16
                 .def	TempH			=r17
                 .def	Temp5			=r18
                 .def	ButtonDebounce	=r19
                 .def	MenuID			=r20
                 .def	TemperatureMode	=r21
                 .def	ActiveCT		=r22
                 
                 .def	Temp3			=r24
                 .def	Temp4			=r25
                 
                 
                 
                 
                 
                 ;internal NTC sensor
                 .equ	Internal_NTC_Port	=PortF
                 .equ	Internal_NTC_DDR	=DDRF
                 .equ	Internal_NTC_On		=3
                 
                 ;LCD backlight (optional)
                 .equ	BacklightPort		=PortE
                 .equ	Backlight_On		=5
                 
                 ;Reflex optocoupler
                 .equ	LightSensPort		=PortE
                 .equ	LightSensPin		=PinE
                 .equ	LightSens_LED		=2
                 .equ	LightSens_Trans		=3
                 
                 ;Motor full bridge
                 .equ	MotorPort			=PortE
                 .equ	MotorDDR			=DDRE
                 .equ	Motor_Close			=6
                 .equ	Motor_Open			=7
                 
                 
                 ;Buttons:
                 .equ	_OK_Button			=4
                 .equ	_Menu_Button		=1
                 .equ	_Time_Button		=2
                 
                 
                 ;external interface
                 .equ	IO_Port		=PORTB
                 .equ	IO_DDR		=DDRB
                 .equ	IO_PIN		=PINB
                 .equ	IO_SCK		=3
                 .equ	IO_SDATA	=2
                 
                 
                 ;Status0 Flagregister
                 .equ	Status0		=GPIOR0
                 .equ	_MotOn		=0
                 .equ	_MotDir		=1
                 .equ	_MotRun		=2
                 .equ	_Adapt		=3
                 .equ	_NewButton	=4
                 .equ	_MenuUpDn	=5
                 .equ	_MenuOn		=6
                 .equ	_MenuWork	=7
                 
                 
                 ;Status1
                 .equ	Status1			=GPIOR1
                 .equ	_IO_Receive		=0
                 .equ	_AutoManu		=1
                 .equ	_Descale		=2
                 .equ	_DST_OnOff		=3
                 .equ	_NewTemp		=4
                 .equ	_SecondTick		=7
                 
                 
                 ;Flags only used in Main
                 ;Status2
                 .equ	Status2			=GPIOR2
                 .equ	_NewTempMode	=1
                 .equ	_FastModeScan	=2
                 .equ	_IO_Running		=3
                 
                 
                 ;UserSettings1_Bits
                 .equ	_ValveInverse		=0
                 .equ	_ExternalTempSensor	=1
                 .equ	_Holiday			=2
                 .equ	_2ndHoliday			=3
                 
                 
                 ;MotTimeOut status bits
                 .equ	_BotLimit			=6
                 .equ	_TopLimit			=7
                 
                 
                 ;Fuzzy Variable:
                 .equ	FuzzOK				=$00	;00
                 .equ	FuzzWarm			=$04	;04
                 .equ	FuzzHot				=$08	;08
                 .equ	FuzzCool			=$0C	;12
                 .equ	FuzzCold			=$10	;16
                 .equ	FuzzAbove			=$14	;20
                 .equ	FuzzBelow			=$18	;24
                 
                 
                 .equ	TStatic				=$00
                 .equ	TRise				=$01
                 .equ	TFall				=$02
                 
                 .equ	NoTempMode			=0
                 .equ	InHouseMode			=1
                 .equ	OffHouseMode		=2
                 .equ	NightMode			=3
                 
                 
                 .equ	MaxAdaptWay			=380
                 
                 .equ	Block1_5			=7
                 .equ	Block1_6			=8
                 .equ	Block1_7			=9
                 .equ	BlockHoliday1		=10
                 .equ	BlockHoliday2		=11
                 
                 .equ	FW_Version			=007
                 
                 
                 ;Symbol Definition
                 .equ	LCD_HourBar_CLR		=$00
                 .equ	LCD_HourBar_SET		=$80
                 .equ	LCD_Auto_CLR		=$01
                 .equ	LCD_Auto_SET		=$81
                 .equ	LCD_Manu_CLR		=$02
                 .equ	LCD_Manu_SET		=$82
                 .equ	LCD_Case_CLR		=$03
                 .equ	LCD_Case_SET		=$83
                 .equ	LCD_Tower_CLR		=$04
                 .equ	LCD_Tower_SET		=$84
                 .equ	LCD_InHouse_CLR		=$05
                 .equ	LCD_InHouse_SET		=$85
                 .equ	LCD_OffHouse_CLR	=$06
                 .equ	LCD_OffHouse_SET	=$86
                 .equ	LCD_Moon_CLR		=$07
                 .equ	LCD_Moon_SET		=$87
                 .equ	LCD_Star_CLR		=$08
                 .equ	LCD_Star_SET		=$88
                 .equ	LCD_Battery_CLR		=$09
                 .equ	LCD_Battery_SET		=$89
                 .equ	LCD_Lock_CLR		=$0A
                 .equ	LCD_Lock_SET		=$8A
                 
                 .equ	LCD_Mo_CLR			=$00
                 .equ	LCD_Mo_SET			=$80
                 .equ	LCD_Di_CLR			=$01
                 .equ	LCD_Di_SET			=$81
                 .equ	LCD_Mi_CLR			=$02
                 .equ	LCD_Mi_SET			=$82
                 .equ	LCD_Do_CLR			=$03
                 .equ	LCD_Do_SET			=$83
                 .equ	LCD_Fr_CLR			=$04
                 .equ	LCD_Fr_SET			=$84
                 .equ	LCD_Sa_CLR			=$05
                 .equ	LCD_Sa_SET			=$85
                 .equ	LCD_So_CLR			=$06
                 .equ	LCD_So_SET			=$86
                 
                 
                 
                 .dseg
                 ;SRAM
                 .org $0100
000100           TempIntL:					.Byte 1
000101           TempIntH:					.Byte 1
000102           TempIntOldL:				.Byte 1
000103           TempIntOldH:				.Byte 1
000104           DeltaTemp1:					.Byte 1
000105           DeltaTemp2:					.Byte 1
000106           NTCIntL:					.Byte 1
000107           NTCIntH:					.Byte 1
000108           IO_BitCT:					.Byte 1
000109           IO_ByteCT:					.Byte 1
00010a           IO_Data:					.Byte 1
00010b           IO_DataBuffer:				.Byte 1
00010c           IO_Timeout:					.Byte 1
00010d           Buttons:					.Byte 1
00010e           OldButtons:					.Byte 1
00010f           RotaryTemp:					.Byte 1
000110           Rotary:						.Byte 1
000111           RFLXCTL:					.Byte 1
000112           RFLXCTH:					.Byte 1
000113           PositionL:					.Byte 1
000114           PositionH:					.Byte 1
000115           ValveTopL:					.Byte 1
000116           ValveTopH:					.Byte 1
000117           MotTimeOut:					.Byte 1
000118           AdaptStep:					.Byte 1
000119           MotorCurrent:				.Byte 1
00011a           FreeMotorCurrent:			.Byte 1
00011b           ValveMotorCurrent:			.Byte 1
00011c           DebugAddress:				.Byte 1
00011d           ADCPrescaler:				.Byte 1
00011e           Seconds:					.Byte 1
00011f           Minutes:					.Byte 1
000120           Hours:						.Byte 1
000121           Days:						.Byte 1
000122           Months:						.Byte 1
000123           Years:						.Byte 1
000124           WDays:						.Byte 1
000125           UserDisplay:				.Byte 1
000126           iNTCVL:						.Byte 1
000127           iNTCVH:						.Byte 1
000128           PSC1:						.Byte 1
000129           SetTempL:					.Byte 1
00012a           SetTempH:					.Byte 1
00012b           EkL:						.Byte 1
00012c           EkH:						.Byte 1
00012d           RegWay:						.Byte 1
00012e           DisplayCT:					.Byte 1
00012f           BeepCT:						.Byte 1
000130           BeepLen:					.Byte 1
000131           BeepPulseCT:				.Byte 1
000132           MenuLow:					.Byte 1
000133           MenuHigh:					.Byte 1
000134           DispTimer:					.Byte 1
000135           OldBarBlink:				.Byte 1
000136           BarBaseL:					.Byte 1
000137           BarBaseH:					.Byte 1
000138           FuzzyVal:					.Byte 1
000139           BatteryVoltageL:			.Byte 1
00013a           BatteryVoltageH:			.Byte 1
00013b           TempModeOld:				.Byte 1
00013c           Radio_RXTimeslot:			.Byte 1
                 
00013d           UserSettings1:				.Byte 1
                 
00013e           InHouseTempL:				.Byte 1
00013f           InHouseTempH:				.Byte 1
000140           OffHouseTempL:				.Byte 1
000141           OffHouseTempH:				.Byte 1
000142           NightTempL:					.Byte 1
000143           NightTempH:					.Byte 1
000144           WindowOpenTempL:			.Byte 1
000145           WindowOpenTempH:			.Byte 1
                 
                 
                 
000146           DisplayBuffer1:				.Byte 20
00015a           DisplayBuffer2:				.Byte 20
                 
00016e           DailyTimer:					.Byte 108			;9 timers for each day (Hot,Cold,Hot,Cold,Hot,Cold,Hot,Cold,Night) // 7 days / 1-5 / 1-6 / 1-7 / Holiday1 / Holiday2
                 
                 
0001da           ExternalDataBuffer:			.Byte 32
                 
                 
                 
                 
                 ;EEPROM:
                 .eseg
                 .org 0x0000
000000            EE_DailyTimer:					.Byte 108
                 
                 .org	0x00E0
0000e0            Minutes_EE:					.Byte 1
0000e1            Hours_EE:						.Byte 1
0000e2            Days_EE:						.Byte 1
0000e3            Months_EE:						.Byte 1
0000e4            Years_EE:						.Byte 1
0000e5            EE_Temperatures:				.Byte 6
                 
                 
                 .org	0x0100									;parameter block
                  
                 
                 
                 
                 .include "Init.inc"						;initialisation file
                 
                 .cseg
                 ;Interruptvektoren 
                 .org    $0000	
000000 940c 0030  jmp	RESET				;Reset					0000		
000002 940c 0030  jmp	RESET				;Int0					0002		
000004 940c 1140  jmp	PinChange0			;PCInt0					0004		
000006 940c 1189  jmp	PinChange1			;PCInt1					0006		
000008 940c 0030  jmp	RESET				;T2Comp					0008
00000a 940c 11d6  jmp	SystemTime			;T2Ov					000A
00000c 940c 0030  jmp	RESET				;T1ICP					000C
00000e 940c 0030  jmp	RESET				;T1CompA				000E
000010 940c 0030  jmp	RESET				;T1CompB				0010
000012 940c 0030  jmp	RESET				;T1Ov					0012
000014 940c 110e  jmp	T0_CMP				;T0Comp					0014
000016 940c 0030  jmp	RESET				;T0Ov					0016
000018 940c 0030  jmp	RESET				;SPI_STC				0018		
00001a 940c 0030  jmp	RESET				;USART_RXC				001A
00001c 940c 0030  jmp	RESET				;USART_DRE				001C
00001e 940c 0030  jmp	RESET				;USART_TXC				001E
000020 940c 0030  jmp	RESET				;USI_Start				0020
000022 940c 0030  jmp	RESET				;USI_Ovw				0022
000024 940c 0030  jmp	RESET				;ANA_Comp				0024
000026 940c 0030  jmp	RESET				;ADC_CC					0026
000028 940c 0030  jmp	RESET				;EE_RDY					0028
00002a 940c 0030  jmp	RESET				;SPM_RDY				002A	
00002c 940c 11ac  jmp	LCD_FrameInt		;LCD_Start of Frame		002C
                 
00002e 18f3
00002f c94b      .db 0xF3, 0x18, 0x4B, 0xC9
                 
                  
                 RESET:
000030 94f8       cli								;Interrupts global ausschalten
                  
                 
                 ;initialise Stackpointer
000031 e004       ldi 	Temp, high(RAMEND)		
000032 bf0e       out 	SPH, Temp
000033 ef0f       ldi 	Temp, low(RAMEND)
000034 bf0d       out 	SPL, Temp
                 
000035 2422       clr	Null
                 
                 
                 ;Initialising Ports
                 
                 ;(-)							Sniffer	   Debug1	  Debug2	 (+)
                 ;RotaryA  "OK"  "MENU"  "TIME"  MISO/USB2  MOSI/USB3  SCK/USB4  RotaryB
000036 e002       ldi	Temp,  0b00000010
000037 ef1d       ldi	TempH, 0b11111101
000038 b904       out	DDRB, Temp
000039 b915       out	PortB, TempH
                 
                  
                 ;MotorA  MotorB  1M_0V  ----  RFLX_in  REFLX_on  ----  ----
00003a e004       ldi	Temp,  0b00000100
00003b e113       ldi	TempH, 0b00010011
00003c b90d       out	DDRE, Temp
00003d b91e       out	PortE, TempH
                 
                 
                 ;JTAG TDI  JTAG TDO  JTAG TMS  JTAG TCK  Int_NTC_on  MOT_Cur  Int_NTC  RFLX_ADC
00003e e000       ldi	Temp,  0b00000000
00003f ef10       ldi	TempH, 0b11110000
000040 bb00       out	DDRF, Temp
000041 bb11       out	PortF, TempH
                 
000042 e00f       ldi	Temp, 0b00001111
000043 9300 007e  sts	DIDR0, Temp
                 
000045 e00e       ldi	Temp, (1<<PRTIM1) | (1<<PRSPI) | (1<<PRUSART0)					;disable Timer1, SPI and UART
000046 9300 0064  sts	PRR, Temp
                 
                  ;clear SRAM variables 
000048 e0b1       ldi	XH, $01
000049 e0a0       ldi	XL, $00
                  
                 _CLSR:
00004a 922d       st		X+, Null
00004b 30b4       cpi	XH, $04
00004c f7e9       brne	_CLSR
                 
                 
                  
                 
                 ;setup LCD-Controller
00004d eb07       ldi	Temp, (1<<LCDCS) | (3<<LCDMUX0) | (7<<LCDPM0)
00004e 9300 00e5  sts	LCDCRB, Temp
000050 e003       ldi	Temp, (0<<LCDPS0) | (3<<LCDCD0)		;64Hz @ 32768Khz
000051 9300 00e6  sts	LCDFRR, Temp
000053 ee0e       ldi	Temp, (1<<LCDDC2) | (1<<LCDDC1) | (1<<LCDDC0) | (1<<LCDCC3) | (1<<LCDCC2) | (0<<LCDCC1) | (1<<LCDCC1)		;Contrast setting: drivers 50% on, 3.25Vlcd
000054 9300 00e7  sts	LCDCCR, Temp
000056 ec08       ldi	Temp, (1<<LCDEN) | (1<<LCDIE) | (1<<LCDAB)		;enable LCD controller, LCD-Frame Interrupt, low power waveform
000057 9300 00e4  sts	LCDCRA, Temp
                  
000059 e063       ldi	ActiveCT, 3
                 
                 
                 
                 ;setup ADC
00005a e401       ldi	Temp, 0b01000001				;AVcc as reference, channel2, iNTCon
00005b 9300 007c  sts	ADMUX, Temp
00005d e103       ldi	Temp, 0b00010011				;Prescaler 8, 62.5kHz
00005e 9300 007a  sts	ADCSRA, Temp
000060 e007       ldi	Temp, 0b00000111
000061 9300 007e  sts	DIDR0, Temp
                 
                 
                 ;setup PinChange for Buttons and Rotary encoder:
000063 ef01       ldi	Temp, 0b11110001
000064 9300 006c  sts	PCMSK1, Temp
                 
                 ;setup PinChange for Reflex coupler 
000066 e008       ldi	Temp, 0b00001000
000067 9300 006b  sts	PCMSK0, Temp
                  
000069 e300       ldi	Temp, (1<<PCIE1) | (1<<PCIE0)			;enable pin change on PCINT15...8 // PCINT7...0
00006a bb0d       out	EIMSK, Temp
                 
                 
                 ;setup timer0 for sound
00006b e009       ldi	Temp, 0b00001001						;CTC, prescaler 1
00006c bd04       out	TCCR0A, Temp
00006d e000       ldi	Temp, 0
00006e bd07       out	OCR0A, Temp
                 
                  
                 ;setup Timer2 for SystemTime
00006f e003       ldi	Temp, (0<<CS22)| (1<<CS21) | (1<<CS20)	;Normal mode, prescaler 32
000070 9300 00b0  sts	TCCR2A, Temp
000072 e001       ldi	Temp, (1<<TOIE2)						;Overflow interrupt T2_A enabled
000073 9300 0070  sts	TIMSK2, Temp 
000075 e008       ldi	Temp, (1<<AS2)
000076 9300 00b6  sts	ASSR, Temp
                  
                 ;initialising variables
000078 2477       clr	Prescaler1
000079 e004       ldi	Temp, 4
00007a 9300 0128  sts	PSC1, Temp								;init prescaler1 interval (default 4)
                  
                  /*ldi	Temp, 40
                  sts	ADCPrescaler, Temp*/
                 
00007c ef0f       ser	Temp									;disable IO_interface (write 0xFF to BitCT)
00007d 9300 0108  sts	IO_BitCT, Temp
                 
                 
00007f ec08       ldi	Temp, 200								;init Set Temperature to 20.0C
000080 9300 0129  sts	SetTempL, Temp
000082 9220 012a  sts	SetTempH, Null
                 
000084 9875       cbi	BacklightPort, Backlight_On
                 
000085 d16e       rcall	ReadEEProm2Timers
000086 d153       rcall	ReadBack_Time
000087 d186       rcall	ReadEEProm2Temperatures
                 
                 
000088 9100 013d  lds	Temp, UserSettings1						
00008a 7f0d       cbr	Temp, (1<<_ExternalTempSensor)			;"sbr" activates external sensor acqusition
00008b 9300 013d  sts	UserSettings1, Temp
                  
00008d 9478       sei											;global interrupt enable
                 
                 //End of file//
                 
00008e d18a       rcall	StartMain						;sound
                 
                 
                 MainLoop:
00008f d734       rcall	Adaptation
                  
000090 9bf3       sbis	Status0, _Adapt					;dont execute in adaptation mode
000091 d468       rcall	Show_Current_Temperature
                   
000092 9bf3       sbis	Status0, _Adapt					;dont execute in adaptation mode
000093 d4bd       rcall	Show_Current_Time
                  
000094 9bf3       sbis	Status0, _Adapt					;dont execute in adaptation mode
000095 940e 097a  call	User_Action
                  
000097 9bf3       sbis	Status0, _Adapt					;dont execute in adaptation mode
000098 d082       rcall	Timer2Mode
                 
000099 9bf3       sbis	Status0, _Adapt					;dont execute in adaptation mode
00009a d0e4       rcall	Mode2SetTemperature
                  
00009b 9bf3       sbis	Status0, _Adapt					;dont execute in adaptation mode
00009c d19a       rcall	Calc_Temperature
                 
00009d 9a75       sbi	PORTE, 5
00009e 940e 08b4  call	MotorControl
0000a0 940e 126d  call	Clock
0000a2 d548       rcall	Copy_DisplayBuffers 
                 
0000a3 9965       sbic	PinE, 5									;BatteryTestPin
0000a4 940c 1168  jmp	RapidShutOff							;if set, immediately save clock and go to sleep 
0000a6 9875       cbi	PORTE, 5
                 
0000a7 9100 013d  lds	Temp, UserSettings1
0000a9 fd01       sbrc	Temp, _ExternalTempSensor
0000aa d011       rcall	IO_Interface					
                 
                 
                  GoSleep:
0000ab b50b       in		Temp, Status2						;dont sleep while communicating externally
0000ac fd03       sbrc	Temp, _IO_Running
0000ad cfe1       rjmp	MainLoop
                   
0000ae 3060       cpi	ActiveCT, 0							;do not disable pullups in active mode
0000af f421       brne	_GS1  
                  
0000b0 b103       in		Temp, PinB							;read button state before entering sleep
0000b1 7801       andi	Temp, 0b10000001					;any rotary pin that is connected to GND, disable corresponding pullup to save power (~150A worst case)
0000b2 670c       ori	Temp, 0b01111100					;leave button and SPI pullups on
0000b3 b905       out	PortB, Temp						
                   
                 _GS1:
                  ;cbi	DebugPort, Debug1
0000b4 e007       ldi	Temp, (1<<SM1) | (1<<SM0) | (1<<SE)	;Power save sleep mode
0000b5 bf03       out	SMCR, Temp
                 
0000b6 9588       sleep
                  
0000b7 9a2f       sbi	PortB, 7							;re-enable rotary pullups
0000b8 9a28       sbi	PortB, 0
                   
0000b9 e006       ldi	Temp, (1<<SM1) | (1<<SM0) | (0<<SE)	;disable sleep
0000ba bf03       out	SMCR, Temp
                  ;sbi	DebugPort, Debug1
                 
0000bb cfd3       rjmp	MainLoop
                 
                 
                 
                 ;----------------------------------------------
                 IO_Interface:
0000bc b50a       in		Temp, Status1						;if one data byte is received, execute routine
0000bd ff00       sbrs	Temp, _IO_Receive
0000be 9508       ret
                  
0000bf b50b       in		Temp, Status2						;if routine is called before starting the interface, exit
0000c0 ff03       sbrs	Temp, _IO_Running
0000c1 c00e       rjmp	_IO_Off
                 
                  
                 _IO_GetData:
0000c2 edaa       ldi	XL, low(ExternalDataBuffer)
0000c3 e0b1       ldi	XH, high(ExternalDataBuffer)
0000c4 9110 0109  lds	TempH, IO_ByteCT						
0000c6 0fa1       add	XL, TempH
0000c7 1db2       adc	XH, Null
                 
0000c8 9100 010b  lds	Temp, IO_DataBuffer
0000ca 930c       st		X, Temp
0000cb 9513       inc	TempH
0000cc 9310 0109  sts	IO_ByteCT, TempH
0000ce 3210       cpi	TempH, 32						
0000cf f031       breq	_IO_FrameComplete					;if data is completely read, end routine
                 
                 
                 _IO_Off:
0000d0 94f8       cli
0000d1 b50a       in		Temp, Status1
0000d2 7f0e       cbr	Temp, (1<<_IO_Receive)				;clear IO receive flag
0000d3 bd0a       out	Status1, Temp
0000d4 9478       sei 
0000d5 9508       ret
                 
                  
                 _IO_FrameComplete:
0000d6 b50b       in		Temp, Status2
0000d7 7f07       cbr	Temp, (1<<_IO_Running)				;stop interface
0000d8 bd0b       out	Status2, Temp
                 
0000d9 ef01       ldi	Temp, 0b11110001					;disable IO_clock as pin change interrupt
0000da 9300 006c  sts	PCMSK1, Temp
                  
0000dc 9100 01da  lds	Temp, ExternalDataBuffer			;process received data: filter packet type
0000de 3001       cpi	Temp, 0x01
0000df f009       breq	_IO_DataPacket
0000e0 c008       rjmp	_IO_End
                 
                 
                 _IO_DataPacket:  
0000e1 9100 01db  lds	Temp, ExternalDataBuffer+1			;store received data as temperature value
0000e3 9300 0100  sts	TempIntL, Temp
0000e5 9100 01dc  lds	Temp, ExternalDataBuffer+2
0000e7 9300 0101  sts	TempIntH, Temp
                  
                 
                 _IO_End:
0000e9 9100 0148  lds	Temp, DisplayBuffer1+2				;clear tower symbol
0000eb 770f       andi	Temp, 0b01111111
0000ec 9300 0148  sts	DisplayBuffer1+2, Temp
0000ee 9100 015c  lds	Temp, DisplayBuffer2+2					
0000f0 770f       andi	Temp, 0b01111111
0000f1 9300 015c  sts	DisplayBuffer2+2, Temp
                  
0000f3 ee0e       ldi	Temp, 238
0000f4 9300 013c  sts	Radio_RXTimeslot, Temp
0000f6 cfd9       rjmp	_IO_Off
                 
                 
                 
                 ;---------------
                 START_IO:
0000f7 9a23       sbi	IO_DDR, IO_SCK						;send WakeUp pulse to slave: set clock pin to output
0000f8 0000       nop
0000f9 982b       cbi	IO_PORT, IO_SCK						;transmit low pulse
0000fa 0000       nop
0000fb 0000       nop
0000fc 0000       nop
0000fd 0000       nop
0000fe 0000       nop
0000ff 0000       nop
000100 0000       nop
000101 0000       nop
000102 9a2b       sbi	IO_PORT, IO_SCK
000103 0000       nop
000104 0000       nop
000105 9823       cbi	IO_DDR, IO_SCK	 					;set clock pin to input, leave pullup on
                  
000106 b50b       in		Temp, Status2
000107 6008       sbr	Temp, (1<<_IO_Running)				;start interface
000108 bd0b       out	Status2, Temp
                  
000109 9220 0108  sts	IO_BitCT, Null
00010b 9220 0109  sts	IO_ByteCT, Null
                 
00010d ef09       ldi	Temp, 0b11111001					;enable IO_clock as pin change interrupt
00010e 9300 006c  sts	PCMSK1, Temp
                  
000110 9100 0148  lds	Temp, DisplayBuffer1+2				;set tower symbol
000112 6800       ori	Temp, 0b10000000
000113 9300 0148  sts	DisplayBuffer1+2, Temp
000115 9100 015c  lds	Temp, DisplayBuffer2+2					
000117 6800       ori	Temp, 0b10000000
000118 9300 015c  sts	DisplayBuffer2+2, Temp
00011a 9508       ret
                 
                 
                   
                 ;-------------------------------------------
                 Timer2Mode:
00011b b50a       in		Temp, Status1
00011c fd01       sbrc	Temp, _AutoManu							;no timer check in manual mode 
00011d 9508       ret
                 
00011e 99f6       sbic	Status0, _MenuOn						;no timer check if a menu is active
00011f 9508       ret
                 
000120 b50b       in		Temp, Status2
000121 fd02       sbrc	Temp, _FastModeScan						;do timer compares immediately, if fastmodescan flag is set
000122 c00c       rjmp	_T2SetTemp0
                  
000123 9100 011e  lds	Temp, Seconds							;do timer compares only on first of ten Minutes and on first second
000125 3000       cpi	Temp, 0
000126 f009       breq	_T2SetTemp
000127 9508       ret
                  
                 _T2SetTemp:
000128 9100 011f  lds	Temp, Minutes
00012a d1e4       rcall	DivDez
00012b e300       ldi	Temp, '0'
00012c 16c0       cp 	Di0, Temp
00012d f009       breq	_T2SetTemp0
00012e 9508       ret
                  
                 _T2SetTemp0:
00012f e6ae       ldi	XL, low(DailyTimer)
000130 e0b1       ldi	XH, high(DailyTimer)
000131 9100 0124  lds	Temp, WDays
                 
000133 9110 013d  lds	TempH, UserSettings1
000135 ff12       sbrs	TempH, _Holiday
000136 c004       rjmp	_T2SetTemp01
000137 e00a       ldi	Temp, BlockHoliday1
000138 ff13       sbrs	TempH, _2ndHoliday
000139 c001       rjmp	_T2SetTemp01
00013a e00b       ldi	Temp, BlockHoliday2
                   
                 _T2SetTemp01:
00013b e089       ldi	Temp3, 9							;number of timers per Day
00013c 9f08       mul	Temp, Temp3
00013d 0da0       add	XL, r0
00013e 1db1       adc	XH, r1
                  
00013f 9110 0120  lds	TempH, Hours
000141 9100 011f  lds	Temp, Minutes
000143 d1ed       rcall	HourTenMin2TimerValue
                 
000144 910d       ld 	Temp,  X+
000145 3f0f       cpi	Temp, 255							;if timer is inactive, skip	compare
000146 f019       breq	_T2SetTemp1
000147 16c0       cp		Di0, Temp
000148 f008       brcs	_T2SetTemp1
000149 e051       ldi	TemperatureMode, InHouseMode
                 
                 _T2SetTemp1:
00014a 910d       ld 	Temp,  X+
00014b 3f0f       cpi	Temp, 255							;if timer is inactive, skip	compare
00014c f019       breq	_T2SetTemp2
00014d 16c0       cp		Di0, Temp
00014e f008       brcs	_T2SetTemp2
00014f e052       ldi	TemperatureMode, OffHouseMode
                  
                 _T2SetTemp2:
000150 910d       ld 	Temp,  X+
000151 3f0f       cpi	Temp, 255							;if timer is inactive, skip	compare
000152 f019       breq	_T2SetTemp3
000153 16c0       cp		Di0, Temp
000154 f008       brcs	_T2SetTemp3
000155 e051       ldi	TemperatureMode, InHouseMode
                 
                 _T2SetTemp3:
000156 910d       ld 	Temp,  X+
000157 3f0f       cpi	Temp, 255							;if timer is inactive, skip	compare
000158 f019       breq	_T2SetTemp4
000159 16c0       cp		Di0, Temp
00015a f008       brcs	_T2SetTemp4
00015b e052       ldi	TemperatureMode, OffHouseMode
                 
                 _T2SetTemp4:
00015c 910d       ld 	Temp,  X+
00015d 3f0f       cpi	Temp, 255							;if timer is inactive, skip	compare
00015e f019       breq	_T2SetTemp5
00015f 16c0       cp		Di0, Temp
000160 f008       brcs	_T2SetTemp5
000161 e051       ldi	TemperatureMode, InHouseMode
                 
                 _T2SetTemp5:
000162 910d       ld 	Temp,  X+
000163 3f0f       cpi	Temp, 255							;if timer is inactive, skip	compare
000164 f019       breq	_T2SetTemp6
000165 16c0       cp		Di0, Temp
000166 f008       brcs	_T2SetTemp6
000167 e052       ldi	TemperatureMode, OffHouseMode
                 
                 _T2SetTemp6:
000168 910d       ld 	Temp,  X+
000169 3f0f       cpi	Temp, 255							;if timer is inactive, skip	compare
00016a f019       breq	_T2SetTemp7
00016b 16c0       cp		Di0, Temp
00016c f008       brcs	_T2SetTemp7
00016d e051       ldi	TemperatureMode, InHouseMode
                 
                 _T2SetTemp7:
00016e 910d       ld 	Temp,  X+
00016f 3f0f       cpi	Temp, 255							;if timer is inactive, skip	compare
000170 f019       breq	_T2SetTemp8
000171 16c0       cp		Di0, Temp
000172 f008       brcs	_T2SetTemp8
000173 e052       ldi	TemperatureMode, OffHouseMode
                 
                 _T2SetTemp8:
000174 910d       ld 	Temp,  X+
000175 3f0f       cpi	Temp, 255							;if timer is inactive, skip	compare
000176 f019       breq	_T2SetTemp9
000177 16c0       cp		Di0, Temp
000178 f008       brcs	_T2SetTemp9
000179 e053       ldi	TemperatureMode, NightMode
                   
                 _T2SetTemp9:
00017a b50b       in		Temp, Status2
00017b 6002       sbr 	Temp, (1<<_NewTempMode)
00017c 7f0b       cbr 	Temp, (1<<_FastModeScan)
00017d bd0b       out	Status2, Temp
00017e 9508       ret
                 
                 
                 
                 ;--------------------------------------------------
                 Mode2SetTemperature:
00017f b50b       in		Temp, Status2
000180 ff01       sbrs	Temp, _NewTempMode
000181 9508       ret
                 
000182 7f0d       cbr	Temp, (1<<_NewTempMode)
000183 bd0b       out	Status2, Temp
                 
000184 3050       cpi	TemperatureMode, NoTempMode
000185 f031       breq	_NoTempMode
000186 3051       cpi	TemperatureMode, InHouseMode
000187 f041       breq	_InHouseMode 
000188 3052       cpi	TemperatureMode, OffHouseMode
000189 f0b9       breq	_OffHouseMode
00018a 3053       cpi	TemperatureMode, NightMode
00018b f131       breq	_NightMode
                  
                 _NoTempMode:
00018c d540       rcall	ClearInHouse
00018d d54a       rcall	ClearOffHouse
00018e d554       rcall	ClearMoon
00018f 9508       ret
                 
                 _InHouseMode:
000190 d547       rcall	ClearOffHouse
000191 d551       rcall	ClearMoon
000192 d566       rcall	SetInHouse
000193 90c0 013e  lds	Di0, InHouseTempL
000195 90d0 013f  lds	Di1, InHouseTempH 
000197 d02b       rcall	_TempModeChanged
000198 9100 0129  lds	Temp, SetTempL
00019a 9110 012a  lds	TempH, SetTempH
00019c 150c       cp		Temp, Di0
00019d 051d       cpc	TempH, Di1
00019e f119       breq	_M2ST_End
00019f d585       rcall	BlinkInHouse
0001a0 c021       rjmp	_M2ST_End
                 
                 _OffHouseMode:
0001a1 d52b       rcall	ClearInHouse
0001a2 d540       rcall	ClearMoon
0001a3 d560       rcall	SetOffHouse
0001a4 90c0 0140  lds	Di0, OffHouseTempL
0001a6 90d0 0141  lds	Di1, OffHouseTempH
0001a8 d01a       rcall	_TempModeChanged
0001a9 9100 0129  lds	Temp, SetTempL
0001ab 9110 012a  lds	TempH, SetTempH
0001ad 150c       cp		Temp, Di0
0001ae 051d       cpc	TempH, Di1
0001af f091       breq	_M2ST_End
0001b0 d57f       rcall	BlinkOffHouse
0001b1 c010       rjmp	_M2ST_End
                 
                 _NightMode:
0001b2 d525       rcall	ClearOffHouse
0001b3 d519       rcall	ClearInHouse
0001b4 d55a       rcall	SetMoon
0001b5 90c0 0142  lds	Di0, NightTempL
0001b7 90d0 0143  lds	Di1, NightTempH
0001b9 d009       rcall	_TempModeChanged
0001ba 9100 0129  lds	Temp, SetTempL
0001bc 9110 012a  lds	TempH, SetTempH
0001be 150c       cp		Temp, Di0
0001bf 051d       cpc	TempH, Di1
0001c0 f009       breq	_M2ST_End
0001c1 d579       rcall	BlinkMoon
                 
                 _M2ST_End:
0001c2 9508       ret
                 
                 _TempModeChanged:										;alternate set temp only automatically, if temperature mode just toggles
0001c3 9100 013b  lds	Temp, TempModeOld
0001c5 9350 013b  sts	TempModeOld, TemperatureMode
0001c7 1750       cp		TemperatureMode, Temp
0001c8 f409       brne	_M2ST_E1
0001c9 9508       ret
                 
                 _M2ST_E1:
0001ca 92c0 0129  sts	SetTempL, Di0
0001cc 92d0 012a  sts	SetTempH, Di1
0001ce 9508       ret
                 
                 
                 ;-------------------------------------------
                 Store_Time:
0001cf e1af       ldi	XL, low(Minutes)
0001d0 e0b1       ldi	XH, high(Minutes)
                 
0001d1 ee10       ldi	TempH, low(Minutes_EE)
0001d2 e080       ldi	Temp3, high(Minutes_EE)
0001d3 e095       ldi	Temp4, 5
                 
                 _Store_Time_Loop:
0001d4 910d       ld		Temp, X+
0001d5 d175       rcall	EEWrite
0001d6 9513       inc	TempH
0001d7 959a       dec	Temp4
0001d8 f7d9       brne	_Store_Time_Loop
0001d9 9508       ret
                 
                 ;-------------------------------------------
                 ReadBack_Time:
0001da e1af       ldi	XL, low(Minutes)
0001db e0b1       ldi	XH, high(Minutes)
                 
0001dc ee10       ldi	TempH, low(Minutes_EE)
0001dd e080       ldi	Temp3, high(Minutes_EE)
0001de e095       ldi	Temp4, 5
                 
                 _RB_Time_Loop:
0001df d162       rcall	EERead
0001e0 930d       st		X+, Temp
0001e1 9513       inc	TempH
0001e2 959a       dec	Temp4
0001e3 f7d9       brne	_RB_Time_Loop
0001e4 9508       ret
                 
                 
                 ;-------------------------------------
                 StoreTimers2EEPROM:
0001e5 e6ae       ldi	XL, low(DailyTimer)
0001e6 e0b1       ldi	XH, high(DailyTimer)
0001e7 e010       ldi	TempH, low(EE_DailyTimer)
0001e8 e080       ldi	Temp3, high(EE_DailyTimer)
0001e9 e69c       ldi	Temp4, 108
                  
                 _Timer_EEStoreLoop:
0001ea 90cd       ld		Di0, X+
0001eb d156       rcall	EERead
0001ec 16c0       cp		Di0, Temp
0001ed f011       breq	_T_EESTL1
0001ee 2d0c       mov	Temp, Di0
0001ef d15b       rcall	EEWrite
                  
                 _T_EESTL1: 
0001f0 9513       inc	TempH
0001f1 959a       dec	Temp4
0001f2 f7b9       brne	_Timer_EEStoreLoop
0001f3 9508       ret
                 
                 
                 ;-------------------------------------
                 ReadEEPROM2Timers:
0001f4 e6ae       ldi	XL, low(DailyTimer)
0001f5 e0b1       ldi	XH, high(DailyTimer)
0001f6 e010       ldi	TempH, low(EE_DailyTimer)
0001f7 e080       ldi	Temp3, high(EE_DailyTimer)
0001f8 e69c       ldi	Temp4, 108
                  
                 _R_EE2TimerLoop:
0001f9 d148       rcall	EERead
0001fa 930d       st		X+, Temp
0001fb 9513       inc	TempH
0001fc 959a       dec	Temp4
0001fd f7d9       brne	_R_EE2TimerLoop
0001fe 9508       ret
                 
                 
                 ;-------------------------------------
                 StoreTemperatures2EEPROM:
0001ff e3ae       ldi	XL, low(InHouseTempL)
000200 e0b1       ldi	XH, high(InHouseTempL)
000201 ee15       ldi	TempH, low(EE_Temperatures)
000202 e080       ldi	Temp3, high(EE_Temperatures)
000203 e096       ldi	Temp4, 6
                  
                 _Temperature_EEStoreLoop:
000204 90cd       ld		Di0, X+
000205 d13c       rcall	EERead
000206 16c0       cp		Di0, Temp
000207 f011       breq	_Temp_EESTL1
000208 2d0c       mov	Temp, Di0
000209 d141       rcall	EEWrite
                  
                 _Temp_EESTL1: 
00020a 9513       inc	TempH
00020b 959a       dec	Temp4
00020c f7b9       brne	_Temperature_EEStoreLoop
00020d 9508       ret
                 
                 
                 ;-------------------------------------
                 ReadEEPROM2Temperatures:
00020e e3ae       ldi	XL, low(InHouseTempL)
00020f e0b1       ldi	XH, high(InHouseTempL)
000210 ee15       ldi	TempH, low(EE_Temperatures)
000211 e080       ldi	Temp3, high(EE_Temperatures)
000212 e096       ldi	Temp4, 6
                  
                 _R_EE2TemperatureLoop:
000213 d12e       rcall	EERead
000214 930d       st		X+, Temp
000215 9513       inc	TempH
000216 959a       dec	Temp4
000217 f7d9       brne	_R_EE2TemperatureLoop
000218 9508       ret
                 
                 
                 
                 
                 
                 ;-------------------------------------------
                  StartMain:
000219 e604       ldi	Temp, 100				;Frequency
00021a bd07       out	OCR0A, Temp
                 
00021b ef0f       ldi	Temp, 255				;Length
00021c 9300 0130  sts	BeepLen, Temp
00021e 9220 012f  sts	BeepCT, Null
                 
000220 b305       in		Temp, TIFR0				;clear interrupt flag
000221 6002       sbr	Temp, (1<<OCF0A)
000222 bb05       out	TIFR0, Temp
                  
000223 9100 006e  lds	Temp, TIMSK0
000225 6002       sbr	Temp, (1<<OCIE0A)
000226 9300 006e  sts	TIMSK0, Temp
                  
                 _WaitBeep:
000228 9100 006e  lds	Temp, TIMSK0
00022a fd01       sbrc	Temp, OCIE0A
00022b cffc       rjmp	_WaitBeep
                 
                 ;start Adaptation 
00022c ef0f       ser	Temp
00022d 9300 011a  sts	FreeMotorCurrent, Temp
00022f 9220 0113  sts	PositionL, Null
000231 9220 0114  sts	PositionH, Null
                  /*ldi	Temp, low(MaxAdaptWay)
                  sts	OutLimitL, Temp
                  sts	ValveBOTL, Temp
                  ldi	Temp, high(MaxAdaptWay)
                  sts	OutLimitH, Temp
                  sts	ValveBOTH, Temp*/
000233 9220 0118  sts	AdaptStep, Null
000235 9af3       sbi	Status0, _Adapt
000236 9508       ret
                 
                 
                 
                 ;----------------------------------------------------------------------------------------
                 ;Calculate temperatures from internal NTC voltage divider using the formula: R2=R1*U2/U1
                 ;----------------------------------------------------------------------------------------
                 Calc_Temperature:
000237 b50a       in 	Temp, Status1
000238 ff04       sbrs	Temp, _NewTemp
000239 9508       ret
                  
00023a 9a83       sbi	Internal_NTC_DDR, Internal_NTC_On	
00023b 9a8b       sbi	Internal_NTC_Port, Internal_NTC_On	;switch NTC voltage divider on
00023c e403       ldi	Temp, 0b01000011					;AVcc as reference, channel 3, internal NTC 
00023d 9300 007c  sts	ADMUX, Temp
00023f 0000       nop
000240 0000       nop
000241 0000       nop
000242 ec04       ldi	Temp, 0b11000100					;ADC enable, start ADC conversion, ADC Prescaler 16
000243 9300 007a  sts	ADCSRA, Temp
                 
                 _Wait_NTC_ADC1:
000245 9100 007a  lds	Temp, ADCSRA						;measure upper voltage on voltage divider (U1)
000247 fd06       sbrc	Temp, ADSC
000248 cffc       rjmp	_Wait_NTC_ADC1
                 
000249 9100 0078  lds	Temp, ADCL
00024b 9110 0079  lds	TempH, ADCH
00024d 9300 0126  sts	iNTCVL, Temp						;store U1
00024f 9310 0127  sts	iNTCVH, TempH
                 
000251 e401       ldi	Temp, 0b01000001					;AVcc as reference, channel3, internal NTC 
000252 9300 007c  sts	ADMUX, Temp
000254 0000       nop
000255 0000       nop
000256 0000       nop
000257 ec04       ldi	Temp, 0b11000100					;ADC enable, start ADC conversion, ADC Prescaler 16
000258 9300 007a  sts	ADCSRA, Temp
                 
                 _Wait_NTC_ADC2:
00025a 9100 007a  lds	Temp, ADCSRA						;measure NTC voltage
00025c fd06       sbrc	Temp, ADSC	
00025d cffc       rjmp	_Wait_NTC_ADC2
                 
                 
                 _CalcT1:
00025e 94f8       cli
00025f b50a       in 	Temp, Status1
000260 7e0f       cbr	Temp, (1<<_NewTemp)
000261 bd0a       out 	Status1, Temp
000262 9478       sei
                 
000263 9883       cbi	Internal_NTC_DDR, Internal_NTC_On
000264 988b       cbi	Internal_NTC_Port, Internal_NTC_On	;switch NTC voltage divider off
000265 e004       ldi	Temp, 0b00000100					;ADC disable, ADC Prescaler 16
000266 9300 007a  sts	ADCSRA, Temp
                 
000268 9100 0078  lds	Temp, ADCL
00026a 9110 0079  lds	TempH, ADCH
00026c 9300 0106  sts	NTCIntL, Temp						;store NTC voltage
00026e 9310 0107  sts	NTCIntH, TempH
                 
                 
000270 9180 013d  lds	Temp3, UserSettings1
000272 ff81       sbrs	Temp3, _ExternalTempSensor
000273 c001       rjmp	_CalcT11
                 
                  ;rcall	Start_IO							;if external Sensor is used, get temperature from external sensor and exit temperature calculation 
000274 c05f       rjmp	_CT22
                 
                 _CalcT11:  
000275 ee80       ldi	Temp3, low(12000)					;load multiplier 1000 x R1(in kOhms)
000276 2e88       mov	Ch0, Temp3
000277 e28e       ldi	Temp3, high(12000)
000278 2e98       mov	Ch1, Temp3
                  
000279 9180 0126  lds	Temp3, iNTCVL						;Load U1
00027b 9190 0127  lds	Temp4, iNTCVH
00027d 1b80       sub	Temp3, Temp
00027e 0b91       sbc	Temp4, TempH
                 
                 
00027f 9d19       mul	TempH, Ch1							;ah*bh		multiply with r1
000280 0170       movw	Di3:Di2, r1:r0
000281 9d08       mul	Temp, Ch0							;al*bl
000282 0160       movw	Di1:Di0, r1:r0
000283 9d18       mul	TempH, Ch0							;ah*bl
000284 0cd0       add	Di1, r0
000285 1ce1       adc	Di2, r1
000286 1cf2       adc	Di3, Null
000287 9e90       mul	Ch1, Temp							;bh*al
000288 0cd0       add	Di1, r0
000289 1ce1       adc	Di2, r1
00028a 1cf2       adc	Di3, Null
                 
00028b e021       ldi	Temp5, 1
00028c 2700       clr	Temp 
00028d 2711       clr	TempH
                 
                 _TempDivLoop:								;U2/U1
00028e 1ac8       sub	Di0, Temp3
00028f 0ad9       sbc	Di1, Temp4
000290 08e2       sbc	Di2, Null
000291 08f2       sbc	Di3, Null
000292 f018       brcs	_TempDivEnd
000293 0f02       add	Temp, Temp5
000294 1d12       adc	TempH, Null
000295 cff8       rjmp	_TempDivLoop
                  
                 _TempDivEnd:						
000296 e2f6       ldi	ZH, high(NTCIntTable*2)
000297 eae2       ldi	ZL, low(NTCIntTable*2)
000298 9185       lpm	Temp3, Z+
000299 9195       lpm	Temp4, Z+
00029a 9732       sbiw	ZH:ZL, 2
00029b 1780       cp 	Temp3, Temp 						;if table value is lower then read value, set temp to 0.00C and skip
00029c 0791       cpc	Temp4, TempH
00029d f418       brcc	_CT0
00029e 24cc       clr	Di0				
00029f 24dd       clr	Di1
0002a0 c02f       rjmp	_CT21
                 
                 _CT0:
0002a1 e322       ldi	Temp5, 50
0002a2 ec8e       ldi	Temp3, (-50)						;init with -5C
0002a3 2ec8       mov	Di0, Temp3
0002a4 ef8f       ldi	Temp3, (-1)
0002a5 2ed8       mov	Di1, Temp3
                 
                 
                 _CT1:
0002a6 9185       lpm	Temp3, Z+
0002a7 9195       lpm	Temp4, Z+
                  
0002a8 3080       cpi	Temp3, 0							;$0000 table end mark
0002a9 0592       cpc	Temp4, Null
0002aa f041       breq	_TempTop
                    
0002ab 1780       cp 	Temp3, Temp 						;if table value is lower then read value, skip to fine reolution
0002ac 0791       cpc	Temp4, TempH
0002ad f048       brcs	_CT2
                  
0002ae 2ee8       mov	Di2, Temp3							;store coarse value for later use
0002af 2ef9       mov	Di3, Temp4
                 
0002b0 0ec2       add	Di0, Temp5							;temperature coarse steps of 5.0
0002b1 1cd2       adc	Di1, Null
0002b2 cff3       rjmp	_CT1
                 
                 
                 _TempTop:
0002b3 ef0f       ser	Temp
0002b4 2ec0       mov	Di0, Temp
0002b5 2ed0       mov	Di1, Temp
0002b6 c019       rjmp	_CT21
                 
                 
                 _CT2: 
0002b7 92ef       push	Di2
0002b8 92ff       push	Di3
                 
0002b9 1ae8       sub	Di2, Temp3							;values between two 5steps
0002ba 0af9       sbc	Di3, Temp4
0002bb e081       ldi	Temp3, 1
0002bc 2e88       mov	Ch0, Temp3
0002bd 2788       clr	Temp3
0002be 2799       clr	Temp4
                 
                 _TempDivLoop2:
0002bf 1ae2       sub	Di2, Temp5							;divide values with 50, 0.1 resolution
0002c0 08f2       sbc	Di3, Null
0002c1 f018       brcs	_TempDivL2End
0002c2 0d88       add	Temp3, Ch0
0002c3 1d92       adc	Temp4, Null
0002c4 cffa       rjmp	_TempDivLoop2
                  
                 _TempDivL2End:
0002c5 e021       ldi	Temp5, 1
0002c6 90ff       pop	Di3
0002c7 90ef       pop	Di2
                 
                 _TempFineLoop:
0002c8 1ae8       sub	Di2, Temp3
0002c9 0af9       sbc	Di3, Temp4
0002ca 16e0       cp		Di2, Temp
0002cb 06f1       cpc	Di3, TempH
0002cc f01c       brlt	_CT21
0002cd 0ec2       add	Di0, Temp5
0002ce 1cd2       adc	Di1, Null
0002cf cff8       rjmp	_TempFineLoop
                    
                 _CT21:
0002d0 92c0 0100  sts   	TempIntL, Di0
0002d2 92d0 0101  sts	TempIntH, Di1
                 
                  
                 /* in		Temp, Status2
                  sbr	Temp, (1<<_TX_SSPI)
                  out	Status2, Temp*/
                 
                 _CT22:
0002d4 9bf3       sbis	Status0, _Adapt
0002d5 d07f       rcall	Regulate
0002d6 940e 1228  call	Measure_Battery_Voltage 
0002d8 9508       ret
                 
                 
                 
                 
                 
                 
                 ;--------------------------------------------------------------------------------------------------
                 ;change one byte of binary format to 2 bytes ASCII HEX format, used for LCD
                 
                 DivHex:
                    
                 DivH:					
0002d9 2f10       mov 	TempH, Temp
0002da 7f10       andi	TempH, $F0
0002db 9512       swap	TempH
0002dc 2ed1       mov	Di1, TempH
0002dd e310       ldi	TempH, $30
0002de 0ed1       add	Di1, TempH
0002df e31a       ldi	TempH, $3A
0002e0 16d1       cp		Di1, TempH
0002e1 f010       brcs	DivL
0002e2 e017       ldi	TempH, 7
0002e3 0ed1       add	Di1, TempH
                 
                 DivL:					
0002e4 2f10       mov 	TempH, Temp
0002e5 701f       andi	TempH, $0F
0002e6 2ec1       mov	Di0, TempH
0002e7 e310       ldi	TempH, $30
0002e8 0ec1       add	Di0, TempH
0002e9 e31a       ldi	TempH, $3A
0002ea 16c1       cp		Di0, TempH
0002eb f010       brcs	DivHEnd
0002ec e017       ldi	TempH, 7
0002ed 0ec1       add	Di0, TempH
                 
                 DivHEnd:					
0002ee 9508       ret
                 
                 
                 ;--------------------------------------------------------------------------------------------------
                 ;change two byte of binary (High/Low) format to 4 bytes ASCII DEC format, used for LCD
                 
                 DivHL:
0002ef 24cc       clr	Di0				; Alle temporren Dezimalstellen lschen
0002f0 24dd       clr	Di1
0002f1 24ee       clr	Di2
0002f2 24ff       clr	Di3 
                 
                 DivHL2:					    
0002f3 3e08       cpi	Temp, low(1000)		;Compare low byte
0002f4 e083       ldi	Temp3, high(1000)	;
0002f5 0718       cpc	TempH, Temp3	    ;Compare high byte
0002f6 f020       brlo	DivHL3
0002f7 5e08       subi	Temp, low(1000)		;Subtract low bytes
0002f8 4013       sbci	TempH, high(1000)	;Subtract high byte with carry
0002f9 94f3       inc	Di3
0002fa cff8       rjmp	DivHL2
                 
                 DivHL3:					    
0002fb 3604       cpi	Temp, low(100)		;Compare low byte
0002fc e080       ldi	Temp3, high(100)	;
0002fd 0718       cpc	TempH, Temp3	    ;Compare high byte
0002fe f020       brlo	DivHL4
0002ff 5604       subi	Temp, low(100)		;Subtract low bytes
000300 4010       sbci	TempH, high(100)	;Subtract high byte with carry
000301 94e3       inc	Di2
000302 cff8       rjmp	DivHL3
                 
                 DivHL4:				
000303 300a       cpi 	Temp, 10
000304 f018       brlo 	DivHLEnd
000305 500a       subi	Temp, 10
000306 94d3       inc	Di1
000307 cffb       rjmp	DivHL4
                 
                 DivHLEnd:				
000308 2ec0       mov	Di0, Temp
                 
000309 e300       ldi	Temp, 48		;ASCII-Zeichenumwandlung
00030a 0ef0       add	Di3, Temp
00030b 0ee0       add	Di2, Temp
00030c 0ed0       add	Di1, Temp
00030d 0ec0       add	Di0, Temp
00030e 9508       ret
                 
                 
                 
                 ;--------------------------------------------------------------------------------------------------
                 ;Teilt 8_Bit Wert in 3-stellige Dezimalzahl
                 
                 DivDez:
00030f 24cc       clr	Di0				; Alle temporren Dezimalstellen lschen
000310 24dd       clr	Di1
000311 24ee       clr	Di2
                  
                 Div1:					    
000312 3604       cpi	Temp, 100	
000313 f018       brlo	Div2
000314 5604       subi	Temp, 100
000315 94e3       inc	Di2
000316 cffb       rjmp	Div1
                 
                 Div2:				
000317 300a       cpi 	Temp, 10
000318 f018       brlo 	DivE
000319 500a       subi	Temp, 10
00031a 94d3       inc	Di1
00031b cffb       rjmp	Div2
                 
                 DivE:				
00031c 2ec0       mov	Di0, Temp
                 
                 DivE1:
00031d e300       ldi	Temp, 48
00031e 0ee0       add	Di2, Temp
00031f 0ed0       add	Di1, Temp
000320 0ec0       add	Di0, Temp
000321 9508       ret
                 
                 ;-------------------------------------------------
                 ;divides Timer value 0...143 to 3 digits for Hours and tenth minutes 
                 
                 DivTimer2HourTenMin:
000322 24ee       clr	Di2
000323 24dd       clr	Di1
000324 24cc       clr	Di0				
                 
                 DT2HTM_1:
000325 330c       cpi	Temp, 60
000326 f018       brlo	DT2HTM_2
000327 530c       subi	Temp, 60
000328 94e3       inc	Di2
000329 cffb       rjmp	DT2HTM_1 
                 
                 DT2HTM_2:
00032a 3006       cpi	Temp, 6
00032b f018       brlo	DT2HTM_3
00032c 5006       subi	Temp, 6
00032d 94d3       inc	Di1
00032e cffb       rjmp	DT2HTM_2 
                 
                 DT2HTM_3:
00032f 2ec0       mov	Di0, Temp
000330 cfec       rjmp	DivE1
                 
                 ;--------------------------------------------------------
                 ;changes Hours and tens of Minutes into TimerValue 0..144
                 ;Temp contains Minutes, TempH contains Hours
                 HourTenMin2TimerValue:
000331 e086       ldi	Temp3, 6
000332 9f18       mul	TempH, Temp3
000333 2cc0       mov	Di0, r0
                 
                 _HTM2TV1:
000334 300a       cpi	Temp, 10
000335 f018       brlo	_HTM2TV2
000336 500a       subi	Temp, 10
000337 94c3       inc	Di0
000338 cffb       rjmp	_HTM2TV1
                 
                 
                 _HTM2TV2:
000339 9508       ret
                 
                 
                 ;----------------------------------------------------------------------
                 TimerHour2Bin:
00033a 24cc       clr	Di0
                 
                 _TH2B1:
00033b 3006       cpi	Temp, 6
00033c f018       brlo	_TH2B2
00033d 5006       subi	Temp, 6
00033e 94c3       inc	Di0
00033f cffb       rjmp	_TH2B1
                 
                 _TH2B2:
000340 2d0c       mov	Temp, Di0
000341 9508       ret
                 
                  
                 
                 
                 ;----------------------------------------------------------------------
                 ;Lesen eines Wertes aus dem internen EEPROM
                 ;Adresse des zu lesenden Wertes steht in Temp3 / TempH
                 ;gelesener Wert wird in Temp zurckgegeben
                 
                 EERead:
000342 99f9       sbic	EECR, EEWE		;if EEWE not clear
000343 cffe       rjmp	EERead			;    wait more
000344 94f8       cli
000345 bd82       out	EEARH, Temp3	;output address
000346 bd11       out	EEARL, TempH
000347 9af8       sbi	EECR, EERE		;set EEPROM Read strobe
000348 b500       in		Temp, EEDR		;get data
000349 9478       sei
00034a 9508       ret
                 
                 ;--------------------------------------------------------------------------------------------------
                 ;Schreiben eines Wertes in das interne EEPROM
                 ;Adresse des zu schreibenden Wertes steht in Temp3 / TempH
                 ;zu schreibender Wert steht in Temp 
                 
                 EEWrite:
00034b 99f9       sbic	EECR, EEWE		;if EEWE not clear
00034c cffe       rjmp	EEWrite			;wait more
00034d 94f8       cli
00034e bd82       out	EEARH, Temp3	;output address
00034f bd11       out	EEARL, TempH
000350 bd00       out	EEDR, Temp		;put data
000351 9afa       sbi	EECR, EEMWE		;set MasterWriteEnable
000352 9af9       sbi	EECR, EEWE		;set EEPROM Write strobe
000353 9478       sei
000354 9508       ret
                 
                 
                 
                 .include	"Regulation.inc"
                 
                 ; adaptive regulation function
                 Regulate:
000355 9100 0100  lds	Temp, TempIntL						;NTC temperature
000357 9110 0101  lds	TempH, TempIntH
000359 90c0 0102  lds	Di0, TempIntOldL					;store current temperature as old for next run
00035b 90d0 0103  lds	Di1, TempIntOldH
00035d 9300 0102  sts	TempIntOldL, Temp
00035f 9310 0103  sts	TempIntOldH, TempH
000361 90e0 0104  lds	Di2, DeltaTemp1						;mov previous Delta1 to Delta2
000363 92e0 0105  sts	DeltaTemp2, Di2
000365 190c       sub	Temp, Di0							;get new Delta1
000366 091d       sbc	TempH, Di1
000367 9300 0104  sts	DeltaTemp1, Temp
                  
000369 e080       ldi	Temp3, TStatic
00036a f019       breq	_Reg1								;CurrentTemp = OldTemp 
00036b e082       ldi	Temp3, TFall
00036c f00a       brmi	_Reg1								;CurrentTemp is lower than OldTemp
00036d e081       ldi	Temp3, TRise						;CurrentTemp is higher than OldTemp
                 
                 _Reg1:
00036e 0d0e       add	Temp, Di2							;add both Delta values
00036f f40a       brpl	_RegPl								;if positive, execute / if negative, do 1s complement
000370 9501       neg	Temp
                 
                 _RegPl:
000371 3000       cpi	Temp, 0								;if adding both deltas equals to 0, add 1
000372 f409       brne	_RegPl1
000373 9503       inc	Temp
                 
                 _RegPl1:
000374 2ec0       mov	Di0, Temp 
000375 e004       ldi 	Temp, 4								;limit gradient multiplicand
000376 16c0       cp		Di0, Temp
000377 f008       brcs	_Reg11
000378 2ec0       mov	Di0, Temp
                 
                 _Reg11:
000379 9100 0100  lds	Temp, TempIntL						;NTC temperature
00037b 9110 0101  lds	TempH, TempIntH
00037d 90d0 0129  lds	Di1, SetTempL						;current set temperature
00037f 90e0 012a  lds	Di2, SetTempH
                 
000381 190d       sub	Temp, Di1							
000382 091e       sbc	TempH, Di2 
000383 f06a       brmi	_TempLowerThanSet
                  
                 
000384 e194       ldi	Temp4, FuzzAbove
000385 300f       cpi	Temp, 15
000386 0512       cpc	TempH, Null
000387 f4c0       brcc	_Fuzzy
                  
000388 e098       ldi	Temp4, FuzzHot
000389 3006       cpi	Temp, 6
00038a 0512       cpc	TempH, Null
00038b f4a0       brcc	_Fuzzy
                  
00038c e094       ldi	Temp4, FuzzWarm
00038d 3002       cpi	Temp, 2
00038e 0512       cpc	TempH, Null
00038f f480       brcc	_Fuzzy
000390 c00e       rjmp	_FuzzOK
                 
                 _TempLowerThanSet:
000391 9510       com	TempH
000392 9501       neg	Temp
                  
000393 e198       ldi	Temp4, FuzzBelow
000394 300f       cpi	Temp, 15
000395 0512       cpc	TempH, Null
000396 f448       brcc	_Fuzzy
                    
000397 e190       ldi	Temp4, FuzzCold
000398 3006       cpi	Temp, 6
000399 0512       cpc	TempH, Null
00039a f428       brcc	_Fuzzy
                  
00039b e09c       ldi	Temp4, FuzzCool
00039c 3002       cpi	Temp, 2
00039d 0512       cpc	TempH, Null
00039e f408       brcc	_Fuzzy
                 
                 _FuzzOK: 
00039f e090       ldi	Temp4, FuzzOK
                 
                 _Fuzzy:
0003a0 0f98       add	Temp4, Temp3
0003a1 9390 0138  sts	FuzzyVal, Temp4
                 
0003a3 eae8       ldi	ZL, low (_FuzzyJump)
0003a4 e0f3       ldi	ZH, high (_FuzzyJump)
0003a5 0fe9       add	ZL, Temp4
0003a6 1df2       adc	ZH, Null
0003a7 9409       ijmp
                  
                 _FuzzyJump:
0003a8 c01b       rjmp	_OK_Static				; 0
0003a9 c01d       rjmp	_OK_Rise				; 1
0003aa c01f       rjmp	_OK_Fall				; 2
0003ab c021       rjmp	_NoRegulation			;dummy  3
0003ac c021       rjmp	_Warm_Static			; 4
0003ad c023       rjmp	_Warm_Rise				; 5
0003ae c026       rjmp	_Warm_Fall				; 6
0003af c01d       rjmp	_NoRegulation			;dummy  7
0003b0 c028       rjmp	_HOT_Static				; 8
0003b1 c029       rjmp	_HOT_Rise				; 9
0003b2 c02c       rjmp	_HOT_Fall				;10
0003b3 c019       rjmp	_NoRegulation			;dummy 11
0003b4 c02d       rjmp	_Cool_Static			;12
0003b5 c02e       rjmp	_Cool_Rise				;13
0003b6 c031       rjmp	_Cool_Fall				;14
0003b7 c015       rjmp	_NoRegulation			;dummy 15
0003b8 c033       rjmp	_Cold_Static			;16
0003b9 c034       rjmp	_Cold_Rise				;17
0003ba c036       rjmp	_Cold_Fall				;18
0003bb c011       rjmp	_NoRegulation			;dummy 19
0003bc c038       rjmp	_Above_Static			;20
0003bd c03a       rjmp	_Above_Rise				;21
0003be c03c       rjmp	_Above_Fall				;22
0003bf c00d       rjmp	_NoRegulation			;dummy 23
0003c0 c03d       rjmp	_Below_Static			;24
0003c1 c03f       rjmp	_Below_Rise				;25
0003c2 c041       rjmp	_Below_Fall				;26
0003c3 c009       rjmp	_NoRegulation			;dummy 27
                 
                  
                 
                 _OK_Static:
0003c4 9220 012d  sts	RegWay, Null
0003c6 9508       ret
                 
                 _OK_Rise:
0003c7 9220 012d  sts	RegWay, Null
0003c9 9508       ret
                 
                 _OK_Fall:
0003ca 9220 012d  sts	RegWay, Null
0003cc 9508       ret
                 
                 _NoRegulation:
0003cd 9508       ret
                 
                 _Warm_Static:
0003ce e083       ldi	Temp3, 3
0003cf c037       rjmp	_RegCloseValve
0003d0 9508       ret
                 
                 _Warm_Rise:
0003d1 e08a       ldi	Temp3, 10
0003d2 9d8c       mul	Temp3, Di0
0003d3 2d80       mov	Temp3, R0
0003d4 c032       rjmp	_RegCloseValve
                 
                 _Warm_Fall:
0003d5 e08a       ldi	Temp3, 10
0003d6 9d8c       mul	Temp3, Di0
0003d7 2d80       mov	Temp3, R0
0003d8 c049       rjmp	_RegOpenValve
                 
                 _HOT_Static:
0003d9 e08a       ldi	Temp3, 10
0003da c02c       rjmp	_RegCloseValve
                 
                 _HOT_Rise:
0003db e184       ldi	Temp3, 20
0003dc 9d8c       mul	Temp3, Di0
0003dd 2d80       mov	Temp3, R0
0003de c028       rjmp	_RegCloseValve
                 
                 _Hot_Fall:
0003df 9220 012d  sts	RegWay, Null
0003e1 9508       ret
                 
                 _Cool_Static:
0003e2 e083       ldi	Temp3, 3
0003e3 c03e       rjmp	_RegOpenValve
                 
                 _Cool_Rise:
0003e4 e08a       ldi	Temp3, 10
0003e5 9d8c       mul	Temp3, Di0
0003e6 2d80       mov	Temp3, R0
0003e7 c01f       rjmp	_RegCloseValve
                 
                 _Cool_Fall:
0003e8 e08a       ldi	Temp3, 10
0003e9 9d8c       mul	Temp3, Di0
0003ea 2d80       mov	Temp3, R0
0003eb c036       rjmp	_RegOpenValve
                 
                 _Cold_Static:
0003ec e08a       ldi	Temp3, 10
0003ed c034       rjmp	_RegOpenValve
                 
                 _Cold_Rise:
0003ee 9220 012d  sts	RegWay, Null
0003f0 9508       ret
                  
                 _Cold_Fall:
0003f1 e184       ldi	Temp3, 20
0003f2 9d8c       mul	Temp3, Di0
0003f3 2d80       mov	Temp3, R0
0003f4 c02d       rjmp	_RegOpenValve
                  
                 
                 _Above_Static:
0003f5 e382       ldi	Temp3, 50
0003f6 c010       rjmp	_RegCloseValve
0003f7 9508       ret
                 
                 _Above_Rise:
0003f8 e684       ldi	Temp3, 100
0003f9 c00d       rjmp	_RegCloseValve
0003fa 9508       ret
                 
                 _Above_Fall:
0003fb e382       ldi	Temp3, 50
0003fc c00a       rjmp	_RegCloseValve
0003fd 9508       ret
                 
                 _Below_Static:
0003fe e382       ldi	Temp3, 50
0003ff c022       rjmp	_RegOpenValve
000400 9508       ret
                 
                 _Below_Rise:
000401 e382       ldi	Temp3, 50
000402 c01f       rjmp	_RegOpenValve
000403 9508       ret
                 
                 _Below_Fall:
000404 e684       ldi	Temp3, 100
000405 c01c       rjmp	_RegOpenValve
000406 9508       ret
                 
                 
                 _RegCloseValve:
000407 9100 013d  lds	Temp, UserSettings1
000409 fd00       sbrc	Temp, _ValveInverse
00040a c01b       rjmp	_RegOpenValve1
                 
                 _RegCloseValve1:
00040b 9220 012d  sts	RegWay, Null
00040d 9100 0113  lds	Temp, PositionL
00040f 9110 0114  lds	TempH, PositionH
000411 1b08       sub	Temp, Temp3
000412 0912       sbc	TempH, Null
000413 9300 0113  sts	PositionL, Temp
000415 9310 0114  sts	PositionH, TempH
000417 f420       brcc	_RCV0
                  
000418 9220 0113  sts	PositionL, Null
00041a 9220 0114  sts	PositionH, Null
                 
                 _RCV0:  
00041c 9100 0117  lds	Temp, MotTimeOut					;ignore closing the valve, if valve is fully closed
00041e fd06       sbrc	Temp, _BotLimit
00041f 9508       ret
                 
000420 9af1       sbi	Status0, _MotDir					;close valve
000421 c028       rjmp	_ROV1
                  
                 
                 _RegOpenValve:
000422 9100 013d  lds	Temp, UserSettings1
000424 fd00       sbrc	Temp, _ValveInverse
000425 cfe5       rjmp	_RegCloseValve1
                 
                 _RegOpenValve1: 								
000426 9220 012d  sts	RegWay, Null
000428 9100 0113  lds	Temp, PositionL						;limit position change to ValveTop position
00042a 9110 0114  lds	TempH, PositionH
00042c 0f08       add	Temp, Temp3
00042d 1d12       adc	TempH, Null
00042e 9300 0113  sts	PositionL, Temp
000430 9310 0114  sts	PositionH, TempH
000432 90c0 0115  lds	Di0, ValveTopL
000434 90d0 0116  lds	Di1, ValveTopH						;ignore opening the valve, if valve top limit is reached
000436 1ac0       sub	Di0, Temp
000437 0ad1       sbc	Di1, TempH
000438 f462       brpl	_ROV0
                 
000439 9100 0115  lds	Temp, ValveTopL						;load max value to position
00043b 9110 0116  lds	TempH, ValveTopH
00043d 9300 0113  sts	PositionL, Temp
00043f 9310 0114  sts	PositionH, TempH
                  
000441 94c1       neg	Di0
000442 198c       sub	Temp3, Di0
000443 f408       brcc	_ROV0
000444 9508       ret
                 
                 
                 _ROV0: 
000445 9100 0117  lds	Temp, MotTimeOut
000447 fd07       sbrc	Temp, _TopLimit
000448 9508       ret
                  
000449 98f1       cbi	Status0, _MotDir					;open valve
                 
                 _ROV1:
00044a 9380 012d  sts	RegWay, Temp3
                  
00044c 99f2       sbic	Status0, _MotRun					;do not store new motor position, if motor is running
00044d 9508       ret
                  
00044e 9af0       sbi 	Status0, _MotOn	
00044f 9100 0117  lds	Temp, MotTimeOut
000451 7c00       andi	Temp, 0b11000000
000452 9300 0117  sts	MotTimeOut, Temp
000454 9380 0111  sts	RFLXCTL, Temp3
000456 9220 0112  sts	RFLXCTH, Null
000458 9508       ret
                 
                 .include	"LCD_Driver.inc"		;Display handler
                 
                 Show_AutoManuMode:
000459 b51a       in		TempH, Status1
00045a ff11       sbrs	TempH, _AutoManu
00045b d212       rcall	ClearManu
00045c ff11       sbrs	TempH, _AutoManu
00045d d1ef       rcall	SetAuto
00045e fd11       sbrc	TempH, _AutoManu
00045f d1f8       rcall	ClearAuto
000460 fd11       sbrc	TempH, _AutoManu
000461 d201       rcall	SetManu
000462 9508       ret
                 
                 
                 ;--------------------------------------------------
                 Show_DailyBargraph:
000463 d072       rcall	ClearBargraph
000464 e6ae       ldi	XL, low(DailyTimer)
000465 e0b1       ldi	XH, high(DailyTimer)
                  
000466 9100 0124  lds	Temp, WDays
                 
000468 9110 013d  lds	TempH, UserSettings1
00046a ff12       sbrs	TempH, _Holiday
00046b c004       rjmp	_S_DB00
00046c e00a       ldi	Temp, BlockHoliday1
00046d ff13       sbrs	TempH, _2ndHoliday
00046e c001       rjmp	_S_DB00
00046f e00b       ldi	Temp, BlockHoliday2
                   
                 _S_DB00:
000470 e089       ldi	Temp3, 9								;number of timers per Day
000471 9f08       mul	Temp, Temp3
000472 0da0       add	XL, r0
000473 1db1       adc	XH, r1
000474 93a0 0136  sts	BarBaseL, XL
000476 93b0 0137  sts	BarBaseH, XH
000478 e084       ldi	Temp3, 4
                 
                 _S_DB0: 
000479 e090       ldi	Temp4, 0
00047a 910d       ld		Temp, X+ 
00047b debe       rcall	TimerHour2Bin
                 
                 _S_DB1: 
00047c 1709       cp 	Temp, Temp4
00047d f021       breq	_SDBarStart
00047e 9593       inc	Temp4
00047f 3198       cpi	Temp4, 24
000480 f0c9       breq	_SDBarEnd
000481 cffa       rjmp	_S_DB1
                 
                 _SDBarStart: 
000482 910e       ld		Temp, -X							;set Barpoint only, if off time is later then on time
000483 9611       adiw	XH:XL, 1
000484 911c       ld		TempH, X
000485 1701       cp		Temp, TempH
000486 f4b0       brcc	_SDBarEnd1
                  
000487 2f09       mov	Temp, Temp4
000488 6800       ori	Temp, $80
000489 e310       ldi	TempH, $30
00048a d171       rcall	PutBargraph
                 
00048b 910d       ld		Temp, X+ 
00048c 950a       dec	Temp
00048d deac       rcall	TimerHour2Bin
00048e 9503       inc	Temp
                  
                 _S_DB2: 
00048f 1709       cp 	Temp, Temp4
000490 f049       breq	_SDBarEnd
                 
000491 930f       push	Temp
000492 2f09       mov	Temp, Temp4
000493 6800       ori	Temp, $80
000494 e310       ldi	TempH, $30
000495 d166       rcall	PutBargraph
000496 910f       pop	Temp
                 
000497 9593       inc	Temp4
000498 3198       cpi	Temp4, 24
000499 f7a9       brne	_S_DB2
                 
                 _SDBarEnd: 
00049a 958a       dec	Temp3
00049b f6e9       brne	_S_DB0 
00049c 9508       ret
                 
                 _SDBarEnd1:
00049d 9611       adiw	XH:XL, 1
00049e cffb       rjmp	_SDBarEnd
                 
                 
                  
                 ;--------------------------------------------------
                 Show_TimerSetBar:
00049f 910c       ld		Temp, X
0004a0 930f       push	Temp								;save current set time
0004a1 d034       rcall	ClearBargraph
0004a2 e084       ldi	Temp3, 4							;number of inhouse/offhouse timers
0004a3 91a0 0136  lds	XL, BarBaseL
0004a5 91b0 0137  lds	XH, BarBaseH
                 
                 S_TSB0: 
0004a7 e090       ldi	Temp4, 0
0004a8 910d       ld		Temp, X+ 
0004a9 de90       rcall	TimerHour2Bin
                 
                 S_TSB1: 
0004aa 1709       cp 	Temp, Temp4
0004ab f021       breq	_BarStart
0004ac 9593       inc	Temp4
0004ad 3198       cpi	Temp4, 24
0004ae f0c9       breq	_BarEnd
0004af cffa       rjmp	S_TSB1
                 
                 _BarStart: 
0004b0 910e       ld		Temp, -X							;set Barpoint only, if off time is later then on time
0004b1 9611       adiw	XH:XL, 1
0004b2 911c       ld		TempH, X
0004b3 1701       cp		Temp, TempH
0004b4 f4f8       brcc	_BarEnd1
                  
0004b5 2f09       mov	Temp, Temp4
0004b6 6800       ori	Temp, $80
0004b7 e310       ldi	TempH, $30
0004b8 d143       rcall	PutBargraph
                 
0004b9 910d       ld		Temp, X+ 
0004ba 950a       dec	Temp
0004bb de7e       rcall	TimerHour2Bin
0004bc 9503       inc	Temp
                  
                 S_TSB2: 
0004bd 1709       cp 	Temp, Temp4
0004be f049       breq	_BarEnd
                 
0004bf 930f       push	Temp
0004c0 2f09       mov	Temp, Temp4
0004c1 6800       ori	Temp, $80
0004c2 e310       ldi	TempH, $30
0004c3 d138       rcall	PutBargraph
0004c4 910f       pop	Temp
                 
0004c5 9593       inc	Temp4
0004c6 3198       cpi	Temp4, 24
0004c7 f7a9       brne	S_TSB2
                 
                 _BarEnd: 
0004c8 958a       dec	Temp3
0004c9 f6e9       brne	S_TSB0 
                 
0004ca 910f       pop	Temp									;restore current set time and blink
0004cb de6e       rcall	TimerHour2Bin
0004cc 930f       push	Temp
0004cd e210       ldi	TempH, $20
0004ce d12d       rcall	PutBargraph
0004cf 910f       pop	Temp
0004d0 6800       ori	Temp, $80
0004d1 e110       ldi	TempH, $10
0004d2 d129       rcall	PutBargraph
0004d3 9508       ret
                 
                 _BarEnd1:
0004d4 9611       adiw	XH:XL, 1
0004d5 cff2       rjmp	_BarEnd
                 
                 
                 
                 ;--------------------------------------------------
                 ClearBarGraph:
0004d6 9220 0147   sts	DisplayBuffer1+1, Null
0004d8 9220 015b   sts	DisplayBuffer2+1, Null
0004da 9220 014c   sts	DisplayBuffer1+6, Null
0004dc 9220 0160   sts	DisplayBuffer2+6, Null
0004de 9100 0151   lds	Temp, DisplayBuffer1+11
0004e0 7800        andi	Temp, 0b10000000
0004e1 9300 0151   sts	DisplayBuffer1+11, Temp
0004e3 9100 0165   lds	Temp, DisplayBuffer2+11
0004e5 7800        andi	Temp, 0b10000000
0004e6 9300 0165   sts	DisplayBuffer2+11, Temp
0004e8 9100 0156   lds	Temp, DisplayBuffer1+16
0004ea 7b0f        andi	Temp, 0b10111111
0004eb 9300 0156   sts	DisplayBuffer1+16, Temp
0004ed 9100 016a   lds	Temp, DisplayBuffer2+16
0004ef 7b0f        andi	Temp, 0b10111111
0004f0 9300 016a   sts	DisplayBuffer2+16, Temp
0004f2 9508        ret
                 
                 
                 
                 ;--------------------------------------------------
                 Clear_Screen:
0004f3 e4a6       ldi	XL, low (DisplayBuffer1)
0004f4 e0b1       ldi	XH, high (DisplayBuffer1)
0004f5 e218       ldi	TempH, 40
                 
                 _CSLoop:
0004f6 922d       st		X+, Null
0004f7 951a       dec	TempH
0004f8 f7e9       brne	_CSLoop
0004f9 9508       ret
                 
                 
                 ;--------------------------------------------------
                 Show_Current_Temperature:
0004fa 99f6       sbic	Status0, _MenuOn			;dont show current temperature in menu mode
0004fb 9508       ret
                  
0004fc 9100 0125  lds	Temp, UserDisplay			;in normal display mode show current temperature
0004fe 2300       tst	Temp
0004ff f101       breq	_SH_CTe0
                 
000500 3005       cpi	Temp, 5						;Show Set Temp
000501 f009       breq	_SH_CST
000502 c04d       rjmp	_SH_CTeE
                 
                 _SH_CST:
000503 9100 0129  lds	Temp, SetTempL
000505 9110 012a  lds	TempH, SetTempH
                  
000507 dde7       rcall	DivHL
                 
000508 2d0e       mov	Temp, Di2
000509 3300       cpi	Temp, '0'					;clear leading zero
00050a f409       brne	_SH_CTe00
00050b e30f       ldi	Temp, '?'					;SPACE
                 
                 _SH_CTe00:
00050c e110       ldi	TempH, $10					;blink set semperature
00050d d074       rcall	PutCharacter
00050e 2d0d       mov	Temp, Di1
00050f d072       rcall	PutCharacter
000510 2d0c       mov	Temp, Di0
000511 d070       rcall	PutCharacter
000512 e400       ldi	Temp, '@'					;degree sign
000513 d06e       rcall	PutCharacter
                 
000514 d0cc       rcall	Space2ndDisplayBuffer
                 
000515 9100 014d  lds	Temp, DisplayBuffer1+7		;clear point between segment 1 and 2
000517 770f       andi	Temp, 0b01111111
000518 9300 014d  sts	DisplayBuffer1+7, Temp
00051a 9100 0161  lds	Temp, DisplayBuffer2+7		
00051c 770f       andi	Temp, 0b01111111
00051d 9300 0161  sts	DisplayBuffer2+7, Temp
00051f c01c       rjmp	_SH_CTe1
                 
                 _SH_CTe0:
000520 9100 0134  lds	Temp, DispTimer				;update display only once
000522 2300       tst	Temp
000523 f561       brne	_SH_CTeE
                 
000524 9100 012e  lds	Temp, DisplayCT
000526 7007       andi	Temp, 0b000000111
000527 3000       cpi	Temp, 0
000528 f2d1       breq	_SH_CST
000529 3001       cpi	Temp, 1
00052a f529       brne	_SH_CTeE
                  
00052b 9100 0100  lds	Temp, TempIntL
00052d 9110 0101  lds	TempH, TempIntH
                 
00052f ddbf       rcall	DivHL
                 
000530 2d0e       mov	Temp, Di2
000531 3300       cpi	Temp, '0'					;clear leading zero
000532 f409       brne	_SH_CTe01
000533 e30f       ldi	Temp, '?'					;SPACE
                 
                 _SH_CTe01:
000534 e310       ldi	TempH, $30
000535 d04c       rcall	PutCharacter
000536 2d0d       mov	Temp, Di1
000537 d04a       rcall	PutCharacter
000538 2d0c       mov	Temp, Di0
000539 d048       rcall	PutCharacter
00053a e400       ldi	Temp, '@'					;degree sign
00053b d046       rcall	PutCharacter
                 
                 _SH_CTe1:
00053c 9100 0156  lds	Temp, DisplayBuffer1+16				;clear double point between segment 1 and 2
00053e 770f       andi	Temp, 0b01111111
00053f 9300 0156  sts	DisplayBuffer1+16, Temp
000541 9100 016a  lds	Temp, DisplayBuffer2+16				
000543 770f       andi	Temp, 0b01111111
000544 9300 016a  sts	DisplayBuffer2+16, Temp
                   
000546 9100 014d  lds	Temp, DisplayBuffer1+7				;set point between segment 1 and 2
000548 6800       ori	Temp, 0b10000000
000549 9300 014d  sts	DisplayBuffer1+7, Temp
00054b 9100 0161  lds	Temp, DisplayBuffer2+7				
00054d 6800       ori	Temp, 0b10000000
00054e 9300 0161  sts	DisplayBuffer2+7, Temp
                  
                 _SH_CTeE:
000550 9508       ret
                 
                 
                  ;--------------------------------------------------
                 Show_Current_Time:
000551 99f6       sbic	Status0, _MenuOn			;dont show current time in menu mode
000552 9508       ret
                  
000553 9100 0125  lds	Temp, UserDisplay			;show current time in normal display mode only
000555 3000       cpi	Temp, 0
000556 f551       brne	_SH_CTiE
                 
000557 9100 0134  lds	Temp, DispTimer				;update display only once
000559 2300       tst	Temp
00055a f531       brne	_SH_CTiE
                 
00055b 9100 012e  lds	Temp, DisplayCT
00055d 7007       andi	Temp, 0b000000111
00055e 3004       cpi	Temp, 4
00055f f509       brne	_SH_CTiE
                  
000560 9100 014d  lds	Temp, DisplayBuffer1+7				;clr point between segment 1 and 2
000562 770f       andi	Temp, 0b01111111
000563 9300 014d  sts	DisplayBuffer1+7, Temp
000565 9100 0161  lds	Temp, DisplayBuffer2+7				
000567 770f       andi	Temp, 0b01111111
000568 9300 0161  sts	DisplayBuffer2+7, Temp
                  
00056a 9100 0120  lds	Temp, Hours
00056c dda2       rcall 	DivDez
00056d 2d0d       mov	Temp, Di1
                 
00056e 3300       cpi	Temp, '0'					;clear leading zero
00056f f409       brne	_SH_CTi1
000570 e30f       ldi	Temp, '?'					;SPACE
                 
                 _SH_CTi1:
000571 e310       ldi	TempH, $30
000572 d00f       rcall	PutCharacter
000573 2d0c       mov	Temp, Di0
000574 d00d       rcall	PutCharacter
000575 9100 011f  lds	Temp, Minutes
000577 dd97       rcall 	DivDez
000578 2d0d       mov	Temp, Di1
000579 d008       rcall	PutCharacter
00057a 2d0c       mov	Temp, Di0
00057b d006       rcall	PutCharacter
                  
00057c 9100 0156  lds	Temp, DisplayBuffer1+16				;set colon between segment 1 and 2
00057e 6800       ori	Temp, 0b10000000
00057f 9300 0156  sts	DisplayBuffer1+16, Temp
                 
                 _SH_CTiE:
000581 9508       ret
                 
                 
                 ;------------------------------------------------------------------------
                 ; write character to LCD
                 ; Input:	Temp: Character value ASCII 
                 ;			TempH: high nibble: Buffer number 1..3 (3 means both display buffers) / low nibble: Address 0..3 for digit position, 
                 ;
                 ; Output:	none
                 ; Used:		Temp3, Temp4, ZL, ZH, XL, XH, Di0, Di1
                 
                 ;------------------------------------------------------------------------
                 PutCharacter:
000582 5300       subi	Temp, 48								;start of character table in ASCII
000583 92cf       push	Di0
000584 92df       push	Di1
000585 93ef       push	ZL
000586 93ff       push	ZH
000587 93af       push	XL
000588 93bf       push	XH
000589 931f       push	TempH									;store current address for increment after routine
                  
00058a 2f91       mov	Temp4, TempH							;save digit address
00058b 7f10       andi	TempH, $F0
00058c 9512       swap	TempH
00058d 3011       cpi	TempH, 1
00058e f029       breq	_CharacterLoop1
00058f 3012       cpi	TempH, 2
000590 f039       breq	_CharacterLoop2
000591 3013       cpi	TempH, 3
000592 f049       breq	_CharacterLoop3
000593 c012       rjmp	_PutCharacter_End
                  
                 _CharacterLoop1: 
000594 e4a6       ldi	XL, low(DisplayBuffer1)
000595 e0b1       ldi	XH, high(DisplayBuffer1)
000596 d018       rcall	_Get_Character
000597 c00e       rjmp	_PutCharacter_End
                  
                 _CharacterLoop2: 
000598 e5aa       ldi	XL, low(DisplayBuffer2)
000599 e0b1       ldi	XH, high(DisplayBuffer2)
00059a d014       rcall	_Get_Character
00059b c00a       rjmp	_PutCharacter_End
                 
                 _CharacterLoop3: 
00059c e4a6       ldi	XL, low(DisplayBuffer1)
00059d e0b1       ldi	XH, high(DisplayBuffer1)
00059e 930f       push	Temp								;save character and address for next loop
00059f 939f       push	Temp4
0005a0 d00e       rcall	_Get_Character
0005a1 e5aa       ldi	XL, low(DisplayBuffer2)
0005a2 e0b1       ldi	XH, high(DisplayBuffer2)
0005a3 919f       pop	Temp4								;restore character and address
0005a4 910f       pop	Temp
0005a5 d009       rcall	_Get_Character
                 
                 _PutCharacter_End:
0005a6 911f       pop	TempH								;increment current digit address
0005a7 9513       inc	TempH
0005a8 91bf       pop	XH
0005a9 91af       pop	XL
0005aa 91ff       pop	ZH
0005ab 91ef       pop	ZL
0005ac 90df       pop	Di1
0005ad 90cf       pop	Di0 
0005ae 9508       ret
                 
                 _Get_Character:
0005af e0ff       ldi	ZH, high(LCD_Character_Table*2)			;load character bitmap pointer
0005b0 e0e6       ldi	ZL, low(LCD_Character_Table*2)
0005b1 e082       ldi	Temp3, 2
0005b2 9f08       mul	Temp, Temp3
0005b3 0de0       add	ZL, r0
0005b4 1df1       adc	ZH, r1									;add character value to pointer
0005b5 90d5       lpm	Di1, Z+									;store character bitmap
0005b6 90c4       lpm	Di0, Z
                  
0005b7 e0fe       ldi	ZH, high(LCD_Segment_Table*2)			;load character segment bit position pointer
0005b8 ecee       ldi	ZL, low(LCD_Segment_Table*2)
0005b9 e08e       ldi	Temp3, 14								
0005ba 709f       andi	Temp4, $0F
0005bb 9f98       mul	Temp4, Temp3
0005bc 0de0       add	ZL, r0									;add digit address to pointer
0005bd 1df1       adc	ZH, r1
                 
0005be e09e       ldi	Temp4, 14
                 
                 _CharacterLoop: 
0005bf fac0       bst	Di0, 0									;mask LSB of character bitmap and store it into T-flag
0005c0 94d6       lsr	Di1										;shift bitmap right 
0005c1 94c7       ror	Di0
0005c2 9115       lpm	TempH, Z+								;load segment position (combined LCDDR-Byte/Bit position)
                   
0005c3 2f01       mov	Temp, TempH
0005c4 7f18       andi	TempH, 0b11111000						;get byte number 
0005c5 9516       lsr	TempH
0005c6 9516       lsr	TempH
0005c7 9516       lsr	TempH
0005c8 93af       push	XL										;save current x-pointer before addition
0005c9 93bf       push	XH
0005ca 0fa1       add	XL, TempH
0005cb 1db2       adc	XH, Null 
0005cc 918c       ld		Temp3, X 								;load current byte content
0005cd 2f10       mov	TempH, Temp
0005ce 7017       andi	TempH, 0b00000111						;mask bit position
0005cf e001       ldi	Temp, 0b00000001
                  
                 _CharLoop1:
0005d0 3010       cpi	TempH, 0								;get bit position by shifting 
0005d1 f019       breq	_CharLoop2
0005d2 0f00       lsl	Temp
0005d3 951a       dec	TempH
0005d4 cffb       rjmp	_CharLoop1
                 
                 _CharLoop2:
0005d5 f026       brts	_CharBitSet								;check if setting or clearing bit in memory
                 
                 _CharBitClear:
0005d6 9500       com	Temp
0005d7 2380       and 	Temp3, Temp
0005d8 938c       st		X, Temp3
0005d9 c002       rjmp	_CharLoop3
                 
                 _CharBitSet:
0005da 2b80       or 	Temp3, Temp
0005db 938c       st		X, Temp3
                  
                 _CharLoop3:
0005dc 91bf       pop	XH										;restore current x-pointer
0005dd 91af       pop	XL 
0005de 959a       dec	Temp4
0005df f6f9       brne	_CharacterLoop
0005e0 9508       ret
                 
                 
                 ;----------------------------------------------
                 Space2ndDisplayBuffer:
0005e1 e30f       ldi	Temp, '?'
0005e2 e210       ldi	TempH, $20
0005e3 df9e       rcall	PutCharacter
0005e4 e30f       ldi	Temp, '?'
0005e5 df9c       rcall	PutCharacter
0005e6 e30f       ldi	Temp, '?'
0005e7 df9a       rcall	PutCharacter
0005e8 e30f       ldi	Temp, '?'					 
0005e9 df98       rcall	PutCharacter
0005ea 9508       ret
                 
                 
                 
                 
                 ;----------------------------------------------
                 Copy_DisplayBuffers:
0005eb e114       ldi	TempH, 20
0005ec 9100 0134  lds	Temp, DispTimer
0005ee fd01       sbrc	Temp, 1
0005ef c003       rjmp	_C_DB2
                 
0005f0 e4a6       ldi	XL, low(DisplayBuffer1)
0005f1 e0b1       ldi	XH, high(DisplayBuffer1)
0005f2 c002       rjmp	_C_DB 
                 
                 _C_DB2:
0005f3 e5aa       ldi	XL, low(DisplayBuffer2)
0005f4 e0b1       ldi	XH, high(DisplayBuffer2)
                   
                 _C_DB:
0005f5 eecc       ldi	YL, low (LCDDR0)
0005f6 e0d0       ldi	YH, high (LCDDR0)
                 
                 _C_DB1:
0005f7 910d       ld		Temp, X+
0005f8 9309       st		Y+, Temp
0005f9 951a       dec	TempH
0005fa f7e1       brne	_C_DB1 
0005fb 9508       ret
                 
                 
                 ;------------------------------------------------------------------------
                 ; write bargraph to LCD
                 ; Input:	Temp: Bargraph position to write, MSB 0: clear bit, MSB1: set bit 
                 ;			TempH: high nibble: Buffer number 1..3 (3 means both display buffers)
                 ; Output:	none
                 ; Used:		Temp3, ZL, ZH, XL, XH
                 
                 ;------------------------------------------------------------------------
                 PutBargraph:
0005fc 93ef       push	ZL
0005fd 93ff       push	ZH
0005fe e5ec       ldi	ZL, low(Bargraph_Table*2)
0005ff e0ff       ldi	ZH, high(Bargraph_Table*2)				;load character segment bit position pointer
000600 c009       rjmp	_OutSymbols
                 
                 
                 ;------------------------------------------------------------------------
                 ; write Day of Week to LCD
                 ; Input:	Temp: Day of Week position to set
                 ;			TempH: high nibble: Buffer number 1..3 (3 means both display buffers)
                 ; Output:	none
                 ; Used:		Temp3, ZL, ZH, XL, XH
                 
                 ;------------------------------------------------------------------------
                 PutWeekDay:
000601 93ef       push	ZL
000602 93ff       push	ZH
000603 e0ff       ldi	ZH, high(WDayTable*2)						;load character segment bit position pointer
000604 e7e4       ldi	ZL, low(WDayTable*2)
000605 c004       rjmp	_OutSymbols
                 
                 
                 
                 
                 ;------------------------------------------------------------------------
                 ; write Symbol to LCD
                 ; Input:	Temp: Symbol number, MSB 1: set symbol // MSB 0: clear symbol
                 ;			TempH: high nibble: Buffer number 1..3 (3 means both display buffers)
                 ; Output:	none
                 ; Used:		Temp3, ZL, ZH, XL, XH
                 
                 
                  ;------------------------------------------------------------------------
                 PutSymbol:
000606 93ef       push	ZL
000607 93ff       push	ZH
000608 e7ec       ldi	ZL, low(SymbolTable*2)
000609 e0ff       ldi	ZH, high(SymbolTable*2)					;load character segment bit position pointer
                 
                 
                 _OutSymbols:
00060a 93af       push	XL
00060b 93bf       push	XH
00060c 931f       push	TempH
00060d 938f       push	Temp3
                  
00060e 7f10       andi	TempH, $F0									;mask buffer to write to
00060f 9512       swap	TempH
000610 3011       cpi	TempH, 1
000611 f029       breq	_Symbol1
000612 3012       cpi	TempH, 2
000613 f039       breq	_Symbol2
000614 3013       cpi	TempH, 3
000615 f049       breq	_Symbol3
000616 c012       rjmp	_PSym_End
                 
                 _Symbol1:
000617 e4a6       ldi	XL, low(DisplayBuffer1)
000618 e0b1       ldi	XH, high(DisplayBuffer1)
000619 d016       rcall	_WriteSymbol
00061a c00e       rjmp	_PSym_End
                 
                 _Symbol2:
00061b e5aa       ldi	XL, low(DisplayBuffer2)
00061c e0b1       ldi	XH, high(DisplayBuffer2)
00061d d012       rcall	_WriteSymbol
00061e c00a       rjmp	_PSym_End
                 
                 _Symbol3:
00061f e4a6       ldi	XL, low(DisplayBuffer1)
000620 e0b1       ldi	XH, high(DisplayBuffer1)
000621 930f       push	Temp
000622 93ef       push	ZL
000623 93ff       push	ZH
000624 d00b       rcall	_WriteSymbol
000625 91ff       pop	ZH										;restore pointer and data for 2nd run
000626 91ef       pop	ZL 
000627 910f       pop	Temp
000628 cff2       rjmp	_Symbol2
                  
                 _PSym_End:
000629 918f       pop	Temp3
00062a 911f       pop	TempH
00062b 91bf       pop	XH
00062c 91af       pop	XL
00062d 91ff       pop	ZH
00062e 91ef       pop	ZL
00062f 9508       ret
                   
                 _WriteSymbol:
000630 fb07       bst	Temp, 7									;store MSB in T-Flag
000631 710f       andi	Temp, 0b00011111
000632 0fe0       add	ZL, Temp								;add digit address to pointer
000633 1df2       adc	ZH, Null
                 
000634 9115       lpm	TempH, Z+								;load segment position (combined LCDDR-Byte/Bit position)
                  
000635 2f01       mov	Temp, TempH
000636 7f18       andi	TempH, 0b11111000						;get byte number 
000637 9516       lsr	TempH
000638 9516       lsr	TempH
000639 9516       lsr	TempH
00063a 0fa1       add	XL, TempH
00063b 1db2       adc	XH, Null 
00063c 918c       ld		Temp3, X 								;load current byte content
00063d 2f10       mov	TempH, Temp
00063e 7017       andi	TempH, 0b00000111						;mask bit position
00063f e001       ldi	Temp, 0b00000001
                  
                 _SymbolLoop1:
000640 3010       cpi	TempH, 0								;get bit position by shifting 
000641 f019       breq	_SymbolLoop2
000642 0f00       lsl	Temp
000643 951a       dec	TempH
000644 cffb       rjmp	_SymbolLoop1
                 
                 _SymbolLoop2:
000645 f026       brts	_SymbolBitSet							;check if set or clear bit in memory
                 
                 _SymbolBitClear:
000646 9500       com	Temp
000647 2380       and 	Temp3, Temp
000648 938c       st		X, Temp3
000649 9508       ret
                 
                 _SymbolBitSet:
00064a 2b80       or 	Temp3, Temp
00064b 938c       st		X, Temp3
00064c 9508       ret
                 
                 
                 ;---------------------------------
                 SetAuto:
00064d 9100 0150  lds	Temp, DisplayBuffer1+10				
00064f 6001       ori	Temp, 0b00000001
000650 9300 0150  sts	DisplayBuffer1+10, Temp
000652 9100 0164  lds	Temp, DisplayBuffer2+10				
000654 6001       ori	Temp, 0b00000001
000655 9300 0164  sts	DisplayBuffer2+10, Temp
000657 9508       ret
                 
                 ;---------------------------------
                 ClearAuto:
000658 9100 0150  lds	Temp, DisplayBuffer1+10				
00065a 7f0e       andi	Temp, 0b11111110
00065b 9300 0150  sts	DisplayBuffer1+10, Temp
00065d 9100 0164  lds	Temp, DisplayBuffer2+10			
00065f 7f0e       andi	Temp, 0b11111110
000660 9300 0164  sts	DisplayBuffer2+10, Temp
000662 9508       ret
                 
                 ;---------------------------------
                 SetManu:
000663 9100 0155  lds	Temp, DisplayBuffer1+15				
000665 6001       ori	Temp, 0b00000001
000666 9300 0155  sts	DisplayBuffer1+15, Temp
000668 9100 0169  lds	Temp, DisplayBuffer2+15				
00066a 6001       ori	Temp, 0b00000001
00066b 9300 0169  sts	DisplayBuffer2+15, Temp
00066d 9508       ret
                 
                 ;---------------------------------
                 ClearManu:
00066e 9100 0155  lds	Temp, DisplayBuffer1+15				
000670 7f0e       andi	Temp, 0b11111110
000671 9300 0155  sts	DisplayBuffer1+15, Temp
000673 9100 0169  lds	Temp, DisplayBuffer2+15			
000675 7f0e       andi	Temp, 0b11111110
000676 9300 0169  sts	DisplayBuffer2+15, Temp
000678 9508       ret
                 
                 ;---------------------------------
                 SetColon:
000679 9100 0156  lds	Temp, DisplayBuffer1+16				;set colon between segment 1 and 2
00067b 6800       ori	Temp, 0b10000000
00067c 9300 0156  sts	DisplayBuffer1+16, Temp
00067e 9100 016a  lds	Temp, DisplayBuffer2+16				;set colon between segment 1 and 2
000680 6800       ori	Temp, 0b10000000
000681 9300 016a  sts	DisplayBuffer2+16, Temp
000683 9508       ret
                 
                 ;---------------------------------
                 ClearColon:
000684 9100 0156  lds	Temp, DisplayBuffer1+16				;clear colon between segment 1 and 2
000686 770f       andi	Temp, 0b01111111
000687 9300 0156  sts	DisplayBuffer1+16, Temp
000689 9100 016a  lds	Temp, DisplayBuffer2+16				
00068b 770f       andi	Temp, 0b01111111
00068c 9300 016a  sts	DisplayBuffer2+16, Temp
00068e 9508       ret
                 
                 ;---------------------------------
                 SetPoint:
00068f 9100 014d  lds	Temp, DisplayBuffer1+7				;set point between segment 1 and 2
000691 6800       ori	Temp, 0b10000000
000692 9300 014d  sts	DisplayBuffer1+7, Temp
000694 9100 0161  lds	Temp, DisplayBuffer2+7				 
000696 6800       ori	Temp, 0b10000000
000697 9300 0161  sts	DisplayBuffer2+7, Temp
000699 9508       ret
                 
                 ;---------------------------------
                 ClearPoint:
00069a 9100 014d  lds	Temp, DisplayBuffer1+7
00069c 770f       andi	Temp, 0b01111111					;clear point between segment 1 and 2
00069d 9300 014d  sts	DisplayBuffer1+7, Temp
00069f 9100 0161  lds	Temp, DisplayBuffer2+7
0006a1 770f       andi	Temp, 0b01111111				 
0006a2 9300 0161  sts	DisplayBuffer2+7, Temp
0006a4 9508       ret
                 
                 
                  ;------------------------------------------------------------------------
                 CopyWeekDays1_2:
0006a5 9100 0156  lds	Temp, DisplayBuffer1+16
0006a7 9110 016a  lds	TempH, DisplayBuffer2+16
0006a9 730f       andi	Temp, 0b00111111
0006aa 7c10       andi	TempH, 0b11000000
0006ab 2b10       or		TempH, Temp
0006ac 9310 016a  sts	DisplayBuffer2+16, TempH
0006ae 9100 0151  lds	Temp, DisplayBuffer1+11
0006b0 9110 0165  lds	TempH, DisplayBuffer2+11
0006b2 7800       andi	Temp, 0b10000000
0006b3 771f       andi	TempH, 0b01111111
0006b4 2b10       or		TempH, Temp
0006b5 9310 0165  sts	DisplayBuffer2+11, TempH
0006b7 9508       ret
                 
                 
                 ;------------------------------------------------------------------------
                 ClearWeekDays: 
0006b8 9180 0156  lds	Temp3, DisplayBuffer1+16					;clear all days of week on LCD
0006ba 7c80       andi	Temp3, 0b11000000
0006bb 9380 0156  sts	DisplayBuffer1+16, Temp3
0006bd 9180 016a  lds	Temp3, DisplayBuffer2+16
0006bf 7c80       andi	Temp3, 0b11000000
0006c0 9380 016a  sts	DisplayBuffer2+16, Temp3
0006c2 9180 0151  lds	Temp3, DisplayBuffer1+11					
0006c4 778f       andi	Temp3, 0b01111111
0006c5 9380 0151  sts	DisplayBuffer1+11, Temp3
0006c7 9180 0165  lds	Temp3, DisplayBuffer2+11
0006c9 778f       andi	Temp3, 0b01111111
0006ca 9380 0165  sts	DisplayBuffer2+11, Temp3
0006cc 9508       ret
                 
                  
                 ;------------------------------------------------------------------------
                 ClearInHouse: 
0006cd 9100 0149  lds	Temp, DisplayBuffer1+3		;InHouse
0006cf 7f0e       andi	Temp, 0b11111110
0006d0 9300 0149  sts	DisplayBuffer1+3, Temp 
0006d2 9100 015d  lds	Temp, DisplayBuffer2+3
0006d4 7f0e       andi	Temp, 0b11111110
0006d5 9300 015d  sts	DisplayBuffer2+3, Temp 
0006d7 9508       ret
                 
                 ClearOffHouse:
0006d8 9100 014e  lds	Temp, DisplayBuffer1+8		;OffHouse
0006da 7f0e       andi	Temp, 0b11111110
0006db 9300 014e  sts	DisplayBuffer1+8, Temp 
0006dd 9100 0162  lds	Temp, DisplayBuffer2+8
0006df 7f0e       andi	Temp, 0b11111110
0006e0 9300 0162  sts	DisplayBuffer2+8, Temp 
0006e2 9508       ret
                 
                 ClearMoon:
0006e3 9100 0153  lds	Temp, DisplayBuffer1+13		;Moon
0006e5 7f0e       andi	Temp, 0b11111110
0006e6 9300 0153  sts	DisplayBuffer1+13, Temp 
0006e8 9100 0167  lds	Temp, DisplayBuffer2+13
0006ea 7f0e       andi	Temp, 0b11111110
0006eb 9300 0167  sts	DisplayBuffer2+13, Temp 
0006ed 9508       ret
                 
                 ClearCase:
0006ee 9100 014b  lds	Temp, DisplayBuffer1+5		;Case 
0006f0 7f0e       andi	Temp, 0b11111110
0006f1 9300 014b  sts	DisplayBuffer1+5, Temp
0006f3 9100 015f  lds	Temp, DisplayBuffer2+5				 
0006f5 7f0e       andi	Temp, 0b11111110
0006f6 9300 015f  sts	DisplayBuffer2+5, Temp
0006f8 9508       ret
                 
                 
                 ;------------------------------------------------------------------------
                 SetInHouse: 
0006f9 9100 0149  lds	Temp, DisplayBuffer1+3		;InHouse
0006fb 6001       ori	Temp, 0b00000001
0006fc 9300 0149  sts	DisplayBuffer1+3, Temp 
0006fe 9100 015d  lds	Temp, DisplayBuffer2+3
000700 6001       ori	Temp, 0b00000001
000701 9300 015d  sts	DisplayBuffer2+3, Temp 
000703 9508       ret
                 
                 SetOffHouse:
000704 9100 014e  lds	Temp, DisplayBuffer1+8		;OffHouse
000706 6001       ori	Temp, 0b00000001
000707 9300 014e  sts	DisplayBuffer1+8, Temp 
000709 9100 0162  lds	Temp, DisplayBuffer2+8
00070b 6001       ori	Temp, 0b00000001
00070c 9300 0162  sts	DisplayBuffer2+8, Temp 
00070e 9508       ret
                 
                 SetMoon:
00070f 9100 0153  lds	Temp, DisplayBuffer1+13		;Moon
000711 6001       ori	Temp, 0b00000001
000712 9300 0153  sts	DisplayBuffer1+13, Temp 
000714 9100 0167  lds	Temp, DisplayBuffer2+13
000716 6001       ori	Temp, 0b00000001
000717 9300 0167  sts	DisplayBuffer2+13, Temp 
000719 9508       ret
                 
                 SetCase:
00071a 9100 014b  lds	Temp, DisplayBuffer1+5		;Case 
00071c 6001       ori	Temp, 0b00000001
00071d 9300 014b  sts	DisplayBuffer1+5, Temp
00071f 9100 015f  lds	Temp, DisplayBuffer2+5				 
000721 6001       ori	Temp, 0b00000001
000722 9300 015f  sts	DisplayBuffer2+5, Temp
000724 9508       ret
                 
                 
                 
                 ;------------------------------------------------------------------------
                 BlinkInHouse: 
000725 9100 0149  lds	Temp, DisplayBuffer1+3		;InHouse
000727 7f0e       andi	Temp, 0b11111110
000728 9300 0149  sts	DisplayBuffer1+3, Temp 
00072a 9100 015d  lds	Temp, DisplayBuffer2+3
00072c 6001       ori	Temp, 0b00000001
00072d 9300 015d  sts	DisplayBuffer2+3, Temp 
00072f 9508       ret
                 
                 BlinkOffHouse:
000730 9100 014e  lds	Temp, DisplayBuffer1+8		;OffHouse
000732 7f0e       andi	Temp, 0b11111110
000733 9300 014e  sts	DisplayBuffer1+8, Temp 
000735 9100 0162  lds	Temp, DisplayBuffer2+8
000737 6001       ori	Temp, 0b00000001
000738 9300 0162  sts	DisplayBuffer2+8, Temp 
00073a 9508       ret
                 
                 BlinkMoon:
00073b 9100 0153  lds	Temp, DisplayBuffer1+13		;Moon
00073d 7f0e       andi	Temp, 0b11111110
00073e 9300 0153  sts	DisplayBuffer1+13, Temp 
000740 9100 0167  lds	Temp, DisplayBuffer2+13
000742 6001       ori	Temp, 0b00000001
000743 9300 0167  sts	DisplayBuffer2+13, Temp 
000745 9508       ret
                 
                 BlinkCase:
000746 9100 014b  lds	Temp, DisplayBuffer1+5		;Case 
000748 7f0e       andi	Temp, 0b11111110
000749 9300 014b  sts	DisplayBuffer1+5, Temp
00074b 9100 015f  lds	Temp, DisplayBuffer2+5				 
00074d 6001       ori	Temp, 0b00000001
00074e 9300 015f  sts	DisplayBuffer2+5, Temp
000750 9508       ret
                 
                 ;------------------------------------------------------------------------
                 SetHourLegend:
000751 9100 0146  lds	Temp, DisplayBuffer1					;switch on hour marking
000753 6001       ori	Temp, 0b00000001	
000754 9300 0146  sts	DisplayBuffer1, Temp
000756 9100 015a  lds	Temp, DisplayBuffer2
000758 6001       ori	Temp, 0b00000001	
000759 9300 015a  sts	DisplayBuffer2, Temp
00075b 9508       ret
                 
                 ClearHourLegend:
00075c 9100 0146  lds	Temp, DisplayBuffer1
00075e 7f0e       andi	Temp, 0b11111110
00075f 9300 0146  sts	DisplayBuffer1, Temp 
000761 9100 015a  lds	Temp, DisplayBuffer2
000763 7f0e       andi	Temp, 0b11111110
000764 9300 015a  sts	DisplayBuffer2, Temp 
000766 9508       ret
                 
                 
                 .include	"LCDTable.inc"
                 
                 ;LCD alphanumeric chracter segment bit position
                 LCD_Segment_Table:
                 
                 ;		a	b	c	d	e	f	g1	g2	h	i	j	k	l	m
000767 7c7e
000768 052c
000769 7f07
00076a 552f
00076b 5657
00076c 2d7d
00076d 062e      .db	   126,124, 44,  5,  7,127, 47, 85, 87, 86,125, 45, 46,  6	;left Digit
00076e 797b
00076f 0201
000770 5404
000771 512b
000772 5253
000773 297a
000774 032a      .db	   123,121,  1,  2,  4, 84, 43, 81, 83, 82,122, 41, 42,  3	;middle left Digit
000775 8b89
000776 123b
000777 8810
000778 6238
000779 6160
00077a 3a8a
00077b 1139      .db	   137,139, 59, 18, 16,136, 56, 98, 96, 97,138, 58, 57, 17	;middle right Digit
00077c 8e8c
00077d 1516
00077e 6313
00077f 663c
000780 6564
000781 3e8d
000782 143d      .db	   140,142, 22, 21, 19, 99, 60,102,100,101,141, 62, 61, 20	;right Digit
                 
                 
                 ;------------------------------------------------------------
                 ;LCD alphanumeric chracter bitmap
                 LCD_Character_Table:
                 ;				 21
                 ;		mlkjih	 ggfedcba
000783 3f24      .db	0b00100100,0b00111111		;0
000784 0604      .db	0b00000100,0b00000110		;1
000785 db00      .db	0b00000000,0b11011011		;2
000786 8f00      .db	0b00000000,0b10001111		;3
000787 e600      .db	0b00000000,0b11100110		;4
000788 ed00      .db	0b00000000,0b11101101		;5
000789 fd00      .db	0b00000000,0b11111101		;6
00078a 0114      .db	0b00010100,0b00000001		;7
00078b ff00      .db	0b00000000,0b11111111		;8
00078c ef00      .db	0b00000000,0b11101111		;9
00078d c000      .db	0b00000000,0b11000000		;:	used as '-'
00078e 0022      .db	0b00100010,0b00000000		;;
00078f 000c      .db	0b00001100,0b00000000		;<
000790 c800      .db	0b00000000,0b11001000		;=
000791 0011      .db	0b00010001,0b00000000		;>
000792 0000      .db	0b00000000,0b00000000		;?  used as 'SPACE'
000793 e300      .db	0b00000000,0b11100011		;@  used as '' character
000794 f700      .db	0b00000000,0b11110111		;A
000795 8f12      .db	0b00010010,0b10001111		;B
000796 3900      .db	0b00000000,0b00111001		;C
000797 0f12      .db	0b00010010,0b00001111		;D
000798 7900      .db	0b00000000,0b01111001		;E
000799 7100      .db	0b00000000,0b01110001		;F
00079a bd00      .db	0b00000000,0b10111101		;G
00079b f600      .db	0b00000000,0b11110110		;H
00079c 0912      .db	0b00010010,0b00001001		;I
00079d 1e00      .db	0b00000000,0b00011110		;J
00079e 700c      .db	0b00001100,0b01110000		;K
00079f 3800      .db	0b00000000,0b00111000		;L
0007a0 3605      .db	0b00000101,0b00110110		;M
0007a1 3609      .db	0b00001001,0b00110110		;N
0007a2 3f00      .db	0b00000000,0b00111111		;O
0007a3 f300      .db	0b00000000,0b11110011		;P
0007a4 3f08      .db	0b00001000,0b00111111		;Q
0007a5 f308      .db	0b00001000,0b11110011		;R
0007a6 ed00      .db	0b00000000,0b11101101		;S
0007a7 0112      .db	0b00010010,0b00000001		;T
0007a8 3e00      .db	0b00000000,0b00111110		;U
0007a9 3024      .db	0b00100100,0b00110000		;V
0007aa 3628      .db	0b00101000,0b00110110		;W
0007ab 002d      .db	0b00101101,0b00000000		;X
0007ac 0015      .db	0b00010101,0b00000000		;Y
0007ad 0924      .db	0b00100100,0b00001001		;Z
                 ;		mlkjih	 ggfedcba
                 
                 ;-----------------------------------------------------------
                 ;Bargraph segment bit position
                 Bargraph_Table:
0007ae 3058
0007af 0908
0007b0 5931
0007b1 325a      .db 88, 48,  8,  9, 49, 89, 90, 50
0007b2 0b0a
0007b3 5b33
0007b4 345c
0007b5 0d0c      .db 10, 11, 51, 91, 92, 52, 12, 13
0007b6 5d35
0007b7 5e86
0007b8 0e36
0007b9 370f      .db	53, 93,134, 94, 54, 14, 15, 55 						
                 
                 
                 ;-----------------------------------------------------------
                 ;Week day bit position
                 WDayTable:
0007ba 8180
0007bb 8382
0007bc 8584
0007bd 005f      .db	128,129,130,131,132,133,95,0			;Mo..So
                 
                 
                 ;-----------------------------------------------------------
                 ;Symbol bit position
                 SymbolTable:
0007be 5000
0007bf 2878
0007c0 1817
0007c1 6840
0007c2 6790
0007c3 008f      .db 0,80,120,40,23,24,64,104,144,103,143,0 
                 
                 
                 
                 .include	"Debug.inc"
                 
                 /* ;--------------------------------------------------
                 Show_NTC_ADC:
                  lds	Temp, NTCIntL
                  lds	TempH, NTCIntH
                  rcall	DivDec
                 
                  ldi	TempH, 0
                  mov	Temp, Di2
                  rcall	PutCharacter
                  ldi	TempH, 1
                  mov	Temp, Di1
                  rcall	PutCharacter
                  ldi	TempH, 2
                  mov	Temp, Di0
                  rcall	PutCharacter
                  ldi	TempH, 3
                  ldi	Temp, '?'					;space
                  rcall	PutCharacter
                 
                 
                  lds	Temp, LCDDR7				;clr point between segment 1 and 2
                  andi	Temp, 0b01111111
                  sts	LCDDR7, Temp
                  ret
                 */
                 
                 
                 /* ;--------------------------------------------------
                 Show_Motor:
                  lds	Temp, MotTimeout
                  rcall	DivHex
                 
                  ldi	TempH, 0
                  mov	Temp, Di1
                  rcall	PutCharacter
                  ldi	TempH, 1
                  mov	Temp, Di0
                  rcall	PutCharacter
                 
                  lds	Temp, RFLXCTL
                  rcall	DivHex
                 
                  ldi	TempH, 2
                  mov	Temp, Di1
                  rcall	PutCharacter
                  ldi	TempH, 3
                  mov	Temp, Di0
                  rcall	PutCharacter
                  ret*/
                 
                 /*  ;--------------------------------------------------
                 Show_MotorCurrent:
                  lds	Temp, MotTimeout
                  rcall	DivHex
                  ldi	TempH, 0
                  mov	Temp, Di1
                  rcall	PutCharacter
                  ldi	TempH, 1
                  mov	Temp, Di0
                  rcall	PutCharacter
                 
                  lds	Temp, MotorCurrent
                  rcall	DivHex
                 
                  ldi	TempH, 2
                  mov	Temp, Di1
                  rcall	PutCharacter
                  ldi	TempH, 3
                  mov	Temp, Di0
                  rcall	PutCharacter
                  ret
                 
                 */
                 
                 
                 .include	"Motor.inc"
                 
                 ;--------------------------------------------------
                 Adaptation:
0007c4 9bf3       sbis	Status0, _Adapt						;execute in adaptation mode only
0007c5 9508       ret
                 
0007c6 9bf1       sbis	Status0, _MotDir
0007c7 c03d       rjmp	_Adapt3
                 
                 _Adapt0:
0007c8 9100 0111  lds	Temp, RFLXCTL
0007ca 9110 0112  lds	TempH, RFLXCTH
                 
0007cc 3608       cpi	Temp, low(MaxAdaptWay-20)			;get freewheeling motor current on outer position -n
0007cd e081       ldi	Temp3, high(MaxAdaptWay-20)
0007ce 0718       cpc	TempH, Temp3
0007cf f481       brne	_Adapt1
                 
0007d0 940e 1252  call	Measure_Motor_Current
                 
0007d2 9180 0119  lds	Temp3, MotorCurrent
0007d4 9380 011a  sts	FreeMotorCurrent, Temp3
0007d6 9180 0151  lds	Temp3, DisplayBuffer1+11			;set bargraph point 1, freewheeling current measured
0007d8 6081       ori	Temp3, 0b00000001
0007d9 9380 0151  sts	DisplayBuffer1+11, Temp3
0007db 9180 0165  lds	Temp3, DisplayBuffer2+11						 
0007dd 6081       ori	Temp3, 0b00000001
0007de 9380 0165  sts	DisplayBuffer2+11, Temp3
                  
                 _Adapt1:
0007e0 9180 0119  lds	Temp3, MotorCurrent
0007e2 9190 011a  lds	Temp4, FreeMotorCurrent
0007e4 1b89       sub	Temp3, Temp4
0007e5 f408       brcc	_Adapt2
0007e6 2788       clr	Temp3
                 
                 _Adapt2:
0007e7 308a       cpi	Temp3, 10							;threshold current over freewheeling current, to detect valve touch
0007e8 f0e0       brcs	_Adapt3
                 
0007e9 9100 014c  lds	Temp, DisplayBuffer1+6				;execute only once if the current rises above threshold
0007eb fd00       sbrc	Temp, 0
0007ec c012       rjmp	_Adapt2_1
                 
0007ed 9180 0119  lds	Temp3, MotorCurrent
0007ef 9380 011b  sts	ValveMotorCurrent, Temp3
                  
0007f1 9220 0113  sts	PositionL, Null
0007f3 9220 0114  sts	PositionH, Null
                 
0007f5 9100 014c  lds	Temp, DisplayBuffer1+6				;set bargraph point 2, touch current measured
0007f7 6001       ori	Temp, 0b00000001
0007f8 9300 014c  sts	DisplayBuffer1+6, Temp
0007fa 9100 0160  lds	Temp, DisplayBuffer2+6					
0007fc 6001       ori	Temp, 0b00000001
0007fd 9300 0160  sts	DisplayBuffer2+6, Temp
                  
                 _Adapt2_1:
0007ff e100       ldi	Temp, $10							;keep Reflex counter well above 0
000800 e010       ldi	TempH, $00
000801 9300 0111  sts	RFLXCTL, Temp
000803 9310 0112  sts	RFLXCTH, TempH
                  
                 
                 _Adapt3:
000805 99f2       sbic	Status0, _MotRun
000806 9508       ret 
                  
000807 9110 0118  lds	TempH, AdaptStep
000809 3010       cpi	TempH, 0
00080a f041       breq	_AdpOpenValve
00080b 3012       cpi	TempH, 2
00080c f131       breq	_WaitADP_OK
00080d 3014       cpi	TempH, 4
00080e f1f9       breq	_AdpCloseValve
00080f 3016       cpi	TempH, 6
000810 f009       breq	_AdpEndX 
000811 9508       ret
                 
                 _AdpEndX:
000812 c05f       rjmp	_AdpEnd
                 
                   
                 _AdpOpenValve:
000813 98f1       cbi	Status0, _MotDir
000814 9af0       sbi 	Status0, _MotOn	
000815 9220 0117  sts	MotTimeOut, Null
000817 9513       inc	TempH
000818 9310 0118  sts	AdaptStep, TempH
00081a e30c       ldi	Temp, '<'
00081b e110       ldi	TempH, $10
00081c dd65       rcall	PutCharacter
00081d e30f       ldi	Temp, '?'
00081e dd63       rcall	PutCharacter
00081f e30c       ldi	Temp, '<'
000820 dd61       rcall	PutCharacter
000821 e30f       ldi	Temp, '?'
000822 dd5f       rcall	PutCharacter
000823 e30f       ldi	Temp, '?'
000824 e210       ldi	TempH, $20
000825 dd5c       rcall	PutCharacter
000826 e30c       ldi	Temp, '<'
000827 dd5a       rcall	PutCharacter
000828 e30f       ldi	Temp, '?'
000829 dd58       rcall	PutCharacter
00082a e30c       ldi	Temp, '<'
00082b dd56       rcall	PutCharacter
00082c e100       ldi	Temp, $10
00082d 9300 0112  sts	RFLXCTH, Temp
00082f ef0f       ldi	Temp, 0xFF
000830 9300 011b  sts	ValveMotorCurrent, Temp
000832 9508       ret
                 
                 _WaitADP_OK:
000833 b50a       in		Temp, Status1
000834 fd02       sbrc	Temp, _Descale
000835 c026       rjmp	_Descale1
                 
000836 9bf4       sbis	Status0, _NewButton
                 
                 _WADPO_E:
000837 9508       ret
                  
000838 98f4       cbi	Status0, _NewButton
000839 9100 010d  lds	Temp, Buttons
00083b 3004       cpi	Temp, _OK_Button
00083c f7d1       brne	_WADPO_E
00083d e004       ldi	Temp, 4
00083e 9300 0118  sts	AdaptStep, Temp
000840 e401       ldi	Temp, 'A'
000841 e310       ldi	TempH, $30
000842 dd3f       rcall	PutCharacter
000843 e404       ldi	Temp, 'D'
000844 dd3d       rcall	PutCharacter
000845 e401       ldi	Temp, 'A'
000846 dd3b       rcall	PutCharacter
000847 e500       ldi	Temp, 'P'
000848 dd39       rcall	PutCharacter
000849 9220 0113  sts	PositionL, Null
00084b 9220 0114  sts	PositionH, Null
00084d 9508       ret
                 
                 
                 _AdpCloseValve:
00084e 9af1       sbi	Status0, _MotDir
00084f 9af0       sbi 	Status0, _MotOn	
000850 9220 0117  sts	MotTimeOut, Null
000852 9513       inc	TempH
000853 9310 0118  sts	AdaptStep, TempH
000855 e70c       ldi	Temp, low(MaxAdaptWay)					;preload maximum way without valve touch
000856 e011       ldi	TempH, high(MaxAdaptWay)
000857 9300 0111  sts	RFLXCTL, Temp
000859 9310 0112  sts	RFLXCTH, TempH
00085b 9508       ret
                  
                 
                 _Descale1:
00085c e004       ldi	Temp, 4
00085d 9300 0118  sts	AdaptStep, Temp
00085f e404       ldi	Temp, 'D'
000860 e310       ldi	TempH, $30
000861 dd20       rcall	PutCharacter
000862 e405       ldi	Temp, 'E'
000863 dd1e       rcall	PutCharacter
000864 e503       ldi	Temp, 'S'
000865 dd1c       rcall	PutCharacter
000866 e403       ldi	Temp, 'C'
000867 dd1a       rcall	PutCharacter
000868 9220 0113  sts	PositionL, Null
00086a 9220 0114  sts	PositionH, Null
00086c 94f8       cli
00086d b50a       in		Temp, Status1
00086e 7f0b       cbr	Temp, (1<<_Descale)
00086f bd0a       out	Status1, Temp
000870 9478       sei
000871 9508       ret 
                 
                 
                 _AdpEnd:
000872 9220 0118  sts	AdaptStep, Null
                 
000874 9100 0151  lds	Temp, DisplayBuffer1+11					;clear bargraph points 1 and 2
000876 7f0e       andi	Temp, 0b11111110
000877 9300 0151  sts	DisplayBuffer1+11, Temp
000879 9100 0165  lds	Temp, DisplayBuffer2+11					
00087b 7f0e       andi	Temp, 0b11111110
00087c 9300 0165  sts	DisplayBuffer2+11, Temp
                   
00087e 9100 014c  lds	Temp, DisplayBuffer1+6
000880 7f0e       andi	Temp, 0b11111110
000881 9300 014c  sts	DisplayBuffer1+6, Temp
000883 9100 0160  lds	Temp, DisplayBuffer2+6
000885 7f0e       andi	Temp, 0b11111110
000886 9300 0160  sts	DisplayBuffer2+6, Temp
                  
000888 9100 0113  lds	Temp, PositionL
00088a 9110 0114  lds	TempH, PositionH
00088c 5104       subi	Temp, 20								;subtact margin to full open position
00088d 0912       sbc	TempH, Null
00088e 9300 0115  sts	ValveTopL, Temp
000890 9310 0116  sts	ValveTopH, TempH
                 
000892 9220 0113  sts	PositionL, Null
000894 9220 0114  sts	PositionH, Null
                  
000896 e208       ldi	Temp, 40
000897 9300 011d  sts	ADCPrescaler, Temp 
000899 9220 0125  sts	UserDisplay, Null
00089b 9220 012e  sts	DisplayCT, Null
00089d 9220 0134  sts	DispTimer, Null
                  
00089f 940e 130d  call	CalcDayOfWeek
0008a1 6800       ori	Temp, $80
0008a2 de15       rcall	ClearWeekDays
0008a3 e310       ldi	TempH, $30
0008a4 dd5c       rcall	PutWeekDay
                   
0008a5 b50a       in		Temp, Status1
0008a6 ff01       sbrs	Temp, _AutoManu
0008a7 dbbb       rcall	Show_DailyBargraph
                  
0008a8 b50a       in		Temp, Status1
0008a9 ff01       sbrs	Temp, _AutoManu
0008aa dea6       rcall	SetHourLegend
                    
0008ab dbad       rcall	Show_AutoManuMode
                 
0008ac 98f3       cbi	Status0, _Adapt
                  
0008ad e003       ldi	Temp, 3
0008ae 9300 013c  sts	Radio_RXTimeslot, Temp
                 
0008b0 b50b       in		Temp, Status2
0008b1 6004       sbr	Temp, (1<<_FastModeScan)				;enable fast timer scan
0008b2 bd0b       out	Status2, Temp
                 
0008b3 9508       ret
                  
                  
                 
                 
                 
                 ;------------------------------------------------------------------------------
                 MotorControl:
0008b4 9100 0117  lds	Temp, MotTimeOut					
0008b6 730f       andi	Temp, 0b00111111
0008b7 310e       cpi	Temp, 30										;timeout value to completely shut down motor hardware, if lower, execute motor control
0008b8 f058       brcs	_MC2
0008b9 98f2       cbi	Status0, _MotRun					
0008ba 9872       cbi	LightSensPort, LightSens_LED					;switch off reflex sensor
                  
0008bb 9100 0117  lds	Temp, MotTimeOut								;if any valve limit is touched, clear reflex counter 
0008bd 7c00       andi	Temp, 0b11000000
0008be f021       breq	_MC1
                 
0008bf 9220 0111  sts	RFLXCTL, Null									
0008c1 9220 0112  sts	RFLXCTH, Null
                  
                 _MC1: 
0008c3 9508       ret
                   
                 _MC2: 
0008c4 9bf0       sbis	Status0, _MotOn									;exit, if motor has been already stopped
0008c5 9508       ret
                  
0008c6 9bf1       sbis	Status0, _MotDir								;measure motor current only when closing valve
0008c7 c00e       rjmp	_MC22
                 
0008c8 940e 1252  call	Measure_Motor_Current
                 
0008ca 9100 0117  lds	Temp, MotTimeOut
0008cc 730f       andi	Temp, 0b00111111
0008cd 9180 0119  lds	Temp3, MotorCurrent								;compare actual current to detect overcurrent when valve is fully closed
0008cf 9190 011b  lds	Temp4, ValveMotorCurrent
0008d1 1b89       sub	Temp3, Temp4
0008d2 f408       brcc	_MC21
0008d3 2788       clr	Temp3
                 
                 _MC21:
0008d4 3288       cpi	Temp3, 40										;threshold current over valvecurrent, overcurrent!
0008d5 f428       brcc	_MC23
                 
                 _MC22:
0008d6 9100 0117  lds	Temp, MotTimeOut 
0008d8 730f       andi	Temp, 0b00111111
0008d9 300a       cpi	Temp, 10										;timeout value to shut down motor, if lower, execute motor control
0008da f078       brcs	_MC3	
                 
                 _MC23:  
0008db 99f1       sbic	Status0, _MotDir
0008dc 6400       sbr	Temp, (1<<_BotLimit)
0008dd 9bf1       sbis	Status0, _MotDir
0008de 6800       sbr	Temp, (1<<_TopLimit)
0008df 9300 0117  sts	MotTimeOut, Temp 
0008e1 ff06       sbrs	Temp, _BotLimit									; if valve is fully closed, clear position counter
0008e2 c032       rjmp	_MotorStop
0008e3 99f3       sbic	Status0, _Adapt
0008e4 c030       rjmp	_MotorStop
0008e5 9220 0113  sts	PositionL, Null
0008e7 9220 0114  sts	PositionH, Null
0008e9 c02b       rjmp	_MotorStop
                 
                 _MC3:   
0008ea 9100 0111  lds	Temp, RFLXCTL									;check if position is reached
0008ec 9110 0112  lds	TempH, RFLXCTH
0008ee 3000       cpi	Temp, 0
0008ef 0512       cpc	TempH, Null
0008f0 f121       breq	_MotorStop
                 
0008f1 99f2       sbic	Status0, _MotRun								;execute only if motor hardware was stopped before
0008f2 9508       ret
                  
0008f3 9a72       sbi	LightSensPort, LightSens_LED					;enable reflex coupler
                 
0008f4 ec08       ldi	Temp, (1<<LCDEN) | (1<<LCDIE) | (1<<LCDAB)		;enable LCD-Frame Interrupt, used for upcounting Motor timeout
0008f5 9300 00e4  sts	LCDCRA, Temp
0008f7 e063       ldi	ActiveCT, 3
0008f8 9a75       sbi	BacklightPort, Backlight_On
                 
0008f9 9bf1       sbis	Status0, _MotDir								;dependent on direction flag open or close valve
0008fa c00d       rjmp	_MotorOpen										;flag is clear: open, flag is set: close
                 
                 _MotorClose:
0008fb 9100 0117  lds	Temp, MotTimeOut								;clear opposite limit flag
0008fd 770f       cbr	Temp, (1<<_TopLimit)
0008fe 9300 0117  sts	MotTimeOut, Temp
                  ;cbi	DebugPort, Debug2
000900 986f       cbi	MotorDDR, Motor_Open
000901 9877       cbi	MotorPort, Motor_Open
000902 0000       nop
000903 0000       nop
000904 9a6e       sbi	MotorDDR, Motor_Close
000905 9a76       sbi	MotorPort, Motor_Close
000906 9af2       sbi	Status0, _MotRun
000907 9508       ret
                 
                 _MotorOpen:
000908 9100 0117  lds	Temp, MotTimeOut								;clear opposite limit flag
00090a 7b0f       cbr	Temp, (1<<_BotLimit)
00090b 9300 0117  sts	MotTimeOut, Temp
                  ;cbi	DebugPort, Debug2
00090d 986e       cbi	MotorDDR, Motor_Close
00090e 9876       cbi	MotorPort, Motor_Close
00090f 0000       nop
000910 0000       nop
000911 9a6f       sbi	MotorDDR, Motor_Open
000912 9a77       sbi	MotorPort, Motor_Open
000913 9af2       sbi	Status0, _MotRun
000914 9508       ret
                   
                 _MotorStop:
000915 9bf0       sbis	Status0, _MotOn									;if motor has been stopped before, exit
000916 9508       ret
                 
000917 986e       cbi	MotorDDR, Motor_Close
000918 9876       cbi	MotorPort, Motor_Close							;disable both motor drivers
000919 986f       cbi	MotorDDR, Motor_Open
00091a 9877       cbi	MotorPort, Motor_Open
00091b 98f0       cbi	Status0, _MotOn						
                 
00091c 9bf3       sbis	Status0, _Adapt									;in adaptation mode, increase adaptation step
00091d 9508       ret
                 
00091e 9100 0118  lds	Temp, AdaptStep
000920 3001       cpi	Temp, 1
000921 f491       brne	_MStop_1
                  
                 
000922 e409       ldi	Temp, 'I'
000923 e110       ldi	TempH, $10
000924 dc5d       rcall	PutCharacter
000925 e40e       ldi	Temp, 'N'
000926 dc5b       rcall	PutCharacter
000927 e503       ldi	Temp, 'S'
000928 dc59       rcall	PutCharacter
000929 e504       ldi	Temp, 'T'
00092a dc57       rcall	PutCharacter
                  
00092b e30f       ldi	Temp, '?'
00092c e210       ldi	TempH, $20
00092d dc54       rcall	PutCharacter
00092e e40f       ldi	Temp, 'O'
00092f dc52       rcall	PutCharacter
000930 e40b       ldi	Temp, 'K'
000931 dc50       rcall	PutCharacter
000932 e30f       ldi	Temp, '?'
000933 dc4e       rcall	PutCharacter
                  
                 _MStop_1:
000934 9100 0118  lds	Temp, AdaptStep
000936 9503       inc	Temp 
000937 9300 0118  sts	AdaptStep, Temp
000939 9508       ret
                 
                 
                 .include	"User.inc"
                 
                 ;--------------------------------------
                 ; get pin values from rotary pins, process debouncing and rotary decoding
                 ReadRotary:
00093a b103       in		Temp, PinB
00093b 9500       com	Temp
00093c 7f01       andi	Temp, 0b11110001			;mask used pins and swap nibbles, put all button pins together -> 000bbbbb
00093d 9502       swap	Temp
                 
00093e 7108       andi	Temp, 0b00011000			;mask rotary pins
00093f 9506       lsr	Temp
000940 9506       lsr	Temp
000941 9506       lsr	Temp
000942 9110 010f  lds	TempH, RotaryTemp			
000944 2b10       or		TempH, Temp
000945 0f11       lsl	TempH
000946 0f11       lsl	TempH
000947 731c       andi	TempH, 0b00111100			;shift and store current rotary pin state
000948 9310 010f  sts	RotaryTemp, TempH
00094a 3014       cpi	TempH, 0b00000100			;check for first half step in clockwise direction
00094b f071       breq	_ROTStepCW1
00094c 3318       cpi	TempH, 0b00111000			;check for first half step in clockwise direction
00094d f061       breq	_ROTStepCW1
00094e 3018       cpi	TempH, 0b00001000			;check for first half step in counter-clockwise direction
00094f f089       breq	_ROTStepCCW1
000950 3314       cpi	TempH, 0b00110100			;check for first half step in counter-clockwise direction
000951 f079       breq	_ROTStepCCW1
                  
000952 9100 0110  lds	Temp, Rotary				;if first half step was detected, check for second half step CW
000954 7c00       andi	Temp, 0b11000000
000955 3800       cpi	Temp, 0b10000000
000956 f089       breq	_RotStepCW2
000957 3400       cpi	Temp, 0b01000000			;if first half step was detected, check for second half step CCW
000958 f0c1       breq	_RotStepCCW2
000959 9508       ret
                 
                 _ROTStepCW1:
00095a 9100 0110  lds	Temp, Rotary
00095c 730f       andi	Temp, 0b00111111
00095d 6800       ori	Temp, 0b10000000			;mark first half step detected CW
00095e 9300 0110  sts	Rotary, Temp
000960 9508       ret
                  
                 _ROTStepCCW1:
000961 9100 0110  lds	Temp, Rotary
000963 730f       andi	Temp, 0b00111111
000964 6400       ori	Temp, 0b01000000			;mark first half step detected CCW
000965 9300 0110  sts	Rotary, Temp
000967 9508       ret
                 
                 _ROTStepCW2:
000968 311c       cpi	TempH, 0b00011100			;check for second half step CW
000969 f019       breq	_ROTStepCWP
00096a 3210       cpi	TempH, 0b00100000
00096b f009       breq	_ROTStepCWP
00096c 9508       ret
                 
                 _ROTStepCWP:
00096d e003       ldi	Temp, 0b00000011			;set CW flag and new rotary flag
00096e 9300 0110  sts	Rotary, Temp
000970 9508       ret
                 
                 _ROTStepCCW2:
000971 321c       cpi	TempH, 0b00101100			;check for second half step CCW
000972 f019       breq	_ROTStepCCWP
000973 3110       cpi	TempH, 0b00010000
000974 f009       breq	_ROTStepCCWP
000975 9508       ret
                 
                 _ROTStepCCWP:
000976 e002       ldi	Temp, 0b00000010			;set new rotary flag
000977 9300 0110  sts	Rotary, Temp
000979 9508       ret
                 
                 
                 
                  
                 ;--------------------------------------------------
                 User_Action:
00097a 9100 0110  lds	Temp, Rotary
00097c fd01       sbrc	Temp, 1					;if new rotary value or new button press detected, execute
00097d c045       rjmp	_UAC_Rotary
                 
00097e 9bf4       sbis	Status0, _NewButton
00097f 9508       ret
                   
                 _UAC_Button:
000980 98f4       cbi	Status0, _NewButton
000981 9100 010d  lds	Temp, Buttons
000983 3001       cpi	Temp, _Menu_Button
000984 f019       breq	_Toggle_Menu
000985 3004       cpi	Temp, _OK_Button
000986 f1b9       breq	_Enter
000987 9508       ret
                  
                 
                 _Toggle_Menu:
000988 99f6       sbic	Status0, _MenuOn
000989 c00b       rjmp	_MenuModeOff
                  
                 _MenuModeOn:
00098a 9af6       sbi	Status0, _MenuOn
00098b 9220 0133  sts	MenuHigh, Null
00098d 9220 0132  sts	MenuLow, Null
00098f dcf4       rcall	ClearColon
000990 dd09       rcall	ClearPoint 
000991 db44       rcall	ClearBargraph
000992 e000       ldi	Temp, 0
000993 d07c       rcall	Get_Menu
000994 9508       ret
                 
                 _MenuModeOff:
000995 e503       ldi	Temp, 'S'
000996 e110       ldi	TempH, $10
000997 dbea       rcall	PutCharacter
000998 e504       ldi	Temp, 'T'
000999 dbe8       rcall	PutCharacter
00099a e40f       ldi	Temp, 'O'
00099b dbe6       rcall	PutCharacter
00099c e502       ldi	Temp, 'R'
00099d dbe4       rcall	PutCharacter
                  
00099e e503       ldi	Temp, 'S'
00099f e210       ldi	TempH, $20
0009a0 dbe1       rcall	PutCharacter
0009a1 e504       ldi	Temp, 'T'
0009a2 dbdf       rcall	PutCharacter
0009a3 e40f       ldi	Temp, 'O'
0009a4 dbdd       rcall	PutCharacter
0009a5 e502       ldi	Temp, 'R'
0009a6 dbdb       rcall	PutCharacter
                 
0009a7 d83d       rcall	StoreTimers2EEPROM
0009a8 d856       rcall	StoreTemperatures2EEPROM 
                  
0009a9 e001       ldi	Temp, 1
0009aa 9300 0125  sts	UserDisplay, Temp
0009ac e003       ldi	Temp, 3
0009ad 9300 0134  sts	DispTimer, Temp
0009af 9100 0124  lds	Temp, WDays								;restore Week day display after leaving Menu
0009b1 6800       ori	Temp, $80
0009b2 dd05       rcall	ClearWeekDays
0009b3 e310       ldi	TempH, $30
0009b4 dc4c       rcall	PutWeekDay
                  
0009b5 b50b       in		Temp, Status2
0009b6 6004       sbr	Temp, (1<<_FastModeScan)				;enable fast timer scan
0009b7 bd0b       out	Status2, Temp
                 
0009b8 b50a       in 	Temp, Status1
0009b9 ff01       sbrs	Temp, _AutoManu
0009ba daa8       rcall	Show_DailyBargraph
                 
0009bb 98f6       cbi	Status0, _MenuOn
0009bc 98f7       cbi	Status0, _MenuWork
0009bd 9508       ret
                 
                 _Enter:
0009be 9bf6       sbis	Status0, _MenuOn
0009bf 9508       ret
0009c0 e003       ldi	Temp, 3
0009c1 d04e       rcall	Get_Menu
0009c2 9508       ret
                 
                 
                 _UAC_Rotary:
0009c3 7f0d       cbr	Temp, (1<<1)							;clear new rotary flag
0009c4 9300 0110  sts	Rotary, Temp
0009c6 fd00       sbrc	Temp, 0
0009c7 c00f       rjmp	_RotaryPlus
                 
                 _RotaryMinus:
0009c8 99f6       sbic	Status0, _MenuOn
0009c9 c00a       rjmp	_RM1
0009ca d033       rcall	Set_SetTemperature_Down
0009cb 9100 0100  lds	Temp, TempIntL						;NTC temperature  = OldTemperature
0009cd 9110 0101  lds	TempH, TempIntH
0009cf 9300 0102  sts	TempIntOldL, Temp
0009d1 9310 0103  sts	TempIntOldH, TempH
0009d3 9508       ret
                  
                 _RM1:
0009d4 e001       ldi	Temp, 1
0009d5 d03a       rcall	Get_Menu
0009d6 9508       ret
                 	
                 _RotaryPlus:
0009d7 99f6       sbic	Status0, _MenuOn
0009d8 c00a       rjmp	_RP1
0009d9 d00c       rcall	Set_SetTemperature_Up
0009da 9100 0100  lds	Temp, TempIntL						;NTC temperature  = OldTemperature
0009dc 9110 0101  lds	TempH, TempIntH
0009de 9300 0102  sts	TempIntOldL, Temp
0009e0 9310 0103  sts	TempIntOldH, TempH
0009e2 9508       ret
                 
                 _RP1:
0009e3 e002       ldi	Temp, 2
0009e4 d02b       rcall	Get_Menu
0009e5 9508       ret
                 
                 
                 ;------------------------------------------------------------------
                 Set_SetTemperature_Up:
0009e6 9100 0129  lds	Temp, SetTempL
0009e8 9110 012a  lds	TempH, SetTempH
                  
0009ea e081       ldi	Temp3, high(500)
0009eb 3f04       cpi	Temp, low(500)
0009ec 0718       cpc	TempH, Temp3
0009ed f049       breq	_SSTU1
                  
0009ee e085       ldi	Temp3, 5
0009ef 0f08       add	Temp, Temp3
0009f0 1d12       adc	TempH, Null
0009f1 9300 0129  sts	SetTempL, Temp
0009f3 9310 012a  sts	SetTempH, TempH
0009f5 9380 0125  sts	UserDisplay, Temp3 
                  
                 _SSTU1:
0009f7 e00a       ldi	Temp, 10
0009f8 9300 011d  sts	ADCPrescaler, Temp
0009fa b50b       in		Temp, Status2
0009fb 6004       sbr	Temp, (1<<_FastModeScan)				;enable fast timer scan
0009fc bd0b       out	Status2, Temp
0009fd 9508       ret
                 
                 ;-----------------------------------------
                 Set_SetTemperature_Down:
0009fe 9100 0129  lds	Temp, SetTempL
000a00 9110 012a  lds	TempH, SetTempH
                  
000a02 e080       ldi	Temp3, high(40)
000a03 3208       cpi	Temp, low(40)
000a04 0718       cpc	TempH, Temp3
000a05 f389       breq	_SSTU1
                  
000a06 5005       subi	Temp, 5
000a07 0912       sbc	TempH, Null
000a08 9300 0129  sts	SetTempL, Temp
000a0a 9310 012a  sts	SetTempH, TempH
000a0c e085       ldi	Temp3, 5
000a0d 9380 0125  sts	UserDisplay, Temp3 
000a0f cfe7       rjmp	_SSTU1
                 
                 
                 ;-----------------------------------------
                  Get_Menu:
000a10 e164       ldi	ActiveCT, 20
                  ;sbi	BacklightPort, Backlight_On
                 
000a11 99f7       sbic	Status0, _MenuWork					;if work menu is selected, skip new menu selection and go to current menu		
000a12 c0b9       rjmp	_MenuFound
                 
                 
                 _GM_00:
000a13 3000       cpi	Temp, 0
000a14 f051       breq	_GM_0
000a15 3001       cpi	Temp, 1
000a16 f029       breq	_GM_1x
000a17 3002       cpi	Temp, 2
000a18 f021       breq	_GM_2x
000a19 3003       cpi	Temp, 3
000a1a f019       breq	_GM_3x
000a1b 9508       ret
                 
                 _GM_1x:
000a1c c055       rjmp	_GM_1
                   
                 _GM_2x:
000a1d c07a       rjmp	_GM_2
                 
                 _GM_3x:
000a1e c098       rjmp	_GM_3
                 
                 _GM_0:
000a1f 2744       clr	MenuID
000a20 ecec       ldi	ZL, low (MenuTable*2)
000a21 e2f6       ldi	ZH, high (MenuTable*2)
000a22 9190 0133  lds	Temp4, MenuHigh
000a24 9180 0132  lds	Temp3, MenuLow
                  
                 _GM_01:
000a26 9115       lpm	TempH, Z+
000a27 9105       lpm	Temp, Z+
000a28 1708       cp		Temp, Temp3  
000a29 0719       cpc	TempH, Temp4
000a2a f411       brne	_GM_02
000a2b 2700       clr	Temp								;clear task value
000a2c c09f       rjmp	_MenuFound
                  
                 _GM_02:
000a2d 3f1f       cpi	TempH, $FF
000a2e f011       breq	_MenuEnd
000a2f 9543       inc	MenuID
000a30 cff5       rjmp	_GM_01
                 
                 _MenuEnd:
000a31 9100 0132  lds	Temp, MenuLow
000a33 3000       cpi	Temp, 0	
000a34 f171       breq	_ME_Main
                 
000a35 700f       andi	Temp, $0F							;if lower nibble is not 0, go to 2nd sub menu
000a36 f499       brne	_ME_Sub2
                   
                 _ME_Sub1:
000a37 e110       ldi	TempH, $10
000a38 9100 0132  lds	Temp, MenuLow
000a3a 3100       cpi	Temp, $10							;if submenu is 1 and not found, exit
000a3b f041       breq	_ME_Sub1_Exit
000a3c 9bf5       sbis	Status0, _MenuUpDn					;if search direction is up, add submenu and search
000a3d c004       rjmp	_ME_Sub1_Dn							;if search direction is down, subtact submenu and search
                 
000a3e 0f01       add	Temp, TempH
000a3f f439       brne	_ME_Sub11
000a40 0f01       add	Temp, TempH
000a41 c005       rjmp	_ME_Sub11
                  
                 _ME_Sub1_Dn:
000a42 1b01       sub	Temp, TempH
000a43 f419       brne	_ME_Sub11
                 
                 _ME_Sub1_Exit:
000a44 9220 0132  sts	MenuLow, Null
000a46 9508       ret										;if subtracting down to 0 and no menu was found, exit
                 
                 _ME_Sub11:
000a47 9300 0132  sts	MenuLow, Temp
000a49 cfd5       rjmp	_GM_0
                  
                 _ME_Sub2:
000a4a 9100 0132  lds	Temp, MenuLow
000a4c 700f       andi	Temp, $0F
000a4d 3001       cpi	Temp, $01							;if subsubmenu is 1 and not found, exit
000a4e f049       breq	_ME_Sub2_Exit
000a4f 9bf5       sbis	Status0, _MenuUpDn					;if search direction is up, add submenu and search
000a50 c005       rjmp	_ME_Sub2_Dn							;if search direction is down, sub submenu and search
                 
000a51 9503       inc	Temp 
000a52 700f       andi	Temp, $0F
000a53 f439       brne	_ME_Sub21
000a54 9503       inc	Temp
000a55 c005       rjmp	_ME_Sub21
                  
                 _ME_Sub2_Dn:
000a56 950a       dec	Temp 
000a57 f419       brne	_ME_Sub21
                 
                 _ME_Sub2_Exit:
000a58 9220 0132  sts	MenuLow, Null
000a5a 9508       ret										;if subtracted down to 0 and no menu was found, exit
                 
                 _ME_Sub21:
000a5b 9110 0132  lds	TempH, MenuLow
000a5d 7f10       andi	TempH, $F0
000a5e 700f       andi	Temp, $0F
000a5f 2b10       or		TempH, Temp
000a60 9310 0132  sts	MenuLow, TempH
000a62 cfbc       rjmp	_GM_0
                  
                 
                 _ME_Main:
000a63 9100 0133  lds	Temp, MenuHigh
000a65 3f0f       cpi	Temp, $FF
000a66 f029       breq	_ME_MainTop
000a67 9220 0133  sts	MenuHigh, Null
000a69 9220 0132  sts	MenuLow, Null
000a6b cfb3       rjmp	_GM_0
                 
                 _ME_MainTop:
000a6c e00a       ldi	Temp, $0A							;number of current main menues
000a6d 9300 0133  sts	MenuHigh, Temp
000a6f 9220 0132  sts	MenuLow, Null
000a71 cfad       rjmp	_GM_0
                 
                 
                 _GM_1:
000a72 98f5       cbi	Status0, _MenuUpDn
000a73 9100 0132  lds	Temp, MenuLow
000a75 7f00       andi	Temp, $F0
000a76 f0d9       breq	_DecMainMenu
000a77 9100 0132  lds	Temp, MenuLow
000a79 700f       andi	Temp, $0F
000a7a f071       breq	_DecSublayer1
                 
                 _DecSublayer2:
                  ;cbi	DebugPort, Debug2
000a7b 9100 0132  lds	Temp, MenuLow						;decrement Menu SubLayer2
000a7d 950a       dec	Temp 
000a7e 700f       andi	Temp, $0F
000a7f f409       brne	_DSL2
000a80 950a       dec	Temp 
                 
                 _DSL2: 
000a81 9110 0132  lds	TempH, MenuLow
000a83 7f10       andi	TempH, $F0
000a84 700f       andi	Temp, $0F
000a85 2b10       or		TempH, Temp
000a86 9310 0132  sts	MenuLow, TempH
000a88 cf96       rjmp	_GM_0
                 
                 _DecSublayer1:
000a89 9100 0132  lds	Temp, MenuLow						;decrement Menu SubLayer1
000a8b e110       ldi	TempH, $10
000a8c 1b01       sub	Temp, TempH
000a8d f409       brne	_DSL1
000a8e 1b01       sub	Temp, TempH
                 
                 _DSL1: 
000a8f 9300 0132  sts	MenuLow, Temp
000a91 cf8d       rjmp	_GM_0
                 
                 _DecMainMenu:
000a92 9100 0133  lds	Temp, MenuHigh
000a94 950a       dec	Temp
000a95 9300 0133  sts	MenuHigh, Temp
000a97 cf87       rjmp	_GM_0
                 
                 _GM_2:
000a98 9af5       sbi	Status0, _MenuUpDn
000a99 9100 0132  lds	Temp, MenuLow
000a9b 7f00       andi	Temp, $F0
000a9c f0a1       breq	_IncMainMenu
000a9d 9100 0132  lds	Temp, MenuLow
000a9f 700f       andi	Temp, $0F
000aa0 f039       breq	_IncSublayer1
                 
                 _IncSublayer2:
                  ;sbi	DebugPort, Debug2
000aa1 9100 0132  lds	Temp, MenuLow						;increment Menu SubLayer2
000aa3 9503       inc	Temp 
000aa4 700f       andi	Temp, $0F
000aa5 f6d9       brne	_DSL2
000aa6 9503       inc	Temp 
000aa7 cfd9       rjmp	_DSL2
                  
                 _IncSublayer1:
000aa8 9100 0132  lds	Temp, MenuLow						;increment Menu SubLayer1
000aaa e110       ldi	TempH, $10
000aab 0f01       add	Temp, TempH
000aac f409       brne	_ISL1
000aad 0f01       add	Temp, TempH
                 
                 _ISL1: 
000aae 9300 0132  sts	MenuLow, Temp
000ab0 cf6e       rjmp	_GM_0
                 
                 _IncMainMenu:
000ab1 9100 0133  lds	Temp, MenuHigh
000ab3 9503       inc	Temp
000ab4 9300 0133  sts	MenuHigh, Temp
000ab6 cf68       rjmp	_GM_0
                 
                 
                 _GM_3:
000ab7 9100 0132  lds	Temp, MenuLow
000ab9 7f00       andi	Temp, $F0
000aba f029       breq	_IncSub
000abb 9100 0132  lds	Temp, MenuLow
000abd 700f       andi	Temp, $0F
000abe f039       breq	_IncSubSub
000abf 9508       ret
                 
                 _IncSub:
000ac0 9100 0132  lds	Temp, MenuLow						;switch to SubLayer1
000ac2 5f00       subi	Temp, -$10
000ac3 9300 0132  sts	MenuLow, Temp
000ac5 cf59       rjmp	_GM_0
                 
                 _IncSubSub:
000ac6 9100 0132  lds	Temp, MenuLow						;switch to SubLayer2
000ac8 5f0f       subi	Temp, -$01
000ac9 9300 0132  sts	MenuLow, Temp
000acb cf53       rjmp	_GM_0
                 
                 
                 ;----------------------------------------------
                 _MenuFound:
000acc ede1       ldi	ZL, low (MenuJump)
000acd e0fa       ldi	ZH, high (MenuJump)
000ace 0fe4       add	ZL, MenuID
000acf 1df2       adc	ZH, Null
000ad0 9409       ijmp
                 
                 MenuJump:
000ad1 c09d       rjmp	Menu_Mode
000ad2 c0a6       rjmp	Menu_ModeSub1
000ad3 c0b0       rjmp	Menu_ModeSub11
000ad4 c0bd       rjmp	Menu_ModeSub2
000ad5 c0c7       rjmp	Menu_ModeSub21
000ad6 c0ce       rjmp	Menu_Prog
000ad7 c0d7       rjmp	Menu_ProgSub1
000ad8 c1a4       rjmp	Menu_ProgSub11
000ad9 c231       rjmp	Menu_ProgSub12
000ada c235       rjmp	Menu_ProgSub13
000adb c22f       rjmp	Menu_ProgSub12
000adc c233       rjmp	Menu_ProgSub13
000add c22d       rjmp	Menu_ProgSub12
000ade c231       rjmp	Menu_ProgSub13
000adf c22b       rjmp	Menu_ProgSub12
000ae0 c234       rjmp	Menu_ProgSub14
000ae1 c0de       rjmp	Menu_ProgSub2
000ae2 c19a       rjmp	Menu_ProgSub11
000ae3 c227       rjmp	Menu_ProgSub12
000ae4 c22b       rjmp	Menu_ProgSub13
000ae5 c225       rjmp	Menu_ProgSub12
000ae6 c229       rjmp	Menu_ProgSub13
000ae7 c223       rjmp	Menu_ProgSub12
000ae8 c227       rjmp	Menu_ProgSub13
000ae9 c221       rjmp	Menu_ProgSub12
000aea c22a       rjmp	Menu_ProgSub14
000aeb c0e3       rjmp	Menu_ProgSub3
000aec c190       rjmp	Menu_ProgSub11
000aed c21d       rjmp	Menu_ProgSub12
000aee c221       rjmp	Menu_ProgSub13
000aef c21b       rjmp	Menu_ProgSub12
000af0 c21f       rjmp	Menu_ProgSub13
000af1 c219       rjmp	Menu_ProgSub12
000af2 c21d       rjmp	Menu_ProgSub13
000af3 c217       rjmp	Menu_ProgSub12
000af4 c220       rjmp	Menu_ProgSub14
000af5 c0e8       rjmp	Menu_ProgSub4
000af6 c186       rjmp	Menu_ProgSub11
000af7 c213       rjmp	Menu_ProgSub12
000af8 c217       rjmp	Menu_ProgSub13
000af9 c211       rjmp	Menu_ProgSub12
000afa c215       rjmp	Menu_ProgSub13
000afb c20f       rjmp	Menu_ProgSub12
000afc c213       rjmp	Menu_ProgSub13
000afd c20d       rjmp	Menu_ProgSub12
000afe c216       rjmp	Menu_ProgSub14
000aff c0ed       rjmp	Menu_ProgSub5
000b00 c17c       rjmp	Menu_ProgSub11
000b01 c209       rjmp	Menu_ProgSub12
000b02 c20d       rjmp	Menu_ProgSub13
000b03 c207       rjmp	Menu_ProgSub12
000b04 c20b       rjmp	Menu_ProgSub13
000b05 c205       rjmp	Menu_ProgSub12
000b06 c209       rjmp	Menu_ProgSub13
000b07 c203       rjmp	Menu_ProgSub12
000b08 c20c       rjmp	Menu_ProgSub14
000b09 c0f2       rjmp	Menu_ProgSub6
000b0a c172       rjmp	Menu_ProgSub11
000b0b c1ff       rjmp	Menu_ProgSub12
000b0c c203       rjmp	Menu_ProgSub13
000b0d c1fd       rjmp	Menu_ProgSub12
000b0e c201       rjmp	Menu_ProgSub13
000b0f c1fb       rjmp	Menu_ProgSub12
000b10 c1ff       rjmp	Menu_ProgSub13
000b11 c1f9       rjmp	Menu_ProgSub12
000b12 c202       rjmp	Menu_ProgSub14
000b13 c0f7       rjmp	Menu_ProgSub7
000b14 c168       rjmp	Menu_ProgSub11
000b15 c1f5       rjmp	Menu_ProgSub12
000b16 c1f9       rjmp	Menu_ProgSub13
000b17 c1f3       rjmp	Menu_ProgSub12
000b18 c1f7       rjmp	Menu_ProgSub13
000b19 c1f1       rjmp	Menu_ProgSub12
000b1a c1f5       rjmp	Menu_ProgSub13
000b1b c1ef       rjmp	Menu_ProgSub12
000b1c c1f8       rjmp	Menu_ProgSub14
000b1d c0fc       rjmp	Menu_ProgSub8
000b1e c15e       rjmp	Menu_ProgSub11
000b1f c1eb       rjmp	Menu_ProgSub12
000b20 c1ef       rjmp	Menu_ProgSub13
000b21 c1e9       rjmp	Menu_ProgSub12
000b22 c1ed       rjmp	Menu_ProgSub13
000b23 c1e7       rjmp	Menu_ProgSub12
000b24 c1eb       rjmp	Menu_ProgSub13
000b25 c1e5       rjmp	Menu_ProgSub12
000b26 c1ee       rjmp	Menu_ProgSub14
000b27 c109       rjmp	Menu_ProgSub9
000b28 c154       rjmp	Menu_ProgSub11
000b29 c1e1       rjmp	Menu_ProgSub12
000b2a c1e5       rjmp	Menu_ProgSub13
000b2b c1df       rjmp	Menu_ProgSub12
000b2c c1e3       rjmp	Menu_ProgSub13
000b2d c1dd       rjmp	Menu_ProgSub12
000b2e c1e1       rjmp	Menu_ProgSub13
000b2f c1db       rjmp	Menu_ProgSub12
000b30 c1e4       rjmp	Menu_ProgSub14
000b31 c118       rjmp	Menu_ProgSubA
000b32 c14a       rjmp	Menu_ProgSub11
000b33 c1d7       rjmp	Menu_ProgSub12
000b34 c1db       rjmp	Menu_ProgSub13
000b35 c1d5       rjmp	Menu_ProgSub12
000b36 c1d9       rjmp	Menu_ProgSub13
000b37 c1d3       rjmp	Menu_ProgSub12
000b38 c1d7       rjmp	Menu_ProgSub13
000b39 c1d1       rjmp	Menu_ProgSub12
000b3a c1da       rjmp	Menu_ProgSub14
000b3b c12b       rjmp	Menu_ProgSubB
000b3c c140       rjmp	Menu_ProgSub11
000b3d c1cd       rjmp	Menu_ProgSub12
000b3e c1d1       rjmp	Menu_ProgSub13
000b3f c1cb       rjmp	Menu_ProgSub12
000b40 c1cf       rjmp	Menu_ProgSub13
000b41 c1c9       rjmp	Menu_ProgSub12
000b42 c1cd       rjmp	Menu_ProgSub13
000b43 c1c7       rjmp	Menu_ProgSub12
000b44 c1d0       rjmp	Menu_ProgSub14
000b45 c1d4       rjmp	Menu_Temp 
000b46 c1dd       rjmp	Menu_TempSub1
000b47 c20e       rjmp	Menu_TempSub2
000b48 c23e       rjmp	Menu_TempSub3
000b49 c278       rjmp	Menu_Zeit 
000b4a c285       rjmp	Menu_ZeitSub1
000b4b c2b3       rjmp	Menu_ZeitSub2
000b4c c2f0       rjmp	Menu_ZeitSub3
000b4d c330       rjmp	Menu_ZeitSub4
000b4e c368       rjmp	Menu_ZeitSub5
000b4f c3a3       rjmp	Menu_Fens
000b50 c3b0       rjmp	Menu_FensSub1
000b51 c3d9       rjmp	Menu_FensSub11
000b52 c3bc       rjmp	Menu_FensSub2
000b53 c3d7       rjmp	Menu_FensSub11
000b54 c3c8       rjmp	Menu_FensSub3
000b55 c3d5       rjmp	Menu_FensSub11
000b56 c3e7       rjmp	Menu_Reset
000b57 c3f4       rjmp	Menu_ResetSub1
000b58 c403       rjmp	Menu_Adapt
000b59 c410       rjmp	Menu_AdaptSub1
000b5a c413       rjmp	Menu_Urla
000b5b c420       rjmp	Menu_UrlaSub1
000b5c c42f       rjmp	Menu_UrlaSub11
000b5d c436       rjmp	Menu_UrlaSub2
000b5e c445       rjmp	Menu_UrlaSub21
000b5f c44d       rjmp	Menu_UrlaSub3
000b60 c45c       rjmp	Menu_UrlaSub31
000b61 c464       rjmp	Menu_Vent
000b62 c471       rjmp	Menu_VentSub1
000b63 c480       rjmp	Menu_VentSub11
000b64 c489       rjmp	Menu_VentSub2
000b65 c498       rjmp	Menu_VentSub21
000b66 c4a1       rjmp	Menu_Offs
000b67 c4ae       rjmp	Menu_OffsSub1
000b68 c4bb       rjmp	Menu_Debug
000b69 c4c8       rjmp	Menu_Dbg_FW
000b6a c4e5       rjmp	Menu_Dbg_1
000b6b c503       rjmp	Menu_Dbg_2
000b6c c523       rjmp	Menu_Dbg_3
000b6d c543       rjmp	Menu_Dbg_4
000b6e c561       rjmp	Menu_Dbg_5
                 
                 ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
                 Menu_Mode:
000b6f e40d       ldi	Temp, 'M'
000b70 e310       ldi	TempH, $30
000b71 da10       rcall	PutCharacter
000b72 e40f       ldi	Temp, 'O'
000b73 da0e       rcall	PutCharacter
000b74 e404       ldi	Temp, 'D'
000b75 da0c       rcall	PutCharacter
000b76 e405       ldi	Temp, 'E'
000b77 da0a       rcall	PutCharacter
000b78 9508       ret
                 
                 ;....................................................
                 Menu_ModeSub1:
000b79 e40d       ldi	Temp, 'M'
000b7a e110       ldi	TempH, $10
000b7b da06       rcall	PutCharacter
000b7c e401       ldi	Temp, 'A'
000b7d da04       rcall	PutCharacter
000b7e e40e       ldi	Temp, 'N'
000b7f da02       rcall	PutCharacter
000b80 e505       ldi	Temp, 'U'
000b81 da00       rcall	PutCharacter
000b82 da5e       rcall	Space2ndDisplayBuffer
000b83 9508       ret
                 
                 
                 Menu_ModeSub11:
000b84 94f8       cli
000b85 b50a       in		Temp, Status1
000b86 6002       sbr	Temp, (1<<_AutoManu)
000b87 bd0a       out	Status1, Temp
000b88 9478       sei
000b89 d8cf       rcall	Show_AutoManuMode
000b8a dad8       rcall	SetManu
000b8b e050       ldi	TemperatureMode, NoTempMode
000b8c b50b       in		Temp, Status2
000b8d 6002       sbr 	Temp, (1<<_NewTempMode)
000b8e bd0b       out	Status2, Temp
000b8f d946       rcall	ClearBargraph
000b90 dbcb       rcall	ClearHourLegend
000b91 ce03       rjmp	_MenuModeOff
                 
                 
                 Menu_ModeSub2:
000b92 e401       ldi	Temp, 'A'
000b93 e110       ldi	TempH, $10
000b94 d9ed       rcall	PutCharacter
000b95 e505       ldi	Temp, 'U'
000b96 d9eb       rcall	PutCharacter
000b97 e504       ldi	Temp, 'T'
000b98 d9e9       rcall	PutCharacter
000b99 e40f       ldi	Temp, 'O'
000b9a d9e7       rcall	PutCharacter
000b9b da45       rcall	Space2ndDisplayBuffer
000b9c 9508       ret
                  
                 Menu_ModeSub21:
000b9d 94f8       cli
000b9e b50a       in		Temp, Status1
000b9f 7f0d       cbr	Temp, (1<<_AutoManu)
000ba0 bd0a       out	Status1, Temp
000ba1 9478       sei
000ba2 d8b6       rcall	Show_AutoManuMode
000ba3 dbad       rcall	SetHourLegend
000ba4 cdf0       rjmp	_MenuModeOff
                 
                 
                 
                 ;-----------------------------------------------------
                 Menu_Prog:
000ba5 e500       ldi	Temp, 'P'
000ba6 e310       ldi	TempH, $30
000ba7 d9da       rcall	PutCharacter
000ba8 e502       ldi	Temp, 'R'
000ba9 d9d8       rcall	PutCharacter
000baa e40f       ldi	Temp, 'O'
000bab d9d6       rcall	PutCharacter
000bac e407       ldi	Temp, 'G'
000bad d9d4       rcall	PutCharacter
000bae 9508       ret
                 
                 Menu_ProgSub1:
000baf e504       ldi	Temp, 'T'
000bb0 e110       ldi	TempH, $10
000bb1 d9d0       rcall	PutCharacter
000bb2 e401       ldi	Temp, 'A'
000bb3 d9ce       rcall	PutCharacter
000bb4 e407       ldi	Temp, 'G'
000bb5 d9cc       rcall	PutCharacter
000bb6 e301       ldi	Temp, '1'
000bb7 d9ca       rcall	PutCharacter
000bb8 db35       rcall	ClearCase
000bb9 da27       rcall	Space2ndDisplayBuffer
000bba e800       ldi	Temp, LCD_Mo_SET
000bbb dafc       rcall	ClearWeekDays
000bbc e110       ldi	TempH, $10
000bbd da43       rcall	PutWeekDay
000bbe d917       rcall	ClearBargraph
000bbf 9508       ret
                 
                 Menu_ProgSub2:
000bc0 e504       ldi	Temp, 'T'
000bc1 e110       ldi	TempH, $10
000bc2 d9bf       rcall	PutCharacter
000bc3 e401       ldi	Temp, 'A'
000bc4 d9bd       rcall	PutCharacter
000bc5 e407       ldi	Temp, 'G'
000bc6 d9bb       rcall	PutCharacter
000bc7 e302       ldi	Temp, '2'
000bc8 d9b9       rcall	PutCharacter
000bc9 e801       ldi	Temp, LCD_Di_SET
000bca daed       rcall	ClearWeekDays
000bcb e110       ldi	TempH, $10
000bcc da34       rcall	PutWeekDay
000bcd d908       rcall	ClearBargraph
000bce 9508       ret
                 
                 Menu_ProgSub3:
000bcf e504       ldi	Temp, 'T'
000bd0 e110       ldi	TempH, $10
000bd1 d9b0       rcall	PutCharacter
000bd2 e401       ldi	Temp, 'A'
000bd3 d9ae       rcall	PutCharacter
000bd4 e407       ldi	Temp, 'G'
000bd5 d9ac       rcall	PutCharacter
000bd6 e303       ldi	Temp, '3'
000bd7 d9aa       rcall	PutCharacter
000bd8 e802       ldi	Temp, LCD_Mi_SET
000bd9 dade       rcall	ClearWeekDays
000bda e110       ldi	TempH, $10
000bdb da25       rcall	PutWeekDay
000bdc d8f9       rcall	ClearBargraph
000bdd 9508       ret
                 
                 Menu_ProgSub4:
000bde e504       ldi	Temp, 'T'
000bdf e110       ldi	TempH, $10
000be0 d9a1       rcall	PutCharacter
000be1 e401       ldi	Temp, 'A'
000be2 d99f       rcall	PutCharacter
000be3 e407       ldi	Temp, 'G'
000be4 d99d       rcall	PutCharacter
000be5 e304       ldi	Temp, '4'
000be6 d99b       rcall	PutCharacter
000be7 e803       ldi	Temp, LCD_Do_SET
000be8 dacf       rcall	ClearWeekDays
000be9 e110       ldi	TempH, $10
000bea da16       rcall	PutWeekDay
000beb d8ea       rcall	ClearBargraph
000bec 9508       ret
                 
                 Menu_ProgSub5:
000bed e504       ldi	Temp, 'T'
000bee e110       ldi	TempH, $10
000bef d992       rcall	PutCharacter
000bf0 e401       ldi	Temp, 'A'
000bf1 d990       rcall	PutCharacter
000bf2 e407       ldi	Temp, 'G'
000bf3 d98e       rcall	PutCharacter
000bf4 e305       ldi	Temp, '5'
000bf5 d98c       rcall	PutCharacter
000bf6 e804       ldi	Temp, LCD_Fr_SET
000bf7 dac0       rcall	ClearWeekDays
000bf8 e110       ldi	TempH, $10
000bf9 da07       rcall	PutWeekDay
000bfa d8db       rcall	ClearBargraph
000bfb 9508       ret
                 
                 Menu_ProgSub6:
000bfc e504       ldi	Temp, 'T'
000bfd e110       ldi	TempH, $10
000bfe d983       rcall	PutCharacter
000bff e401       ldi	Temp, 'A'
000c00 d981       rcall	PutCharacter
000c01 e407       ldi	Temp, 'G'
000c02 d97f       rcall	PutCharacter
000c03 e306       ldi	Temp, '6'
000c04 d97d       rcall	PutCharacter
000c05 e805       ldi	Temp, LCD_Sa_SET
000c06 dab1       rcall	ClearWeekDays
000c07 e110       ldi	TempH, $10
000c08 d9f8       rcall	PutWeekDay
000c09 d8cc       rcall	ClearBargraph
000c0a 9508       ret
                 
                 Menu_ProgSub7:
000c0b e504       ldi	Temp, 'T'
000c0c e110       ldi	TempH, $10
000c0d d974       rcall	PutCharacter
000c0e e401       ldi	Temp, 'A'
000c0f d972       rcall	PutCharacter
000c10 e407       ldi	Temp, 'G'
000c11 d970       rcall	PutCharacter
000c12 e307       ldi	Temp, '7'
000c13 d96e       rcall	PutCharacter
000c14 e806       ldi	Temp, LCD_So_SET
000c15 daa2       rcall	ClearWeekDays
000c16 e110       ldi	TempH, $10
000c17 d9e9       rcall	PutWeekDay
000c18 d8bd       rcall	ClearBargraph
000c19 9508       ret
                 
                 Menu_ProgSub8:
000c1a e504       ldi	Temp, 'T'
000c1b e110       ldi	TempH, $10
000c1c d965       rcall	PutCharacter
000c1d e301       ldi	Temp, '1'
000c1e d963       rcall	PutCharacter
000c1f e30a       ldi	Temp, ':'
000c20 d961       rcall	PutCharacter
000c21 e305       ldi	Temp, '5'
000c22 d95f       rcall	PutCharacter
000c23 e800       ldi	Temp, LCD_Mo_SET
000c24 da93       rcall	ClearWeekDays
000c25 e110       ldi	TempH, $10
000c26 d9da       rcall	PutWeekDay
000c27 e801       ldi	Temp, LCD_Di_SET
000c28 d9d8       rcall	PutWeekDay
000c29 e802       ldi	Temp, LCD_Mi_SET
000c2a d9d6       rcall	PutWeekDay
000c2b e803       ldi	Temp, LCD_Do_SET
000c2c d9d4       rcall	PutWeekDay
000c2d e804       ldi	Temp, LCD_Fr_SET
000c2e d9d2       rcall	PutWeekDay
000c2f d8a6       rcall	ClearBargraph
000c30 9508       ret
                 
                 Menu_ProgSub9:
000c31 e504       ldi	Temp, 'T'
000c32 e110       ldi	TempH, $10
000c33 d94e       rcall	PutCharacter
000c34 e301       ldi	Temp, '1'
000c35 d94c       rcall	PutCharacter
000c36 e30a       ldi	Temp, ':'
000c37 d94a       rcall	PutCharacter
000c38 e306       ldi	Temp, '6'
000c39 d948       rcall	PutCharacter
000c3a e800       ldi	Temp, LCD_Mo_SET
000c3b da7c       rcall	ClearWeekDays
000c3c e110       ldi	TempH, $10
000c3d d9c3       rcall	PutWeekDay
000c3e e801       ldi	Temp, LCD_Di_SET
000c3f d9c1       rcall	PutWeekDay
000c40 e802       ldi	Temp, LCD_Mi_SET
000c41 d9bf       rcall	PutWeekDay
000c42 e803       ldi	Temp, LCD_Do_SET
000c43 d9bd       rcall	PutWeekDay
000c44 e804       ldi	Temp, LCD_Fr_SET
000c45 d9bb       rcall	PutWeekDay
000c46 e805       ldi	Temp, LCD_Sa_SET
000c47 d9b9       rcall	PutWeekDay
000c48 d88d       rcall	ClearBargraph
000c49 9508       ret
                 
                 Menu_ProgSubA:
000c4a d996       rcall	Space2ndDisplayBuffer
000c4b daa2       rcall	ClearCase
000c4c e504       ldi	Temp, 'T'
000c4d e110       ldi	TempH, $10
000c4e d933       rcall	PutCharacter
000c4f e301       ldi	Temp, '1'
000c50 d931       rcall	PutCharacter
000c51 e30a       ldi	Temp, ':'
000c52 d92f       rcall	PutCharacter
000c53 e307       ldi	Temp, '7'
000c54 d92d       rcall	PutCharacter
000c55 e800       ldi	Temp, LCD_Mo_SET
000c56 da61       rcall	ClearWeekDays
000c57 e110       ldi	TempH, $10
000c58 d9a8       rcall	PutWeekDay
000c59 e801       ldi	Temp, LCD_Di_SET
000c5a d9a6       rcall	PutWeekDay
000c5b e802       ldi	Temp, LCD_Mi_SET
000c5c d9a4       rcall	PutWeekDay
000c5d e803       ldi	Temp, LCD_Do_SET
000c5e d9a2       rcall	PutWeekDay
000c5f e804       ldi	Temp, LCD_Fr_SET
000c60 d9a0       rcall	PutWeekDay
000c61 e805       ldi	Temp, LCD_Sa_SET
000c62 d99e       rcall	PutWeekDay
000c63 e806       ldi	Temp, LCD_So_SET
000c64 d99c       rcall	PutWeekDay
000c65 d870       rcall	ClearBargraph
000c66 9508       ret
                 
                  Menu_ProgSubB:
000c67 e110       ldi	TempH, $10
000c68 e505       ldi	Temp, 'U'
000c69 d918       rcall	PutCharacter
000c6a e502       ldi	Temp, 'R'
000c6b d916       rcall	PutCharacter
000c6c e30a       ldi	Temp, ':'
000c6d d914       rcall	PutCharacter
000c6e e30f       ldi	Temp, '?'
000c6f d912       rcall	PutCharacter
000c70 da47       rcall	ClearWeekDays
000c71 e210       ldi	TempH, $20
000c72 e40c       ldi	Temp, 'L'
000c73 d90e       rcall	PutCharacter
000c74 e401       ldi	Temp, 'A'
000c75 d90c       rcall	PutCharacter
000c76 e505       ldi	Temp, 'U'
000c77 d90a       rcall	PutCharacter
000c78 e402       ldi	Temp, 'B'
000c79 d908       rcall	PutCharacter
000c7a dacb       rcall	BlinkCase
000c7b d85a       rcall	ClearBargraph
000c7c 9508       ret
                 
                 
                 ;....................................
                 Menu_ProgSub11:
000c7d 9af7       sbi	Status0, _MenuWork 
000c7e 930f       push	Temp
                 
000c7f da25       rcall	CopyWeekDays1_2
                 
000c80 da62       rcall	ClearMoon
000c81 da56       rcall	ClearOffHouse
000c82 da76       rcall	SetInHouse
                 
                 _MenuProg_Com:
000c83 d9f5       rcall	SetColon
                  
000c84 e6ae       ldi	XL, low(DailyTimer)
000c85 e0b1       ldi	XH, high(DailyTimer)
000c86 9100 0132  lds	Temp, MenuLow
000c88 5101       subi	Temp, $11
000c89 2f10       mov	TempH, Temp
000c8a 700f       andi	Temp, $0F
000c8b 7f10       andi	TempH, $F0
000c8c 9512       swap	TempH
000c8d e089       ldi	Temp3, 9								;number of timers per Day
000c8e 9f18       mul	TempH, Temp3
000c8f 0da0       add	XL, r0
000c90 1db1       adc	XH, r1
000c91 93a0 0136  sts	BarBaseL, XL
000c93 93b0 0137  sts	BarBaseH, XH
000c95 0fa0       add	XL, Temp
000c96 1db2       adc	XH, Null
                 
000c97 911c       ld		TempH, X
                  
000c98 910f       pop	Temp
000c99 3001       cpi	Temp, 1
000c9a f031       breq	_ProgSub11Minus
000c9b 3002       cpi	Temp, 2
000c9c f049       breq	_ProgSub11Plus
000c9d 3003       cpi	Temp, 3
000c9e f009       breq	_ProgSub11EnterX
000c9f c00a       rjmp	_MPS11
                  
                 _ProgSub11EnterX:
000ca0 c032       rjmp	_ProgSub11Enter
                  
                 _ProgSub11Minus:
000ca1 951a       dec	TempH
000ca2 3f1e       cpi	TempH, 254
000ca3 f431       brne	_MPS11
000ca4 e81f       ldi	TempH, 143
000ca5 c004       rjmp	_MPS11
                 
                 _ProgSub11Plus:
000ca6 9513       inc	TempH
000ca7 3910       cpi	TempH, 144
000ca8 f409       brne	_MPS11
000ca9 ef1f       ldi	TempH, 255
                 
                 _MPS11:
000caa 931c       st 	X, TempH
000cab 3f1f       cpi	TempH, 255
000cac f099       breq	_TimerInactive
                  
000cad 2f01       mov	Temp, TempH
000cae 940e 0322  call	DivTimer2HourTenMin
                 
000cb0 2d0e       mov	Temp, Di2
000cb1 3300       cpi	Temp, '0'
000cb2 f409       brne	_MPS111
000cb3 e30f       ldi	Temp, '?'							;clear leading zero
                 
                 _MPS111:
000cb4 e110       ldi	TempH, $10
000cb5 d8cc       rcall	PutCharacter
000cb6 2d0d       mov	Temp, Di1
000cb7 d8ca       rcall	PutCharacter
000cb8 2d0c       mov	Temp, Di0
000cb9 d8c8       rcall	PutCharacter
000cba e300       ldi	Temp, '0'
000cbb d8c6       rcall	PutCharacter
000cbc d924       rcall	Space2ndDisplayBuffer
000cbd 940e 049f  call	Show_TimerSetBar
000cbf 9508       ret
                 
                 _TimerInactive:
000cc0 e30a       ldi	Temp, ':'
000cc1 e110       ldi	TempH, $10
000cc2 d8bf       rcall	PutCharacter
000cc3 e30a       ldi	Temp, ':'
000cc4 d8bd       rcall	PutCharacter
000cc5 e30a       ldi	Temp, ':'
000cc6 d8bb       rcall	PutCharacter
000cc7 e30a       ldi	Temp, ':'
000cc8 d8b9       rcall	PutCharacter
000cc9 e210       ldi	TempH, $20
000cca e30f       ldi	Temp, '?'
000ccb d8b6       rcall	PutCharacter
000ccc e30f       ldi	Temp, '?'
000ccd d8b4       rcall	PutCharacter
000cce e30f       ldi	Temp, '?'
000ccf d8b2       rcall	PutCharacter
000cd0 e30f       ldi	Temp, '?'
000cd1 d8b0       rcall	PutCharacter
000cd2 9508       ret
                 
                  
                 _ProgSub11Enter:
000cd3 d9b0       rcall	ClearColon
000cd4 98f7       cbi	Status0, _MenuWork 
                  
000cd5 9100 0132  lds	Temp, MenuLow
000cd7 7001       andi	Temp, $01							;check for even submenu, 2nd part of a day timer
000cd8 f4c1       brne	_ProgSub11Enter1
000cd9 910e       ld		Temp, -X
000cda 3f0f       cpi	Temp, 255
000cdb f4a9       brne	_ProgSub11Enter1					;if both parts of a day timer are inactive...
000cdc 9611       adiw	XH:XL, 1
000cdd 910d       ld		Temp, X+
000cde 3f0f       cpi	Temp, 255
000cdf f489       brne	_ProgSub11Enter1
                 
000ce0 9100 0132  lds	Temp, MenuLow						;...set all day timers after one inactive Timer also to inactive state... 
000ce2 700f       andi	Temp, $0F
000ce3 5008       subi	Temp, 8
000ce4 ef1f       ldi	TempH, 255
                 
                 _ClearInactiveTimers:
000ce5 3000       cpi	Temp, 0
000ce6 f019       breq	_ClrInT1
000ce7 931d       st		X+, TempH
000ce8 9503       inc	Temp
000ce9 cffb       rjmp	_ClearInactiveTimers
                 
                 _ClrInT1:
000cea 9100 0132  lds	Temp, MenuLow
000cec 7f00       andi	Temp, $F0
000ced 5f08       subi	Temp, -8
000cee 9300 0132  sts	MenuLow, Temp						;...and jump forward to night timer submenu
000cf0 cdd5       rjmp	_IncSubSub
                  
                 _ProgSub11Enter1:
000cf1 9100 0132  lds	Temp, MenuLow
000cf3 700f       andi	Temp, $0F
000cf4 3009       cpi	Temp, 9								;check for last subsub menu (night timer)
000cf5 f009       breq	_PS11Ent1	
000cf6 cdcf       rjmp	_IncSubSub
                  
                 _PS11Ent1:
000cf7 d9f6       rcall	ClearCase
000cf8 d9ea       rcall	ClearMoon
000cf9 9100 0132  lds	Temp, MenuLow
000cfb 7f00       andi	Temp, $F0
000cfc 3b00       cpi	Temp, $B0							;if higher or equal than vacation mode, dont copy block data
000cfd f418       brcc	_PS11Ent2
000cfe 3800       cpi	Temp, $80							;if block menu, then copy block data to selected days
000cff f008       brcs	_PS11Ent2
000d00 d3f0       rcall	CopyTimerBlock						
                 
                 _PS11Ent2:
000d01 9100 0132  lds	Temp, MenuLow
000d03 7f00       andi	Temp, $F0
000d04 9300 0132  sts	MenuLow, Temp
000d06 3b00       cpi	Temp, 0xB0							;on last sub Menu switch to first
000d07 f411       brne	_PS11_Ent3
000d08 9220 0132  sts	MenuLow, Null
                 
                 _PS11_Ent3:
000d0a cdb5       rjmp	_IncSub
                 
                  
                 ;............................................ 
                 Menu_ProgSub12:
000d0b 9af7       sbi	Status0, _MenuWork 
000d0c 930f       push	Temp
                 
000d0d d9bf       rcall	ClearInHouse
000d0e d9f5       rcall	SetOffHouse
000d0f cf73       rjmp	_MenuProg_Com
                  
                 ;............................................ 
                 Menu_ProgSub13:
000d10 9af7       sbi	Status0, _MenuWork 
000d11 930f       push	Temp
                 
000d12 d9c5       rcall	ClearOffHouse
000d13 d9e5       rcall	SetInHouse
000d14 cf6e       rjmp	_MenuProg_Com
                 
                 
                 ;............................................ 
                 Menu_ProgSub14:
000d15 9af7       sbi	Status0, _MenuWork 
000d16 930f       push	Temp
                 
000d17 d9c0       rcall	ClearOffHouse 
000d18 d9f6       rcall	SetMoon
000d19 cf69       rjmp	_MenuProg_Com
                 
                 
                  
                 
                 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 
                 Menu_Temp:
000d1a e504       ldi	Temp, 'T'
000d1b e310       ldi	TempH, $30
000d1c d865       rcall	PutCharacter
000d1d e405       ldi	Temp, 'E'
000d1e d863       rcall	PutCharacter
000d1f e40d       ldi	Temp, 'M'
000d20 d861       rcall	PutCharacter
000d21 e500       ldi	Temp, 'P'
000d22 d85f       rcall	PutCharacter
000d23 9508       ret
                 
                 ;...............................................................
                 Menu_TempSub1:
000d24 9af7       sbi	Status0, _MenuWork  
                   
000d25 91a0 013e  lds	XL, InHouseTempL
000d27 91b0 013f  lds	XH, InHouseTempH
                 
000d29 3001       cpi	Temp, 1
000d2a f029       breq	_InHouseMinus
000d2b 3002       cpi	Temp, 2
000d2c f051       breq	_InHousePlus
000d2d 3003       cpi	Temp, 3
000d2e f129       breq	_InHouseEnter
000d2f c00e       rjmp	_MTS11
                 
                 _InHouseMinus:
000d30 9715       sbiw	XH:XL, 5
000d31 32a8       cpi	XL, 40
000d32 05b2       cpc	XH, Null
000d33 f450       brcc	_MTS11
000d34 e2a8       ldi	XL, 40
000d35 27bb       clr	XH
000d36 c007       rjmp	_MTS11
                 
                 _InHousePlus:
000d37 9615       adiw	XH:XL, 5
000d38 e081       ldi	Temp3, high (500)
000d39 3fa4       cpi	XL, low (500)
000d3a 07b8       cpc	XH, Temp3
000d3b f010       brcs	_MTS11
000d3c efa4       ldi	XL, low	(500)
000d3d e0b1       ldi	XH, high (500)
                 
                 _MTS11:
000d3e 93a0 013e  sts	InHouseTempL, XL
000d40 93b0 013f  sts	InHouseTempH, XH
000d42 018d       movw	TempH:Temp, XH:XL
000d43 940e 02ef  call	DivHL
000d45 2d0e       mov	Temp, Di2
000d46 e110       ldi	TempH, $10
000d47 d83a       rcall	PutCharacter
                 
000d48 d946       rcall	SetPoint
                  
000d49 2d0d       mov	Temp, Di1
000d4a d837       rcall	PutCharacter
000d4b 2d0c       mov	Temp, Di0
000d4c d835       rcall	PutCharacter
000d4d e400       ldi	Temp, '@'
000d4e d833       rcall	PutCharacter
000d4f d891       rcall	Space2ndDisplayBuffer
                 
000d50 d987       rcall	ClearOffHouse
000d51 d991       rcall	ClearMoon
000d52 d9a6       rcall	SetInHouse
000d53 9508       ret
                 
                 _InHouseEnter:
000d54 98f7       cbi	Status0, _MenuWork  
000d55 cd6a       rjmp	_IncSub
                 
                 
                 ;...............................................................
                 Menu_TempSub2:
000d56 9af7       sbi	Status0, _MenuWork  
                   
000d57 91a0 0140  lds	XL, OffHouseTempL
000d59 91b0 0141  lds	XH, OffHouseTempH
                 
000d5b 3001       cpi	Temp, 1
000d5c f029       breq	_OffHouseMinus
000d5d 3002       cpi	Temp, 2
000d5e f051       breq	_OffHousePlus
000d5f 3003       cpi	Temp, 3
000d60 f121       breq	_OffHouseEnter
000d61 c00e       rjmp	_MTS21
                 
                 _OffHouseMinus:
000d62 9715       sbiw	XH:XL, 5
000d63 32a8       cpi	XL, 40
000d64 05b2       cpc	XH, Null
000d65 f450       brcc	_MTS21
000d66 e2a8       ldi	XL, 40
000d67 27bb       clr	XH
000d68 c007       rjmp	_MTS21
                 
                 _OffHousePlus:
000d69 9615       adiw	XH:XL, 5
000d6a e081       ldi	Temp3, high (500)
000d6b 3fa4       cpi	XL, low (500)
000d6c 07b8       cpc	XH, Temp3
000d6d f010       brcs	_MTS21
000d6e efa4       ldi	XL, low	(500)
000d6f e0b1       ldi	XH, high (500)
                 
                 _MTS21:
000d70 93a0 0140  sts	OffHouseTempL, XL
000d72 93b0 0141  sts	OffHouseTempH, XH
000d74 018d       movw	TempH:Temp, XH:XL
000d75 940e 02ef  call	DivHL
000d77 2d0e       mov	Temp, Di2
000d78 e110       ldi	TempH, $10
000d79 d808       rcall	PutCharacter
                 
000d7a d914       rcall	SetPoint
                  
000d7b 2d0d       mov	Temp, Di1
000d7c d805       rcall	PutCharacter
000d7d 2d0c       mov	Temp, Di0
000d7e d803       rcall	PutCharacter
000d7f e400       ldi	Temp, '@'
000d80 d801       rcall	PutCharacter
000d81 d85f       rcall	Space2ndDisplayBuffer
                 
000d82 d94a       rcall	ClearInHouse
000d83 d980       rcall	SetOffHouse
000d84 9508       ret
                 
                 _OffHouseEnter:
000d85 98f7       cbi	Status0, _MenuWork  
000d86 cd39       rjmp	_IncSub
                 
                 
                 ;...............................................................
                 Menu_TempSub3:
000d87 9af7       sbi	Status0, _MenuWork  
                   
000d88 91a0 0142  lds	XL, NightTempL
000d8a 91b0 0143  lds	XH, NightTempH
                 
000d8c 3001       cpi	Temp, 1
000d8d f029       breq	_NightMinus
000d8e 3002       cpi	Temp, 2
000d8f f051       breq	_NightPlus
000d90 3003       cpi	Temp, 3
000d91 f141       breq	_NightEnter
000d92 c00e       rjmp	_MTS31
                 
                 _NightMinus:
000d93 9715       sbiw	XH:XL, 5
000d94 32a8       cpi	XL, 40
000d95 05b2       cpc	XH, Null
000d96 f450       brcc	_MTS31
000d97 e2a8       ldi	XL, 40
000d98 27bb       clr	XH
000d99 c007       rjmp	_MTS31
                 
                 _NightPlus:
000d9a 9615       adiw	XH:XL, 5
000d9b e081       ldi	Temp3, high (500)
000d9c 3fa4       cpi	XL, low (500)
000d9d 07b8       cpc	XH, Temp3
000d9e f010       brcs	_MTS31
000d9f efa4       ldi	XL, low	(500)
000da0 e0b1       ldi	XH, high (500)
                 
                 _MTS31:
000da1 93a0 0142  sts	NightTempL, XL
000da3 93b0 0143  sts	NightTempH, XH
000da5 018d       movw	TempH:Temp, XH:XL
000da6 940e 02ef  call	DivHL
000da8 2d0e       mov	Temp, Di2
000da9 e110       ldi	TempH, $10
000daa 940e 0582  call	PutCharacter
                 
000dac d8e2       rcall	SetPoint
                  
000dad 2d0d       mov	Temp, Di1
000dae 940e 0582  call	PutCharacter
000db0 2d0c       mov	Temp, Di0
000db1 940e 0582  call	PutCharacter
000db3 e400       ldi	Temp, '@'
000db4 940e 0582  call	PutCharacter
000db6 d82a       rcall	Space2ndDisplayBuffer
                 
000db7 d920       rcall	ClearOffHouse
000db8 d956       rcall	SetMoon
000db9 9508       ret
                 
                 _NightEnter:
000dba 98f7       cbi	Status0, _MenuWork  
000dbb 9220 0132  sts	MenuLow, Null
000dbd d90f       rcall	ClearInHouse
000dbe d919       rcall	ClearOffHouse
000dbf d923       rcall	ClearMoon
000dc0 d8d9       rcall	ClearPoint
000dc1 cc5d       rjmp	_GM_0
                 
                 
                 
                 ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
                 Menu_Zeit:
000dc2 e50a       ldi	Temp, 'Z'
000dc3 e310       ldi	TempH, $30
000dc4 940e 0582  call	PutCharacter
000dc6 e405       ldi	Temp, 'E'
000dc7 940e 0582  call	PutCharacter
000dc9 e409       ldi	Temp, 'I'
000dca 940e 0582  call	PutCharacter
000dcc e504       ldi	Temp, 'T'
000dcd 940e 0582  call	PutCharacter
000dcf 9508       ret
                 
                 
                 ;...................................
                 ;set Year value
                 Menu_ZeitSub1:
000dd0 9af7       sbi	Status0, _MenuWork  
000dd1 9110 0123  lds	TempH, Years
                 
000dd3 3001       cpi	Temp, 1
000dd4 f029       breq	_YearsMinus
000dd5 3002       cpi	Temp, 2
000dd6 f041       breq	_YearsPlus
000dd7 3003       cpi	Temp, 3
000dd8 f121       breq	_YearsEnter
000dd9 c009       rjmp	_MZS11
                 
                 _YearsMinus:
000dda 951a       dec	TempH
000ddb 3f1f       cpi	TempH, 255
000ddc f431       brne	_MZS11
000ddd e613       ldi	TempH, 99
000dde c004       rjmp	_MZS11
                 
                 _YearsPlus:
000ddf 9513       inc	TempH
000de0 3614       cpi	TempH, 100
000de1 f409       brne	_MZS11 
000de2 2711       clr	TempH
                 
                 _MZS11:
000de3 9310 0123  sts	Years, TempH
000de5 2f01       mov	Temp, TempH
000de6 940e 030f  call	DivDez
                   
000de8 e302       ldi	Temp, '2'
000de9 e110       ldi	TempH, $10
000dea 940e 0582  call	PutCharacter
000dec e300       ldi	Temp, '0'
000ded 940e 0582  call	PutCharacter
000def 2d0d       mov	Temp, Di1
000df0 940e 0582  call	PutCharacter
000df2 2d0c       mov	Temp, Di0
000df3 940e 0582  call	PutCharacter
000df5 940e 05e1  call	Space2ndDisplayBuffer
000df7 d515       rcall	CalcDayOfWeek
000df8 6800       ori	Temp, $80
000df9 d8be       rcall	ClearWeekDays
000dfa e310       ldi	TempH, $30
000dfb d805       rcall	PutWeekDay
000dfc 9508       ret
                 
                 _YearsEnter:
000dfd 98f7       cbi	Status0, _MenuWork  
000dfe ccc1       rjmp	_IncSub
                 
                 
                 ;....................................
                 ;set Months value
                  Menu_ZeitSub2:
000dff 9af7       sbi	Status0, _MenuWork  
000e00 9110 0122  lds	TempH, Months
                 
000e02 3001       cpi	Temp, 1
000e03 f029       breq	_MonthsMinus
000e04 3002       cpi	Temp, 2
000e05 f041       breq	_MonthsPlus
000e06 3003       cpi	Temp, 3
000e07 f199       breq	_MonthsEnter
000e08 c009       rjmp	_MZS21
                 
                 _MonthsMinus:
000e09 951a       dec	TempH
000e0a 3f1f       cpi	TempH, 255
000e0b f431       brne	_MZS21
000e0c e01b       ldi	TempH, 11
000e0d c004       rjmp	_MZS21
                 
                 _MonthsPlus:
000e0e 9513       inc	TempH
000e0f 301c       cpi	TempH, 12
000e10 f409       brne	_MZS21 
000e11 2711       clr	TempH 
                 
                 _MZS21:
000e12 9310 0122  sts	Months, TempH
                  
000e14 9100 0121  lds	Temp, Days
000e16 9503       inc	Temp
000e17 940e 030f  call	DivDez
                   
000e19 2d0d       mov	Temp, Di1
000e1a e310       ldi	TempH, $30
000e1b 940e 0582  call	PutCharacter
000e1d 2d0c       mov	Temp, Di0
000e1e 940e 0582  call	PutCharacter
                  
000e20 d86e       rcall	SetPoint
                 
000e21 e30f       ldi	Temp, '?'
000e22 e212       ldi	TempH, $22
000e23 940e 0582  call	PutCharacter
000e25 e30f       ldi	Temp, '?'
000e26 940e 0582  call	PutCharacter
                  
000e28 9100 0122  lds	Temp, Months
000e2a 9503       inc	Temp						;add 1 to month value to display 1...12
000e2b 940e 030f  call	DivDez
                  
000e2d 2d0d       mov	Temp, Di1
000e2e e112       ldi	TempH, $12
000e2f 940e 0582  call	PutCharacter
000e31 2d0c       mov	Temp, Di0
000e32 940e 0582  call	PutCharacter
000e34 d4d8       rcall	CalcDayOfWeek
000e35 6800       ori	Temp, $80
000e36 d881       rcall	ClearWeekDays
000e37 e310       ldi	TempH, $30
000e38 940e 0601  call	PutWeekDay
000e3a 9508       ret
                 
                 _MonthsEnter:
000e3b 98f7       cbi	Status0, _MenuWork  
000e3c cc83       rjmp	_IncSub
                 
                 
                 ;....................................
                 ;set Days value
                  Menu_ZeitSub3:
000e3d 9af7       sbi	Status0, _MenuWork  
000e3e 9180 0121  lds	Temp3, Days
                 
000e40 3001       cpi	Temp, 1
000e41 f029       breq	_DaysMinus
000e42 3002       cpi	Temp, 2
000e43 f051       breq	_DaysPlus
000e44 3003       cpi	Temp, 3
000e45 f1a9       breq	_DaysEnter
000e46 c00c       rjmp	_MZS31
                 
                 _DaysMinus:
000e47 d4ed       rcall	MonthLastDay
000e48 958a       dec	Temp3
000e49 3f8f       cpi	Temp3, 255
000e4a f441       brne	_MZS31
000e4b 2f81       mov	Temp3, TempH
000e4c 958a       dec	Temp3
000e4d c005       rjmp	_MZS31
                 
                 _DaysPlus:
000e4e d4e6       rcall	MonthLastDay
000e4f 9583       inc	Temp3
000e50 1781       cp		Temp3, TempH
000e51 f409       brne	_MZS31
000e52 2788       clr	Temp3
                 
                 _MZS31:
000e53 9380 0121  sts	Days, Temp3
                  
000e55 9100 0121  lds	Temp, Days
000e57 9503       inc	Temp							;add 1 to days value to display 1..31
000e58 940e 030f  call	DivDez
                   
000e5a 2d0d       mov	Temp, Di1
000e5b e110       ldi	TempH, $10
000e5c 940e 0582  call	PutCharacter
000e5e 2d0c       mov	Temp, Di0
000e5f 940e 0582  call	PutCharacter
000e61 e30f       ldi	Temp, '?'
000e62 e210       ldi	TempH, $20
000e63 940e 0582  call	PutCharacter
000e65 e30f       ldi	Temp, '?'
000e66 940e 0582  call	PutCharacter
                  
000e68 9100 0122  lds	Temp, Months
000e6a 9503       inc	Temp							;add 1 to month value to display 1...12
000e6b 940e 030f  call	DivDez
                  
000e6d 2d0d       mov	Temp, Di1
000e6e e312       ldi	TempH, $32
000e6f 940e 0582  call	PutCharacter
000e71 2d0c       mov	Temp, Di0
000e72 940e 0582  call	PutCharacter
000e74 d498       rcall	CalcDayOfWeek
000e75 6800       ori	Temp, $80
000e76 d841       rcall	ClearWeekDays
000e77 e310       ldi	TempH, $30
000e78 940e 0601  call	PutWeekDay
000e7a 9508       ret
                 
                 _DaysEnter: 
000e7b 98f7       cbi	Status0, _MenuWork  
000e7c d81d       rcall	ClearPoint
000e7d cc42       rjmp	_IncSub
                 
                 
                 
                 ;....................................
                 ;set Hours value
                  Menu_ZeitSub4:
000e7e 9af7       sbi	Status0, _MenuWork  
000e7f 9110 0120  lds	TempH, Hours
                 
000e81 3001       cpi	Temp, 1
000e82 f029       breq	_HoursMinus
000e83 3002       cpi	Temp, 2
000e84 f041       breq	_HoursPlus
000e85 3003       cpi	Temp, 3
000e86 f171       breq	_HoursEnter
000e87 c009       rjmp	_MZS41
                 
                 _HoursMinus:
000e88 951a       dec	TempH
000e89 3f1f       cpi	TempH, 255
000e8a f431       brne	_MZS41
000e8b e117       ldi	TempH, 23
000e8c c004       rjmp	_MZS41
                 
                 _HoursPlus:
000e8d 9513       inc	TempH
000e8e 3118       cpi	TempH, 24
000e8f f409       brne	_MZS41 
000e90 2711       clr	TempH 
                 
                 _MZS41:
000e91 9310 0120  sts	Hours, TempH
                  
000e93 2f01       mov	Temp, TempH
000e94 940e 030f  call	DivDez
                   
000e96 2d0d       mov	Temp, Di1
000e97 3300       cpi	Temp, '0'
000e98 f409       brne	_MSZ411
000e99 e30f       ldi	Temp, '?'						;clear leading zero
                 
                 _MSZ411:
000e9a e110       ldi	TempH, $10
000e9b 940e 0582  call	PutCharacter
000e9d 2d0c       mov	Temp, Di0
000e9e 940e 0582  call	PutCharacter
                  
000ea0 e30f       ldi	Temp, '?'
000ea1 e210       ldi	TempH, $20
000ea2 940e 0582  call	PutCharacter
000ea4 e30f       ldi	Temp, '?'
000ea5 940e 0582  call	PutCharacter
                  
000ea7 940e 0679  call	SetColon
                 
000ea9 9100 011f  lds	Temp, Minutes
000eab 940e 030f  call	DivDez
                  
000ead 2d0d       mov	Temp, Di1
000eae e312       ldi	TempH, $32
000eaf 940e 0582  call	PutCharacter
000eb1 2d0c       mov	Temp, Di0
000eb2 940e 0582  call	PutCharacter
000eb4 9508       ret
                 
                 _HoursEnter:
000eb5 98f7       cbi	Status0, _MenuWork  
000eb6 cc09       rjmp	_IncSub
                  
                 
                  ;....................................
                 ;set Minutes value
                  Menu_ZeitSub5:
000eb7 9af7       sbi	Status0, _MenuWork  
000eb8 9110 011f  lds	TempH, Minutes
                 
000eba 3001       cpi	Temp, 1
000ebb f029       breq	_MinutesMinus
000ebc 3002       cpi	Temp, 2
000ebd f041       breq	_MinutesPlus
000ebe 3003       cpi	Temp, 3
000ebf f169       breq	_MinutesEnter
000ec0 c009       rjmp	_MZS51
                 
                 _MinutesMinus:
000ec1 951a       dec	TempH
000ec2 3f1f       cpi	TempH, 255
000ec3 f431       brne	_MZS51
000ec4 e31b       ldi	TempH, 59
000ec5 c004       rjmp	_MZS51
                 
                 _MinutesPlus:
000ec6 9513       inc	TempH
000ec7 331c       cpi	TempH, 60
000ec8 f409       brne	_MZS51 
000ec9 2711       clr	TempH 
                 
                 _MZS51:
000eca 9310 011f  sts	Minutes, TempH
                  
000ecc 9100 0120  lds	Temp, Hours
000ece 940e 030f  call	DivDez
                   
000ed0 2d0d       mov	Temp, Di1
000ed1 3300       cpi	Temp, '0'
000ed2 f409       brne	_MSZ511
000ed3 e30f       ldi	Temp, '?'						;clear leading zero
                 
                 _MSZ511:
000ed4 e310       ldi	TempH, $30
000ed5 940e 0582  call	PutCharacter
000ed7 2d0c       mov	Temp, Di0
000ed8 940e 0582  call	PutCharacter
                 
000eda 9100 011f  lds	Temp, Minutes
000edc 940e 030f  call	DivDez
                  
000ede 2d0d       mov	Temp, Di1
000edf e112       ldi	TempH, $12
000ee0 940e 0582  call	PutCharacter
000ee2 2d0c       mov	Temp, Di0
000ee3 940e 0582  call	PutCharacter
000ee5 e30f       ldi	Temp, '?'
000ee6 e212       ldi	TempH, $22
000ee7 940e 0582  call	PutCharacter
000ee9 e30f       ldi	Temp, '?'
000eea 940e 0582  call	PutCharacter
000eec 9508       ret
                 
                 _MinutesEnter:
000eed 98f7       cbi	Status0, _MenuWork  
000eee 9220 0132  sts	MenuLow, Null
000ef0 940e 0684  call	ClearColon
000ef2 cb2c       rjmp	_GM_0
                  
                  
                 
                 
                 
                 ;---------------------------------------------------
                 Menu_Fens:
000ef3 e406       ldi	Temp, 'F'
000ef4 e310       ldi	TempH, $30
000ef5 940e 0582  call	PutCharacter
000ef7 e405       ldi	Temp, 'E'
000ef8 940e 0582  call	PutCharacter
000efa e40e       ldi	Temp, 'N'
000efb 940e 0582  call	PutCharacter
000efd e503       ldi	Temp, 'S'
000efe 940e 0582  call	PutCharacter
000f00 9508       ret
                 
                 Menu_FensSub1:
000f01 e408       ldi	Temp, 'H'
000f02 e310       ldi	TempH, $30
000f03 940e 0582  call	PutCharacter
000f05 e40f       ldi	Temp, 'O'
000f06 940e 0582  call	PutCharacter
000f08 e403       ldi	Temp, 'C'
000f09 940e 0582  call	PutCharacter
000f0b e408       ldi	Temp, 'H'
000f0c 940e 0582  call	PutCharacter
000f0e 9508       ret
                 
                 
                 Menu_FensSub2:
000f0f e40d       ldi	Temp, 'M'
000f10 e310       ldi	TempH, $30
000f11 940e 0582  call	PutCharacter
000f13 e409       ldi	Temp, 'I'
000f14 940e 0582  call	PutCharacter
000f16 e504       ldi	Temp, 'T'
000f17 940e 0582  call	PutCharacter
000f19 e504       ldi	Temp, 'T'
000f1a 940e 0582  call	PutCharacter
000f1c 9508       ret
                 
                 Menu_FensSub3:
000f1d e40e       ldi	Temp, 'N'
000f1e e310       ldi	TempH, $30
000f1f 940e 0582  call	PutCharacter
000f21 e409       ldi	Temp, 'I'
000f22 940e 0582  call	PutCharacter
000f24 e405       ldi	Temp, 'E'
000f25 940e 0582  call	PutCharacter
000f27 e404       ldi	Temp, 'D'
000f28 940e 0582  call	PutCharacter
000f2a 9508       ret
                 
                 Menu_FensSub11:
000f2b 9100 0132  lds	Temp, MenuLow
000f2d 700f       andi	Temp, $0F
000f2e 940e 030f  call	DivDez
000f30 2d0c       mov	Temp, Di0
000f31 e310       ldi	TempH, $30
000f32 940e 0582  call	PutCharacter
000f34 e300       ldi	Temp, '0'
000f35 940e 0582  call	PutCharacter
000f37 e30f       ldi	Temp, '?'
000f38 940e 0582  call	PutCharacter
000f3a e40d       ldi	Temp, 'M'
000f3b 940e 0582  call	PutCharacter
000f3d 9508       ret
                 
                 Menu_Reset:
000f3e e502       ldi	Temp, 'R'
000f3f e310       ldi	TempH, $30
000f40 940e 0582  call	PutCharacter
000f42 e405       ldi	Temp, 'E'
000f43 940e 0582  call	PutCharacter
000f45 e503       ldi	Temp, 'S'
000f46 940e 0582  call	PutCharacter
000f48 e30f       ldi	Temp, '?'
000f49 940e 0582  call	PutCharacter
000f4b 9508       ret
                 
                 Menu_ResetSub1:
000f4c e30f       ldi	Temp, '?'
000f4d e110       ldi	TempH, $10
000f4e 940e 0582  call	PutCharacter
000f50 e40f       ldi	Temp, 'O'
000f51 940e 0582  call	PutCharacter
000f53 e40b       ldi	Temp, 'K'
000f54 940e 0582  call	PutCharacter
000f56 e30f       ldi	Temp, '?'
000f57 940e 0582  call	PutCharacter
000f59 940e 05e1  call	Space2ndDisplayBuffer
000f5b 9508       ret
                 
                 Menu_Adapt:
000f5c e401       ldi	Temp, 'A'
000f5d e310       ldi	TempH, $30
000f5e 940e 0582  call	PutCharacter
000f60 e404       ldi	Temp, 'D'
000f61 940e 0582  call	PutCharacter
000f63 e401       ldi	Temp, 'A'
000f64 940e 0582  call	PutCharacter
000f66 e500       ldi	Temp, 'P'
000f67 940e 0582  call	PutCharacter
000f69 9508       ret
                 
                 Menu_AdaptSub1:
000f6a 940e 0219  call	StartMain
000f6c 98f6       cbi	Status0, _MenuOn
000f6d 9508       ret
                 
                 
                 
                 Menu_Urla:
000f6e e505       ldi	Temp, 'U'
000f6f e310       ldi	TempH, $30
000f70 940e 0582  call	PutCharacter
000f72 e502       ldi	Temp, 'R'
000f73 940e 0582  call	PutCharacter
000f75 e40c       ldi	Temp, 'L'
000f76 940e 0582  call	PutCharacter
000f78 e401       ldi	Temp, 'A'
000f79 940e 0582  call	PutCharacter
000f7b 9508       ret
                 
                 Menu_UrlaSub1:
000f7c e505       ldi	Temp, 'U'
000f7d e110       ldi	TempH, $10
000f7e 940e 0582  call	PutCharacter
000f80 e502       ldi	Temp, 'R'
000f81 940e 0582  call	PutCharacter
000f83 e40c       ldi	Temp, 'L'
000f84 940e 0582  call	PutCharacter
000f86 e301       ldi	Temp, '1'
000f87 940e 0582  call	PutCharacter
000f89 940e 05e1  call	Space2ndDisplayBuffer
000f8b 9508       ret
                 
                 Menu_UrlaSub11:
000f8c 9100 013d  lds	Temp, UserSettings1						
000f8e 6004       sbr	Temp, (1<<_Holiday)						;"sbr" activates holiday mode
000f8f 9300 013d  sts	UserSettings1, Temp
000f91 940e 071a  call	SetCase
000f93 ca01       rjmp	_MenuModeOff
                 
                 Menu_UrlaSub2:
000f94 e505       ldi	Temp, 'U'
000f95 e110       ldi	TempH, $10
000f96 940e 0582  call	PutCharacter
000f98 e502       ldi	Temp, 'R'
000f99 940e 0582  call	PutCharacter
000f9b e40c       ldi	Temp, 'L'
000f9c 940e 0582  call	PutCharacter
000f9e e302       ldi	Temp, '2'
000f9f 940e 0582  call	PutCharacter
000fa1 940e 05e1  call	Space2ndDisplayBuffer
000fa3 9508       ret
                 
                 Menu_UrlaSub21:
000fa4 9100 013d  lds	Temp, UserSettings1						
000fa6 6004       sbr	Temp, (1<<_Holiday)						;"sbr" activates holiday mode
000fa7 6008       sbr	Temp, (1<<_2ndHoliday)
000fa8 9300 013d  sts	UserSettings1, Temp
000faa 940e 071a  call	SetCase
000fac c9e8       rjmp	_MenuModeOff
                 
                 
                 Menu_UrlaSub3:
000fad e505       ldi	Temp, 'U'
000fae e110       ldi	TempH, $10
000faf 940e 0582  call	PutCharacter
000fb1 e502       ldi	Temp, 'R'
000fb2 940e 0582  call	PutCharacter
000fb4 e40c       ldi	Temp, 'L'
000fb5 940e 0582  call	PutCharacter
000fb7 e300       ldi	Temp, '0'
000fb8 940e 0582  call	PutCharacter
000fba 940e 05e1  call	Space2ndDisplayBuffer
000fbc 9508       ret
                 
                 Menu_UrlaSub31:
000fbd 9100 013d  lds	Temp, UserSettings1						
000fbf 7f0b       cbr	Temp, (1<<_Holiday)						;"sbr" activates holiday mode
000fc0 7f07       cbr	Temp, (1<<_2ndHoliday)
000fc1 9300 013d  sts	UserSettings1, Temp
000fc3 940e 06ee  call	ClearCase
000fc5 c9cf       rjmp	_MenuModeOff
                 
                 
                  
                 Menu_Vent:
000fc6 e506       ldi	Temp, 'V'
000fc7 e310       ldi	TempH, $30
000fc8 940e 0582  call	PutCharacter
000fca e405       ldi	Temp, 'E'
000fcb 940e 0582  call	PutCharacter
000fcd e40e       ldi	Temp, 'N'
000fce 940e 0582  call	PutCharacter
000fd0 e504       ldi	Temp, 'T'
000fd1 940e 0582  call	PutCharacter
000fd3 9508       ret
                 
                 Menu_VentSub1:
000fd4 e40e       ldi	Temp, 'N'
000fd5 e110       ldi	TempH, $10
000fd6 940e 0582  call	PutCharacter
000fd8 e40f       ldi	Temp, 'O'
000fd9 940e 0582  call	PutCharacter
000fdb e502       ldi	Temp, 'R'
000fdc 940e 0582  call	PutCharacter
000fde e40d       ldi	Temp, 'M'
000fdf 940e 0582  call	PutCharacter
000fe1 940e 05e1  call	Space2ndDisplayBuffer
000fe3 9508       ret
                 
                 Menu_VentSub11:
000fe4 9100 013d  lds	Temp, UserSettings1
000fe6 7f0e       cbr	Temp, (1<<_ValveInverse)
000fe7 9300 013d  sts	UserSettings1, Temp
000fe9 940e 04d6  call	ClearBargraph
000feb 940e 075c  call	ClearHourLegend
000fed c9a7       rjmp	_MenuModeOff
                 
                 Menu_VentSub2:
000fee e409       ldi	Temp, 'I'
000fef e110       ldi	TempH, $10
000ff0 940e 0582  call	PutCharacter
000ff2 e40e       ldi	Temp, 'N'
000ff3 940e 0582  call	PutCharacter
000ff5 e506       ldi	Temp, 'V'
000ff6 940e 0582  call	PutCharacter
000ff8 e405       ldi	Temp, 'E'
000ff9 940e 0582  call	PutCharacter
000ffb 940e 05e1  call	Space2ndDisplayBuffer
000ffd 9508       ret
                 
                 Menu_VentSub21:
000ffe 9100 013d  lds	Temp, UserSettings1
001000 6001       sbr	Temp, (1<<_ValveInverse)
001001 9300 013d  sts	UserSettings1, Temp
001003 940e 04d6  call	ClearBargraph
001005 940e 075c  call	ClearHourLegend
001007 c98d       rjmp	_MenuModeOff
                 
                 
                 
                 
                 Menu_Offs:
001008 e40f       ldi	Temp, 'O'
001009 e310       ldi	TempH, $30
00100a 940e 0582  call	PutCharacter
00100c e406       ldi	Temp, 'F'
00100d 940e 0582  call	PutCharacter
00100f e406       ldi	Temp, 'F'
001010 940e 0582  call	PutCharacter
001012 e503       ldi	Temp, 'S'
001013 940e 0582  call	PutCharacter
001015 9508       ret
                 
                 Menu_OffsSub1:
001016 e20b       ldi	Temp, '+'
001017 e310       ldi	TempH, $30
001018 940e 0582  call	PutCharacter
00101a e300       ldi	Temp, '0'
00101b 940e 0582  call	PutCharacter
00101d e400       ldi	Temp, '@'
00101e 940e 0582  call	PutCharacter
001020 e30f       ldi	Temp, '?'
001021 940e 0582  call	PutCharacter
001023 9508       ret
                 
                 Menu_Debug:
001024 e404       ldi	Temp, 'D'
001025 e310       ldi	TempH, $30
001026 940e 0582  call	PutCharacter
001028 e402       ldi	Temp, 'B'
001029 940e 0582  call	PutCharacter
00102b e505       ldi	Temp, 'U'
00102c 940e 0582  call	PutCharacter
00102e e407       ldi	Temp, 'G'
00102f 940e 0582  call	PutCharacter
001031 9508       ret
                 
                 
                 Menu_Dbg_FW:
001032 e406       ldi	Temp, 'F'
001033 e110       ldi	TempH, $10
001034 940e 0582  call	PutCharacter
001036 e409       ldi	Temp, 'I'
001037 940e 0582  call	PutCharacter
001039 e502       ldi	Temp, 'R'
00103a 940e 0582  call	PutCharacter
00103c e40d       ldi	Temp, 'M'
00103d 940e 0582  call	PutCharacter
                 
00103f e007       ldi	Temp, FW_Version
001040 940e 030f  call	DivDez
                  
001042 e506       ldi	Temp, 'V'
001043 e210       ldi	TempH, $20
001044 940e 0582  call	PutCharacter
001046 2d0e       mov	Temp, Di2
001047 940e 0582  call	PutCharacter
001049 2d0d       mov	Temp, Di1
00104a 940e 0582  call	PutCharacter
00104c 2d0c       mov	Temp, Di0
00104d 940e 0582  call	PutCharacter
00104f 9508       ret
                 
                 Menu_Dbg_1:
001050 e406       ldi	Temp, 'F'
001051 e110       ldi	TempH, $10
001052 940e 0582  call	PutCharacter
001054 e505       ldi	Temp, 'U'
001055 940e 0582  call	PutCharacter
001057 e50a       ldi	Temp, 'Z'
001058 940e 0582  call	PutCharacter
00105a e50a       ldi	Temp, 'Z'
00105b 940e 0582  call	PutCharacter
00105d 9100 0138  lds	Temp, FuzzyVal
00105f 940e 030f  call	DivDez
001061 e30f       ldi	Temp, '?'
001062 e210       ldi	TempH, $20
001063 940e 0582  call	PutCharacter
001065 e30f       ldi	Temp, '?'
001066 940e 0582  call	PutCharacter
001068 2d0d       mov	Temp, Di1
001069 940e 0582  call	PutCharacter
00106b 2d0c       mov	Temp, Di0
00106c 940e 0582  call	PutCharacter
00106e 9508       ret
                 
                 Menu_Dbg_2:
00106f e500       ldi	Temp, 'P'
001070 e110       ldi	TempH, $10
001071 940e 0582  call	PutCharacter
001073 e40f       ldi	Temp, 'O'
001074 940e 0582  call	PutCharacter
001076 e503       ldi	Temp, 'S'
001077 940e 0582  call	PutCharacter
001079 e409       ldi	Temp, 'I'
00107a 940e 0582  call	PutCharacter
00107c 9100 0113  lds	Temp, PositionL
00107e 9110 0114  lds	TempH, PositionH
001080 940e 02ef  call	DivHL
001082 2d0f       mov	Temp, Di3
001083 e210       ldi	TempH, $20
001084 940e 0582  call	PutCharacter
001086 2d0e       mov	Temp, Di2
001087 940e 0582  call	PutCharacter
001089 2d0d       mov	Temp, Di1
00108a 940e 0582  call	PutCharacter
00108c 2d0c       mov	Temp, Di0
00108d 940e 0582  call	PutCharacter
00108f 9508       ret
                 
                 Menu_Dbg_3:
001090 e506       ldi	Temp, 'V'
001091 e110       ldi	TempH, $10
001092 940e 0582  call	PutCharacter
001094 e504       ldi	Temp, 'T'
001095 940e 0582  call	PutCharacter
001097 e40f       ldi	Temp, 'O'
001098 940e 0582  call	PutCharacter
00109a e500       ldi	Temp, 'P'
00109b 940e 0582  call	PutCharacter
00109d 9100 0115  lds	Temp, ValveTopL
00109f 9110 0116  lds	TempH, ValveTopH
0010a1 940e 02ef  call	DivHL
0010a3 2d0f       mov	Temp, Di3
0010a4 e210       ldi	TempH, $20
0010a5 940e 0582  call	PutCharacter
0010a7 2d0e       mov	Temp, Di2
0010a8 940e 0582  call	PutCharacter
0010aa 2d0d       mov	Temp, Di1
0010ab 940e 0582  call	PutCharacter
0010ad 2d0c       mov	Temp, Di0
0010ae 940e 0582  call	PutCharacter
0010b0 9508       ret
                 
                 Menu_Dbg_4:
0010b1 e502       ldi	Temp, 'R'
0010b2 e110       ldi	TempH, $10
0010b3 940e 0582  call	PutCharacter
0010b5 e507       ldi	Temp, 'W'
0010b6 940e 0582  call	PutCharacter
0010b8 e401       ldi	Temp, 'A'
0010b9 940e 0582  call	PutCharacter
0010bb e509       ldi	Temp, 'Y'
0010bc 940e 0582  call	PutCharacter
0010be 9100 012d  lds	Temp, RegWay
0010c0 940e 030f  call	DivDez
0010c2 e30f       ldi	Temp, '?'
0010c3 e210       ldi	TempH, $20
0010c4 940e 0582  call	PutCharacter
0010c6 2d0e       mov	Temp, Di2
0010c7 940e 0582  call	PutCharacter
0010c9 2d0d       mov	Temp, Di1
0010ca 940e 0582  call	PutCharacter
0010cc 2d0c       mov	Temp, Di0
0010cd 940e 0582  call	PutCharacter
0010cf 9508       ret
                 
                 
                 Menu_Dbg_5:
0010d0 e506       ldi	Temp, 'V'
0010d1 e110       ldi	TempH, $10
0010d2 940e 0582  call	PutCharacter
0010d4 e402       ldi	Temp, 'B'
0010d5 940e 0582  call	PutCharacter
0010d7 e401       ldi	Temp, 'A'
0010d8 940e 0582  call	PutCharacter
0010da e504       ldi	Temp, 'T'
0010db 940e 0582  call	PutCharacter
0010dd 9100 0139  lds	Temp, BatteryVoltageL
0010df 9110 013a  lds	TempH,BatteryVoltageH
0010e1 940e 02ef  call	DivHL
0010e3 2d0f       mov	Temp, Di3
0010e4 e210       ldi	TempH, $20
0010e5 940e 0582  call	PutCharacter
0010e7 2d0e       mov	Temp, Di2
0010e8 940e 0582  call	PutCharacter
0010ea 2d0d       mov	Temp, Di1
0010eb 940e 0582  call	PutCharacter
0010ed 2d0c       mov	Temp, Di0
0010ee 940e 0582  call	PutCharacter
0010f0 9508       ret
                 
                 
                 
                 
                 
                 ;------------------------------------------
                 CopyTimerBlock:
0010f1 3800       cpi	Temp, $80
0010f2 f029       breq	_Copy1_5
0010f3 3900       cpi	Temp, $90
0010f4 f039       breq	_Copy1_6
0010f5 3a00       cpi	Temp, $A0
0010f6 f049       breq	_Copy1_7
0010f7 9508       ret
                 
                 _Copy1_5:
0010f8 e085       ldi	Temp3, 5
0010f9 eaad       ldi	XL, low (DailyTimer+63)
0010fa e0b1       ldi	XH, high (DailyTimer+63)
0010fb c007       rjmp	_CTB1
                 
                 _Copy1_6:
0010fc e086       ldi	Temp3, 6
0010fd eba6       ldi	XL, low (DailyTimer+72)
0010fe e0b1       ldi	XH, high (DailyTimer+72)
0010ff c003       rjmp	_CTB1
                 
                 _Copy1_7:
001100 e087       ldi	Temp3, 7
001101 ebaf       ldi	XL, low (DailyTimer+81)
001102 e0b1       ldi	XH, high (DailyTimer+81)
                 
                 _CTB1:
001103 e6ce       ldi	YL, low(DailyTimer)
001104 e0d1       ldi	YH, high(DailyTimer)
                 
                 _CTB2:
001105 e019       ldi	TempH, 9
                 
                 _CTBLoop:
001106 910d       ld		Temp, X+ 
001107 9309       st		Y+, Temp
001108 951a       dec	TempH
001109 f7e1       brne	_CTBLoop
                  
00110a 9719       sbiw	XH:XL, 9
00110b 958a       dec	Temp3
00110c f7c1       brne	_CTB2
00110d 9508       ret
                 
                 
                 .include	"ISR.inc"
                 
                 ;Sound interrupt
                 T0_CMP:
00110e b63f       in		SREG_Save, SREG
00110f 930f       push 	Temp
001110 931f       push 	TempH
                  
001111 9100 0131  lds	Temp, BeepPulseCT
001113 9503       inc	Temp
001114 9300 0131  sts	BeepPulseCT, Temp
001116 3003       cpi	Temp, 3
001117 f040       brcs	_BeepPulse1
001118 f011       breq	_BeepPulseOff
001119 3006       cpi	Temp, 6
00111a f050       brcs	_BeepPulse2
                 
                 _BeepPulseOff:
00111b 986f       cbi	MotorDDR, Motor_Open
00111c 9877       cbi	MotorPort, Motor_Open
00111d 986e       cbi	MotorDDR, Motor_Close
00111e 9876       cbi	MotorPort, Motor_Close
00111f c009       rjmp	_BeepInt1
                  
                 _BeepPulse1:
001120 986e       cbi	MotorDDR, Motor_Close
001121 9876       cbi	MotorPort, Motor_Close
001122 9a6f       sbi	MotorDDR, Motor_Open
001123 9a77       sbi	MotorPort, Motor_Open
001124 c004       rjmp	_BeepInt1
                 
                 _BeepPulse2:
001125 986f       cbi	MotorDDR, Motor_Open
001126 9877       cbi	MotorPort, Motor_Open
001127 9a6e       sbi	MotorDDR, Motor_Close
001128 9a76       sbi	MotorPort, Motor_Close
                 
                 _BeepInt1:
001129 300f       cpi	Temp, 15
00112a f088       brcs	_BeepEnd
                   
00112b 9220 0131  sts	BeepPulseCT, Null
00112d 9100 012f  lds	Temp, BeepCT
00112f 9110 0130  lds	TempH, BeepLen
001131 1701       cp		Temp, TempH
001132 f420       brcc	_BeepOff
001133 9503       inc	Temp
001134 9300 012f  sts	BeepCT, Temp
001136 c005       rjmp	_BeepEnd
                 
                 _BeepOff:
001137 9100 006e  lds	Temp, TIMSK0
001139 7f0d       cbr	Temp, (1<<OCIE0A)
00113a 9300 006e  sts	TIMSK0, Temp
                  
                 _BeepEnd:
00113c 911f       pop	TempH
00113d 910f       pop	Temp
00113e be3f       out	SREG, SREG_Save
00113f 9518       reti
                 
                 
                 
                 
                 ;Reflex coupler pin change interrupt
                 ;--------------------------------------------------
                 PinChange0:
001140 9bf2       sbis	Status0, _MotRun						;execute only if motor hardware is on
001141 9518       reti 
                  
001142 e063       ldi	ActiveCT, 3
                 
001143 b63f       in		SREG_Save, SREG
001144 93af       push 	XL
001145 93bf       push 	XH
                 
001146 9963       sbic	LightSensPin, LightSens_Trans			;count only falling edge
001147 c017       rjmp	_PC0_2
                 
001148 9bf3       sbis	Status0, _Adapt
001149 c009       rjmp	_PC0_1
                  
00114a 91a0 0113  lds	XL, PositionL							;decrement Reflex counter down to 0
00114c 91b0 0114  lds	XH, PositionH
00114e 9611       adiw	XH:XL, 1
00114f 93a0 0113  sts	PositionL, XL
001151 93b0 0114  sts	PositionH, XH
                 
                 _PC0_1:
001153 91a0 0111  lds	XL, RFLXCTL								;decrement Reflex counter down to 0
001155 91b0 0112  lds	XH, RFLXCTH
001157 30a0       cpi	XL, 0
001158 05b2       cpc	XH, Null
001159 f029       breq	_PC0_2
00115a 9711       sbiw	XH:XL, 1
00115b 93a0 0111  sts	RFLXCTL, XL
00115d 93b0 0112  sts	RFLXCTH, XH
                 
                 _PC0_2:
00115f 91a0 0117  lds	XL, MotTimeOut
001161 7ca0       andi	XL, 0b11000000							;clear motor timeout counter
001162 93a0 0117  sts	MotTimeOut, XL
                  
001164 91bf       pop	XH
001165 91af       pop	XL
001166 be3f       out	SREG, SREG_Save
001167 9518       reti
                 
                 
                 ;save current RTC to EEPROM
                 ;--------------------------------------------------
                 RapidShutOff:
001168 9875       cbi	PORTE, 5										;disable pullup on test pin
001169 982f       cbi	PortB, 7										;disable Pullups on rotary encoder
00116a 9828       cbi	PortB, 0
                  
00116b 9220 007a  sts	ADCSRA, Null									;disable ADC
                 
00116d 986e       cbi	MotorDDR, Motor_Close
00116e 9876       cbi	MotorPort, Motor_Close
00116f 986f       cbi	MotorDDR, Motor_Open
001170 9877       cbi	MotorPort, Motor_Open
001171 9872       cbi	LightSensPort, LightSens_LED					;disable reflex coupler
                  
001172 940e 01cf  call	Store_Time
001174 940e 04f3  call	Clear_Screen
                 
001176 e40f       ldi	Temp, 'O'
001177 e310       ldi	TempH, $30	
001178 940e 0582  call	PutCharacter
00117a e406       ldi	Temp, 'F'
00117b 940e 0582  call	PutCharacter
00117d e406       ldi	Temp, 'F'
00117e 940e 0582  call	PutCharacter
001180 e30f       ldi	Temp, '?'					 
001181 940e 0582  call	PutCharacter
001183 940e 05eb  call	Copy_DisplayBuffers 
                  
001185 e007       ldi	Temp, (1<<SM1) | (1<<SM0) | (1<<SE)	;Power save sleep mode
001186 bf03       out	SMCR, Temp
                 
001187 9588       sleep
                 
                 OffLoop:
001188 cfff       rjmp	OffLoop
                 
                 
                 
                 ;Buttons pin change interrupt
                 ;--------------------------------------------------
                 PinChange1:
001189 b63f       in		SREG_SAVE, SREG
00118a 930f       push	Temp
00118b 931f       push	TempH
                 
00118c 991b       sbic	IO_PIN, IO_SCK									;if IO clock is low, initiate data read
00118d c014       rjmp	_PC1_1
                   
00118e 9488       clc
00118f 991a       sbic	IO_PIN, IO_SDATA					;if data pin is high, rotate a logical "1"
001190 9408       sec										
001191 9100 010a  lds	Temp, IO_Data
001193 9507       ror	Temp								;assemble bits
001194 9300 010a  sts	IO_Data, Temp
001196 9110 0108  lds	TempH, IO_BitCT
001198 9513       inc	TempH
001199 9310 0108  sts	IO_BitCT, TempH
00119b 7017       andi	TempH, 0b00000111
00119c f429       brne	_PC1_1
                  
00119d 9300 010b  sts	IO_DataBuffer, Temp
00119f b50a       in		Temp, Status1
0011a0 6001       sbr	Temp, (1<<_IO_Receive)
0011a1 bd0a       out	Status1, Temp
                  
                 _PC1_1:
0011a2 ec08       ldi	Temp, (1<<LCDEN) | (1<<LCDIE) | (1<<LCDAB)		;enable LCD-Frame Interrupt
0011a3 9300 00e4  sts	LCDCRA, Temp
0011a5 e063       ldi	ActiveCT, 3
0011a6 940e 093a  call	ReadRotary
                  
0011a8 911f       pop	TempH
0011a9 910f       pop	Temp
0011aa be3f       out	SREG, SREG_SAVE
0011ab 9518       reti
                 
                 
                 ;LCD-controller frame Interrupt
                 ;--------------------------------------------------
                 LCD_FrameInt:
0011ac b63f       in		SREG_SAVE, SREG
0011ad 930f       push	Temp
0011ae 931f       push	TempH
                 
0011af b103       in		Temp, PinB
0011b0 9500       com	Temp
0011b1 7f01       andi	Temp, 0b11110001			;mask used pins and swap nibbles, put all button pins together -> 000bbbbb
0011b2 9502       swap	Temp
0011b3 7007       andi	Temp, 0b00000111			;mask buttons
0011b4 3000       cpi	Temp, 0						;if no button is pressed, clear button value and debounce counter
0011b5 f079       breq	_NoButton
                  
0011b6 9110 010e  lds	TempH, OldButtons
0011b8 9300 010e  sts	OldButtons,	Temp
0011ba 1301       cpse	Temp, TempH
0011bb c00c       rjmp	_LCDFInt1
                 
                 _ButtonEqual:
0011bc 3f3f       cpi	ButtonDebounce, 0xFF
0011bd f051       breq	_LCDFInt1
0011be 9533       inc	ButtonDebounce
0011bf 3035       cpi	ButtonDebounce, 5
0011c0 f439       brne	_LCDFInt1
                 
0011c1 9300 010d  sts	Buttons, Temp 
0011c3 9af4       sbi	Status0, _NewButton
0011c4 c003       rjmp	_LCDFInt1
                 
                 _NoButton:
0011c5 2733       clr	ButtonDebounce	
0011c6 9220 010e  sts	OldButtons, Null
                  
                 _LCDFInt1: 
0011c8 9100 0117  lds	Temp, MotTimeout								;increment motor timeout counter each LCD frame
0011ca 730f       andi	Temp, $3F
0011cb 330f       cpi	Temp, $3F
0011cc f029       breq	_LCDF_E
0011cd 9100 0117  lds	Temp, MotTimeout
0011cf 9503       inc	Temp
0011d0 9300 0117  sts	MotTimeOut, Temp
                   
                 _LCDF_E:
0011d2 911f       pop	TempH
0011d3 910f       pop	Temp
0011d4 be3f       out	SREG, SREG_SAVE
0011d5 9518       reti
                  
                 
                 
                 ;--------------------------------------------------
                 SystemTime:
0011d6 b63f       in		SREG_SAVE, SREG
0011d7 930f       push 	Temp
0011d8 931f       push	TempH
0011d9 938f       push 	Temp3
                 
0011da 9100 0134  lds	Temp, DispTimer
0011dc 9503       inc	Temp
0011dd 7003       andi	Temp, 0b00000011
0011de 9300 0134  sts	DispTimer, Temp
0011e0 f479       brne	_SysT1
                 
0011e1 9100 012e  lds	Temp, DisplayCT							;used for alternating display content, seconds timing
0011e3 9503       inc	Temp
0011e4 9300 012e  sts	DisplayCT, Temp
0011e6 9100 0125  lds	Temp, UserDisplay
0011e8 2300       tst	Temp
0011e9 f031       breq	_SysT1 
0011ea 950a       dec	Temp
0011eb 9300 0125  sts	UserDisplay, Temp
0011ed f411       brne	_SysT1 
0011ee 9220 012e  sts	DisplayCT, Null
                  
                 _SysT1:
0011f0 99f3       sbic	Status0, _Adapt
0011f1 c00e       rjmp	_Sys_T11
                 
0011f2 9100 013d  lds	Temp, UserSettings1						;if external sensor is used, start I/O-Routine
0011f4 ff01       sbrs	Temp, _ExternalTempSensor
0011f5 c00a       rjmp	_Sys_T11
                 
0011f6 9100 013c  lds	Temp, Radio_RXTimeslot
0011f8 3000       cpi	Temp, 0
0011f9 f031       breq	_Sys_T11
                  
0011fa 950a       dec	Temp
0011fb 9300 013c  sts	Radio_RXTimeslot, Temp
0011fd f411       brne	_Sys_T11
                 
0011fe 940e 00f7  call	Start_IO								;wake up external RFM tray
                 
                 _Sys_T11:
001200 9100 0128  lds	Temp, PSC1
001202 9473       inc	Prescaler1
001203 1670       cp		Prescaler1, Temp
001204 f009       breq	_SysTSeconds
001205 c01d       rjmp	_SysTE
                   
                 _SysTSeconds:									;1s timer
                  ;sbi	DebugPort, Debug1
                  
001206 2477       clr	Prescaler1
001207 e004       ldi	Temp, 4									;restore prescaler interval after time adjustment
001208 9300 0128  sts	PSC1, Temp
00120a b50a       in 	Temp, Status1
00120b 6800       sbr	Temp, (1<<_SecondTick)
00120c bd0a       out	Status1, Temp
                 
00120d 99f3       sbic	Status0, _Adapt
00120e c00c       rjmp	_SysT2
                  
00120f 9100 011d  lds	Temp, ADCPrescaler
001211 950a       dec	Temp
001212 9300 011d  sts	ADCPrescaler, Temp
001214 f431       brne	_SysT2
                 
001215 eb04       ldi	Temp, 180									;3 Minutes measure interval
001216 9300 011d  sts	ADCPrescaler, Temp
                 
001218 b50a       in 	Temp, Status1
001219 6100       sbr 	Temp, (1<<_NewTemp)
00121a bd0a       out	Status1, Temp
                 
                   
                 _SysT2: 
00121b 3060       cpi	ActiveCT, 0
00121c f031       breq	_SysTE
00121d 956a       dec	ActiveCT
00121e f421       brne	_SysTE
                 
00121f ec00       ldi	Temp, (1<<LCDEN) | (0<<LCDIE)| (1<<LCDAB)	;Disable LCD-Frame-ISR
001220 9300 00e4  sts	LCDCRA, Temp
001222 9875       cbi	BacklightPort, Backlight_On
                  
                  ;cbi	DebugPort, Debug2
                 
                 
                 _SysTE:
                  ;cbi	DebugPort, Debug1
                  ;cbi	DebugPort, Debug2
001223 918f       pop	Temp3
001224 911f       pop	TempH
001225 910f       pop	Temp
001226 be3f       out	SREG, SREG_SAVE
001227 9518       reti
                 
                 
                 .include	"ADC.inc"
                 
                 Measure_Battery_Voltage:
001228 e50e       ldi	Temp, 0b01011110				;AVcc as reference, internal bandgap as source
001229 9300 007c  sts	ADMUX, Temp
                 
00122b 0000       nop
00122c 0000       nop
00122d 0000       nop
00122e ec04       ldi	Temp, 0b11000100				;ADC enable, start ADC conversion, ADC Prescaler 16
00122f 9300 007a  sts	ADCSRA, Temp
                 
                 _Wait_VBat_ADC1:
001231 9100 007a  lds	Temp, ADCSRA					
001233 fd06       sbrc	Temp, ADSC
001234 cffc       rjmp	_Wait_VBat_ADC1
                 
001235 e004       ldi	Temp, 0b00000100				;ADC disable, ADC Prescaler 16
001236 9300 007a  sts	ADCSRA, Temp
                  
001238 9100 0078  lds	Temp, ADCL
00123a 9110 0079  lds	TempH, ADCH
00123c 9300 0139  sts	BatteryVoltageL, Temp
00123e 9310 013a  sts	BatteryVoltageH, TempH
                  
001240 e082       ldi	Temp3, high(530)
001241 3102       cpi	Temp, low (530)
001242 0718       cpc	TempH, Temp3
001243 f068       brcs	_MBV1
                 
001244 e809       ldi	Temp, LCD_Battery_SET
001245 e110       ldi	TempH, $10
001246 940e 0606  call	PutSymbol
                  
001248 9100 0139  lds	Temp, BatteryVoltageL
00124a 9110 013a  lds	TempH, BatteryVoltageH
00124c e082       ldi	Temp3, high(560)
00124d 3300       cpi	Temp, low (560)
00124e 0718       cpc	TempH, Temp3
00124f f008       brcs	_MBV1
                   
001250 cf17       rjmp	RapidShutOff 
                 
                 _MBV1:
001251 9508       ret
                 
                 
                 
                 ;--------------------------------------
                 Measure_Motor_Current:
001252 e402       ldi	Temp, 0b01000010				;AVcc as reference, channel 2, motor current
001253 9300 007c  sts	ADMUX, Temp
001255 0000       nop
001256 0000       nop
001257 0000       nop
001258 ec04       ldi	Temp, 0b11000100				;ADC enable, start ADC conversion, ADC Prescaler 16
001259 9300 007a  sts	ADCSRA, Temp
                 
                 _Wait_MCur_ADC1:
00125b 9100 007a  lds	Temp, ADCSRA					
00125d fd06       sbrc	Temp, ADSC
00125e cffc       rjmp	_Wait_MCur_ADC1
                 
00125f e004       ldi	Temp, 0b00000100				;ADC disable, ADC Prescaler 16
001260 9300 007a  sts	ADCSRA, Temp
                 
001262 9100 0078  lds	Temp, ADCL
001264 9110 0079  lds	TempH, ADCH
001266 ef8f       ldi	Temp3, $FF
001267 e093       ldi	Temp4, $03
001268 1b80       sub	Temp3, Temp
001269 0b91       sbc	Temp4, TempH
00126a 9380 0119  sts	MotorCurrent, Temp3
00126c 9508       ret
                 
                 .include	"RTC.inc"
                 
                 ;RealTimeClock timer, automatic DST switch
                 ;--------------------------------------------------
                 Clock:
00126d b50a       in 	Temp, Status1
00126e ff07       sbrs	Temp, _SecondTick 			;execute only ,if prescaler1 is 0
00126f 9508       ret
                  
001270 94f8       cli
001271 b50a       in 	Temp, Status1
001272 770f       cbr	Temp, (1<<_SecondTick)
001273 bd0a       out	Status1, Temp
001274 9478       sei
                 
                 _ClockSeconds:  
001275 9100 011e  lds	Temp, Seconds
001277 9503       inc	Temp
001278 9300 011e  sts	Seconds, Temp
00127a 330c       cpi	Temp, 60
00127b f009       breq	_ClockSec1
00127c c082       rjmp	_ClockEnd		
                 
                 _ClockSec1:
00127d 9220 011e  sts	Seconds, Null
00127f 9100 011f  lds	Temp, Minutes
001281 9503       inc	Temp
001282 9300 011f  sts	Minutes, Temp
                 
                 ;------------------------------
                 ;fine tune for inaccurate crystals
                 
                 /* lds	Temp, TimeAdjust
                  dec	Temp
                  sts	TimeAdjust, Temp
                  brne	_Clock1
                  ldi	Temp, 5
                  sts	PSC1, Temp					;adjust value for prescaler1 interval (default 4)
                  ldi	Temp, 35					;TimeAdjust interval counter
                  sts	TimeAdjust, Temp*/
                 
                 ;-------------------------------
                 
                 _Clock1:
                  ;lds	Temp, WinOpCDMin			;decrement open windows counter, if zero, resume to normal mode
                  ;cpi	Temp, 0
                  ;breq	_ClockMinutes
                  ;dec	Temp
                  ;sts	WinOpCDMin, Temp
                  ;brne	_ClockMinutes
                  ;lds	Temp, TempMode
                  ;cbr	Temp, (1<<1)
                  ;sts	TempMode, Temp
                  ;call	_WindowClosed
                 
                 _ClockMinutes:
001284 9100 011f  lds	Temp, Minutes
001286 330c       cpi	Temp, 60
001287 f009       breq	_ClockMin1
001288 c076       rjmp	_ClockEnd
                 
                 _ClockMin1:
001289 9220 011f  sts	Minutes, Null
00128b 9100 0120  lds	Temp, Hours
00128d 9503       inc	Temp
00128e 9300 0120  sts	Hours, Temp
                 
001290 9100 0124  lds	Temp, WDays					;Friday 11:00:00
001292 3004       cpi	Temp, 4
001293 f449       brne	_ClockMin2
001294 9100 0120  lds	Temp, Hours
001296 300b       cpi	Temp, 11
001297 f429       brne	_ClockMin2
001298 94f8       cli
001299 b50a       in		Temp, Status1				;start Descale function
00129a 6004       sbr	Temp, (1<<_Descale)
00129b bd0a       out	Status1, Temp
00129c 9478       sei
                 
                 _ClockMin2:
00129d b50a       in		Temp, Status1
00129e fd03       sbrc	Temp, _DST_OnOff			;if DST toggle has already done, skip DST check
00129f c023       rjmp	_ClockHours
                 
0012a0 9100 0121  lds	Temp, Days					;last week on month?
0012a2 3108       cpi	Temp, 24
0012a3 f0f8       brcs	_ClockHours
                 
0012a4 9100 0124  lds	Temp, WDays					;last sunday on month?
0012a6 3006       cpi	Temp, 6
0012a7 f4d9       brne	_ClockHours
                 
0012a8 9100 0122  lds	Temp, Months
0012aa 3009       cpi	Temp, 9						;Oktober?
0012ab f019       breq	_Summer_Winter
0012ac 3002       cpi	Temp, 2						;March?
0012ad f049       breq	_Winter_Summer
0012ae c014       rjmp	_ClockHours
                 
                 _Summer_Winter:
0012af 9100 0120  lds	Temp, Hours
0012b1 3003       cpi	Temp, 3
0012b2 f481       brne	_ClockHours
                 
0012b3 950a       dec	Temp
0012b4 9300 0120  sts	Hours, Temp
0012b6 c007       rjmp	_SetDST
                 
                 _Winter_Summer:
0012b7 9100 0120  lds	Temp, Hours
0012b9 3002       cpi	Temp, 2
0012ba f441       brne	_ClockHours
                 
0012bb 9503       inc	Temp
0012bc 9300 0120  sts	Hours, Temp
                 
                 _SetDST:
0012be 94f8       cli
0012bf b50a       in		Temp, Status1
0012c0 6008       sbr	Temp, (1<<_DST_OnOff)
0012c1 bd0a       out	Status1, Temp
0012c2 9478       sei
                 
                 _ClockHours:
0012c3 9100 0120  lds	Temp, Hours
0012c5 3108       cpi	Temp, 24
0012c6 f009       breq	_ClockHour1
0012c7 c037       rjmp	_ClockEnd
                 
                 _ClockHour1:
0012c8 94f8       cli
0012c9 b50a       in		Temp, Status1
0012ca 7f07       cbr	Temp, (1<<_DST_onoff)
0012cb bd0a       out	Status1, Temp
0012cc 9478       sei
                 
0012cd 9220 0120  sts	Hours, Null
0012cf 9100 0121  lds	Temp, Days
0012d1 9503       inc	Temp
0012d2 9300 0121  sts	Days, Temp
                 
0012d4 9100 0124  lds	Temp, WDays
0012d6 9503       inc	Temp
0012d7 9300 0124  sts	WDays, Temp
0012d9 3007       cpi	Temp, 7
0012da f419       brne	_ClockDays
0012db 2700       clr	Temp
0012dc 9300 0124  sts	WDays, Temp
                 
                 _ClockDays:
0012de 6800       ori	Temp, $80
0012df 940e 06b8  call	ClearWeekDays
0012e1 e310       ldi	TempH, $30
0012e2 940e 0601  call	PutWeekDay 
                 
0012e4 b50a       in		Temp, Status1
0012e5 ff01       sbrs	Temp, _AutoManu
0012e6 940e 0463  call	Show_DailyBargraph
                  
0012e8 d04c       rcall	MonthLastDay
                 
                 _ClockDay1:
0012e9 9100 0121  lds	Temp, Days
0012eb 1701       cp 	Temp, TempH
0012ec f491       brne	_ClockEnd
                 
0012ed 9220 0121  sts	Days, Null
0012ef 9100 0122  lds	Temp, Months
0012f1 9503       inc	Temp
0012f2 9300 0122  sts	Months, Temp
                 
                 _ClockMonths:
0012f4 9100 0122  lds	Temp, Months
0012f6 300c       cpi	Temp, 12
0012f7 f439       brne	_ClockEnd
                 
0012f8 9220 0122  sts	Months, Null
0012fa 9100 0123  lds	Temp, Years
0012fc 9503       inc	Temp
0012fd 9300 0123  sts	Years, Temp
                 
                 _ClockEnd:
0012ff b50a       in		Temp, Status1
001300 ff02       sbrs	Temp, _Descale
001301 c00a       rjmp	_ClockEnd1
                 
001302 99f3       sbic	Status0, _Adapt
001303 c008       rjmp	_ClockEnd1
                  
001304 940e 0684  call	ClearColon
001306 940e 069a  call	ClearPoint
001308 940e 04d6  call	ClearBargraph
00130a 940e 0219  call	StartMain
                 
                 
                 _ClockEnd1:
00130c 9508       ret
                 
                 
                 ;--------------------------------------------------------------------------------------------------
                 ;w=(d+MonthGauss+y+(y/4)+(c/4)+5*c) mod7 // Sunday=0...Saturday=6
                 ;d=1..31 // y=Year ..nn // c= Year nn..
                 ;Jan. + Feb. -> y=y-1
                 CalcDayOfWeek:
00130d 9100 0122  lds	Temp, Months
00130f e8ea       ldi	ZL, low(MonthGauss*2)
001310 e2f6       ldi	ZH, high(MonthGauss*2)
001311 0fe0       add	ZL, Temp
001312 1df2       adc	ZH, Null
001313 90c0 0121  lds	Di0, Days
001315 94c3       inc	Di0
001316 90d4       lpm	Di1, Z					;load month value
001317 90e0 0123  lds	Di2, Years
001319 9100 0122  lds	Temp, Months			;if months are 0 or 1 (January or February), decrement y
00131b 3002       cpi	Temp, 2
00131c f408       brcc	_CDOW1
00131d 94ea       dec	Di2
                  
                 _CDOW1:
00131e 0ccd       add	Di0, Di1				;add GaussMonths
00131f 0cce       add	Di0, Di2 				;add Year
001320 94e6       lsr	Di2						;y/4
001321 94e6       lsr	Di2
001322 e104       ldi	Temp, 20
001323 9506       lsr	Temp					;c/4
001324 9506       lsr	Temp
                  
001325 0cce       add	Di0, Di2
001326 0ec0       add	Di0, Temp
001327 e604       ldi	Temp, 100				;c*5
001328 0ec0       add	Di0, Temp
                 
001329 e007       ldi	Temp, 7
                 
                 _CDOWLoop:
00132a 16c0       cp 	Di0, Temp				;modulo 7
00132b f010       brcs	_CDOW_End
00132c 1ac0       sub	Di0, Temp
00132d cffc       rjmp	_CDOWLoop
                  
                 _CDOW_End:
00132e 2d0c       mov	Temp, Di0
00132f 5001       subi	Temp, 1						
001330 f408       brcc	_CDOW_End1
001331 e006       ldi	Temp, 6
                 
                 _CDOW_End1: 
001332 9300 0124  sts	WDays, Temp
001334 9508       ret
                 
                 
                 ;--------------------------------------------------------------------------------
                 ;check for last Day of a month
                 ;input: none / output: TempH, last day in a month
                 MonthLastDay:
001335 9100 0122  lds	Temp, Months
001337 e9e6       ldi	ZL, low(MonthDayNo*2)
001338 e2f6       ldi	ZH, high(MonthDayNo*2)
001339 0fe0       add	ZL, Temp
00133a 9114       lpm 	TempH, Z
                  
00133b 9100 0123  lds	Temp, Years
00133d 7003       andi	Temp, 0b00000011			;check for leap year
00133e f429       brne	_MLD1
00133f 9100 0122  lds	Temp, Months
001341 3001       cpi	Temp, 1						;if month is february, add 1 day
001342 f409       brne	_MLD1
001343 9513       inc	TempH
                 
                 _MLD1:
001344 9508       ret
                 
                 
                 
                 
                 MonthGauss:
001345 1f1c
001346 0502
001347 0a07
001348 0f0c
001349 1412
00134a 1917      .db 28,31,2,5,7,10,12,15,18,20,23,25
                 ;,Januar,Februar,Mrz,April,Mai,Juni,Juli,August,September,Oktober,November,Dezember
                 
                 MonthDayNo:
00134b 1c1f
00134c 1e1f
00134d 1e1f
00134e 1f1f
00134f 1f1e
001350 1f1e      .db 31,28,31,30,31,30,31,31,30,31,30,31
                 
                 
                 
                 
                 
                 
                 
                 
                 
                 NTCIntTable:
001351 852a      .dw	34090		;  0C
001352 66c6      .dw	26310		;  5C
001353 4fd8      .dw 20440		; 10C
001354 3e80      .dw	16000		; 15C
001355 3142      .dw	12610		; 20C
001356 2710      .dw	10000		; 25C
001357 1f2d      .dw	 7981		; 30C
001358 1908      .dw	 6408		; 35C
001359 1436      .dw	 5174		; 40C
00135a 106a      .dw	 4202		; 45C
00135b 0d67      .dw	 3431		; 50C
00135c 0b00      .dw	 2816		; 55C
00135d 0912      .dw  2322		; 60C
00135e 0785      .dw	 1925		; 65C
00135f 0643      .dw	 1603		; 70C
001360 053c      .dw	 1340		; 75C
001361 0466      .dw	 1126		; 80C
001362 03b5      .dw	  949		; 85C
001363 0324      .dw	  804		; 90C
001364 02ac      .dw	  684		; 95C
001365 0000      .dw	  	0
                 
                 
                 
                 
                 
                 
                 MenuTable:
001366 0000      .db $00, $00				;MODE   
001367 1000      	.db	$00, $10			;MANU   
001368 1100      		.db	$00, $11		;MEnt	
001369 2000      	.db $00, $20			;AUTO  
00136a 2100      		.db $00, $21		;AEnt	
00136b 0001      .db $01, $00				;PROG	
00136c 1001      	.db	$01, $10 			;TAG1	
00136d 1101      		.db	$01, $11		
00136e 1201      		.db	$01, $12		
00136f 1301      		.db	$01, $13		
001370 1401      		.db	$01, $14		
001371 1501      		.db	$01, $15
001372 1601      		.db	$01, $16		
001373 1701      		.db	$01, $17		
001374 1801      		.db	$01, $18		
001375 1901      		.db	$01, $19		
001376 2001      	.db	$01, $20			;TAG2	 
001377 2101      		.db	$01, $21		
001378 2201      		.db	$01, $22		
001379 2301      		.db	$01, $23		
00137a 2401      		.db	$01, $24		
00137b 2501      		.db	$01, $25
00137c 2601      		.db	$01, $26		
00137d 2701      		.db	$01, $27		
00137e 2801      		.db	$01, $28		
00137f 2901      		.db	$01, $29		 
001380 3001      	.db	$01, $30			;TAG3	
001381 3101      		.db	$01, $31		
001382 3201      		.db	$01, $32		
001383 3301      		.db	$01, $33		
001384 3401      		.db	$01, $34		
001385 3501      		.db	$01, $35
001386 3601      		.db	$01, $36		
001387 3701      		.db	$01, $37		
001388 3801      		.db	$01, $38		
001389 3901      		.db	$01, $39		 
00138a 4001      	.db	$01, $40			;TAG4 
00138b 4101      		.db	$01, $41		
00138c 4201      		.db	$01, $42		
00138d 4301      		.db	$01, $43		
00138e 4401      		.db	$01, $44		
00138f 4501      		.db	$01, $45
001390 4601      		.db	$01, $46		
001391 4701      		.db	$01, $47		
001392 4801      		.db	$01, $48		
001393 4901      		.db	$01, $49
001394 5001      	.db	$01, $50			;TAG5 
001395 5101      		.db	$01, $51		
001396 5201      		.db	$01, $52		
001397 5301      		.db	$01, $53		
001398 5401      		.db	$01, $54		
001399 5501      		.db	$01, $55
00139a 5601      		.db	$01, $56		
00139b 5701      		.db	$01, $57		
00139c 5801      		.db	$01, $58		
00139d 5901      		.db	$01, $59
00139e 6001      	.db	$01, $60			;TAG6
00139f 6101      		.db	$01, $61		
0013a0 6201      		.db	$01, $62		
0013a1 6301      		.db	$01, $63		
0013a2 6401      		.db	$01, $64		
0013a3 6501      		.db	$01, $65
0013a4 6601      		.db	$01, $66		
0013a5 6701      		.db	$01, $67		
0013a6 6801      		.db	$01, $68		
0013a7 6901      		.db	$01, $69		
0013a8 7001      	.db	$01, $70			;TAG7	
0013a9 7101      		.db	$01, $71		
0013aa 7201      		.db	$01, $72		
0013ab 7301      		.db	$01, $73		
0013ac 7401      		.db	$01, $74		
0013ad 7501      		.db	$01, $75
0013ae 7601      		.db	$01, $76		
0013af 7701      		.db	$01, $77		
0013b0 7801      		.db	$01, $78		
0013b1 7901      		.db	$01, $79		
0013b2 8001      	.db $01, $80			;T1-5	
0013b3 8101      		.db	$01, $81		
0013b4 8201      		.db	$01, $82		
0013b5 8301      		.db	$01, $83		
0013b6 8401      		.db	$01, $84		
0013b7 8501      		.db	$01, $85
0013b8 8601      		.db	$01, $86		
0013b9 8701      		.db	$01, $87		
0013ba 8801      		.db	$01, $88		
0013bb 8901      		.db	$01, $89		
0013bc 9001      	.db	$01, $90			;T1-6
0013bd 9101      		.db	$01, $91		
0013be 9201      		.db	$01, $92		
0013bf 9301      		.db	$01, $93		
0013c0 9401      		.db	$01, $94		
0013c1 9501      		.db	$01, $95
0013c2 9601      		.db	$01, $96		
0013c3 9701      		.db	$01, $97		
0013c4 9801      		.db	$01, $98		
0013c5 9901      		.db	$01, $99	
0013c6 a001      	.db	$01, $A0			;T1-7
0013c7 a101      		.db	$01, $A1		
0013c8 a201      		.db	$01, $A2		
0013c9 a301      		.db	$01, $A3		
0013ca a401      		.db	$01, $A4		
0013cb a501      		.db	$01, $A5
0013cc a601      		.db	$01, $A6		
0013cd a701      		.db	$01, $A7		
0013ce a801      		.db	$01, $A8		
0013cf a901      		.db	$01, $A9	
0013d0 b001      	.db	$01, $B0			;Urlaub/Ferien
0013d1 b101      		.db	$01, $B1		
0013d2 b201      		.db	$01, $B2		
0013d3 b301      		.db	$01, $B3		
0013d4 b401      		.db	$01, $B4		
0013d5 b501      		.db	$01, $B5
0013d6 b601      		.db	$01, $B6		
0013d7 b701      		.db	$01, $B7		
0013d8 b801      		.db	$01, $B8		
0013d9 b901      		.db	$01, $B9		
0013da 0002      .db $02, $00				;TEMP	
0013db 1002      	.db	$02, $10			;onTemp 	
0013dc 2002      	.db	$02, $20			;offTemp	
0013dd 3002      	.db	$02, $30			;NightTemp
0013de 0003      .db $03, $00				;ZEIT	 
0013df 1003      	.db	$03, $10			;set year		 
0013e0 2003      	.db	$03, $20			;set month		 
0013e1 3003      	.db	$03, $30			;set date		 
0013e2 4003      	.db	$03, $40			;set hour		 
0013e3 5003      	.db	$03, $50			;set minute		 
0013e4 0004      .db $04, $00				;FENS			 
0013e5 1004      	.db	$04, $10			;HOCH			 
0013e6 1104      		.db $04, $11		;time resume	 
0013e7 2004      	.db	$04, $20			;MITT			 
0013e8 2104      		.db $04, $21		;time resume	 
0013e9 3004      	.db	$04, $30			;NIED			 
0013ea 3104      		.db $04, $31		;time resume	 
0013eb 0005      .db  $05, $00				;RESET			 
0013ec 1005      	.db	 $05, $10			;OK				 
0013ed 0006      .db $06, $00				;ADAP			 
0013ee 1006      	.db	$06, $10			;ADAP			 
0013ef 0007      .db $07, $00				;URLA			 
0013f0 1007      	.db	$07, $10			;set holiday 1	 
0013f1 1107      		.db 0x07, 0x11
0013f2 2007      	.db	$07, $20			;set holiday 2		 
0013f3 2107      		.db 0x07, 0x21
0013f4 3007      	.db	$07, $30			;set holiday off	 
0013f5 3107      		.db 0x07, 0x31
0013f6 0008      .db $08, $00				;INST			 
0013f7 1008      	.db	$08, $10			;NOR			 
0013f8 1108      		.db	$08, $11		;NorEnt
0013f9 2008      	.db	$08, $20			;INV			 
0013fa 2108      		.db	$08, $21		;InvEnt
0013fb 0009      .db $09, $00				;OFFS			 
0013fc 1009      	.db	$09, $10			;set temp		 
0013fd 000a      .db $0A, $00				;DBUG			 
0013fe 100a      	.db	$0A, $10			;FW				 
0013ff 200a      	.db	$0A, $20			;Fuzz			 
001400 300a      	.db	$0A, $30			;Olim			 
001401 400a      	.db	$0A, $40			;VTop
001402 500a      	.db	$0A, $50			;RWay
001403 600a      	.db	0x0A, 0x60			;VBAT
                 
001404 ffff      .db $FF, $FF				;menu end
                 
                 
                 


RESOURCE USE INFORMATION
------------------------

Notice:
The register and instruction counts are symbol table hit counts,
and hence implicitly used resources are not counted, eg, the
'lpm' instruction without operands implicitly uses r0 and z,
none of which are counted.

x,y,z are separate entities in the symbol table and are
counted separately from r26..r31 here.

.dseg memory usage only counts static data declared with .byte

"ATmega169PA" register use summary:
r0 :  16 r1 :   9 r2 :  95 r3 :  10 r4 :   0 r5 :   0 r6 :   0 r7 :   4 
r8 :   5 r9 :   3 r10:   0 r11:   0 r12: 102 r13:  64 r14:  41 r15:  17 
r16:1432 r17: 412 r18:   7 r19:   4 r20:   3 r21:  16 r22:   8 r23:   0 
r24: 173 r25:  68 r26:  85 r27:  83 r28:   2 r29:   2 r30:  27 r31:  26 
x  :  40 y  :   2 z  :  12 
Registers used: 29 out of 35 (82.9%)

"ATmega169PA" instruction use summary:
.lds  :   0 .sts  :   0 adc   :  23 add   :  44 adiw  :   9 and   :   2 
andi  : 101 asr   :   0 bclr  :   0 bld   :   0 brbc  :   0 brbs  :   0 
brcc  :  21 brcs  :  29 break :   0 breq  : 123 brge  :   0 brhc  :   0 
brhs  :   0 brid  :   0 brie  :   0 brlo  :   9 brlt  :   1 brmi  :   2 
brne  :  76 brpl  :   2 brsh  :   0 brtc  :   0 brts  :   2 brvc  :   0 
brvs  :   0 bset  :   0 bst   :   2 call  : 220 cbi   :  52 cbr   :  17 
clc   :   1 clh   :   0 cli   :  12 cln   :   0 clr   :  34 cls   :   0 
clt   :   0 clv   :   0 clz   :   0 com   :   5 cp    :  34 cpc   :  29 
cpi   : 175 cpse  :   1 dec   :  34 eor   :   0 fmul  :   0 fmuls :   0 
fmulsu:   0 icall :   0 ijmp  :   2 in    :  45 inc   :  62 jmp   :  24 
ld    :  28 ldd   :   0 ldi   : 653 lds   : 306 lpm   :  15 lsl   :   4 
lsr   :  14 mov   : 104 movw  :   5 mul   :  16 muls  :   0 mulsu :   0 
neg   :   3 nop   :  27 or    :   7 ori   :  45 out   :  47 pop   :  38 
push  :  45 rcall : 330 ret   : 186 reti  :   6 rjmp  : 366 rol   :   0 
ror   :   2 sbc   :  14 sbci  :   2 sbi   :  43 sbic  :  21 sbis  :  22 
sbiw  :   6 sbr   :  20 sbrc  :  21 sbrs  :  19 sec   :   1 seh   :   0 
sei   :  12 sen   :   0 ser   :   3 ses   :   0 set   :   0 sev   :   0 
sez   :   0 sleep :   2 spm   :   0 st    :  14 std   :   0 sts   : 303 
sub   :  17 subi  :  18 swap  :   6 tst   :   4 wdr   :   0 
Instructions used: 71 out of 113 (62.8%)

"ATmega169PA" memory use summary [bytes]:
Segment   Begin    End      Code   Data   Used    Size   Use%
---------------------------------------------------------------
[.cseg] 0x000000 0x00280a   9676    574  10250   16384  62.6%
[.dseg] 0x000100 0x0001fa      0    250    250    1024  24.4%
[.eseg] 0x000000 0x000100      0    119    119     512  23.2%

Assembly complete, 0 errors, 0 warnings
